<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Greg Beifuss</title>
        <link>http://localhost:1313/posts/</link>
        <description>Recent content in Posts on Greg Beifuss</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 15 Aug 2024 17:48:28 -0400</lastBuildDate><atom:link href="http://localhost:1313/posts/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>VMWare Converter Error</title>
        <link>http://localhost:1313/posts/esxi_vmware_converter_error/</link>
        <pubDate>Thu, 15 Aug 2024 17:48:28 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi_vmware_converter_error/</guid>
        <description>&lt;p&gt;I was trying to use the VMWare Standalone Converter tool today to P2V a very old physical server, running CentOS 5.2. The age of the OS meant that I had to use Converter v.5 as newer converters would not connect to the source server OS. I also had to build a brand new ESXi 5.5 host, as newer ESXi versions require modern security protocols &amp;amp; ciphers which aren&amp;rsquo;t supported by Converter 5.5.&lt;/p&gt;
&lt;p&gt;After setting everything up, I ran the Converter wizard. The task failed with the following message:&lt;br&gt;
&lt;strong&gt;FAILED: Unable to obtain the IP address of the helper virtual machine&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It turns out that the VM receiving the data couldn&amp;rsquo;t obtain an DHCP address from the network. This, in turn, meant there was no IP for the Converter to send the data to.&lt;/p&gt;
&lt;p&gt;When running through the Conversion wizard, you can set &lt;code&gt;Helper VM Network Options&lt;/code&gt; via. the &lt;strong&gt;Options&lt;/strong&gt; screen. Simply assign a compatible static IP and the Helper VM will boot with those settings.&lt;/p&gt;
&lt;p&gt;After manually setting the IP, the migration task proceeded normally.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Website Publishing with Hugo and GitHub</title>
        <link>http://localhost:1313/posts/hugo-config/</link>
        <pubDate>Wed, 10 Jul 2024 14:34:17 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-config/</guid>
        <description>&lt;p&gt;This website is primarily generated through hugo. I recently switched my main computer from a Surface Pro (v4) to a Dell Latitude 7320, which means that I had to reconfigure my website authoring environment from scratch. Along the way, there were lots of little hiccups because of a) changes to hugo since the last install and b) steps and tweaks that I&amp;rsquo;d not documented anywhere. It took a couple of hours, but everything is configured and publishing the way that I like again.&lt;/p&gt;
&lt;p&gt;Generally speaking, I:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;took a backup of my existing site&lt;/li&gt;
&lt;li&gt;installed hugo-extended and git&lt;/li&gt;
&lt;li&gt;created my hugo site&lt;/li&gt;
&lt;li&gt;used git to link my site with github pages&lt;/li&gt;
&lt;li&gt;restored files&lt;/li&gt;
&lt;li&gt;published&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I started by creating a .zip backup of my existing files. Then, &lt;em&gt;I deleted all the existing files&lt;/em&gt; as they are in OneDrive. I don&amp;rsquo;t want the cloud copies being automatically pushed back down to my laptop while I&amp;rsquo;m configuring everything.&lt;/p&gt;
&lt;p&gt;Next, I installed &lt;em&gt;hugo-extended&lt;/em&gt; and &lt;em&gt;git&lt;/em&gt; with chocolately package manager and powershell:&lt;br&gt;
&lt;code&gt;chocolatey install hugo-extended git -y&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;After that, I created my directories again, and told hugo that this was a new site:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;hugo new site .
Congratulations! Your new Hugo site was created in C:\Users\Greg\OneDrive\myblog.dev.repo.

Just a few more steps...

1. Change the current directory to C:\Users\Greg\OneDrive\myblog.dev.repo.
2. Create or install a theme:
   - Create a new theme with the command &amp;#34;hugo new theme &amp;lt;THEMENAME&amp;gt;&amp;#34;
   - Or, install a theme from https://themes.gohugo.io/
3. Edit hugo.toml, setting the &amp;#34;theme&amp;#34; property to the theme name.
4. Create new content with the command &amp;#34;hugo new content &amp;lt;SECTIONNAME&amp;gt;\&amp;lt;FILENAME&amp;gt;.&amp;lt;FORMAT&amp;gt;&amp;#34;.
5. Start the embedded web server with the command &amp;#34;hugo server --buildDrafts&amp;#34;.

See documentation at https://gohugo.io/.


C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;dir
 Volume in drive C has no label.
 Volume Serial Number is D8FC-8442

 Directory of C:\Users\Greg\OneDrive\myblog.dev.repo

2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          .
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          ..
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          archetypes
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          assets
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          content
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          data
2024-07-10  11:53 AM                83 hugo.toml
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          i18n
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          layouts
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          static
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          themes
               1 File(s)             83 bytes
              10 Dir(s)  434,143,707,136 bytes free

C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;hugo server
Watching for changes in C:\Users\Greg\OneDrive\myblog.dev.repo\{archetypes,assets,content,data,i18n,layouts,static}
Watching for config changes in C:\Users\Greg\OneDrive\myblog.dev.repo\hugo.toml
Start building sites …
hugo v0.128.2-de36c1a95d28595d8243fd8b891665b069ed0850+extended windows/amd64 BuildDate=2024-07-04T08:13:25Z VendorInfo=gohugoio

WARN  found no layout file for &amp;#34;html&amp;#34; for kind &amp;#34;home&amp;#34;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination.
WARN  found no layout file for &amp;#34;html&amp;#34; for kind &amp;#34;taxonomy&amp;#34;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination.

                   | EN
-------------------+-----
  Pages            |  4
  Paginator pages  |  0
  Non-page files   |  0
  Static files     |  0
  Processed images |  0
  Aliases          |  0
  Cleaned          |  0

Built in 7 ms
Environment: &amp;#34;development&amp;#34;
Serving pages from disk
Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
Web Server is available at http://localhost:1313/ (bind address 127.0.0.1)
Press Ctrl+C to stop

C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;dir
 Volume in drive C has no label.
 Volume Serial Number is D8FC-8442

 Directory of C:\Users\Greg\OneDrive\myblog.dev.repo

2024-07-10  12:15 PM    &amp;lt;DIR&amp;gt;          .
2024-07-10  12:15 PM    &amp;lt;DIR&amp;gt;          ..
2024-07-10  12:15 PM                 0 .hugo_build.lock
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          archetypes
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          assets
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          content
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          data
2024-07-10  11:53 AM                83 hugo.toml
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          i18n
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          layouts
2024-07-10  12:15 PM    &amp;lt;DIR&amp;gt;          public
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          static
2024-07-10  11:53 AM    &amp;lt;DIR&amp;gt;          themes
               2 File(s)             83 bytes
              11 Dir(s)  434,142,384,128 bytes free
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I launched &amp;amp; killed hugo (above) just so that it can create all the files and directories that aren&amp;rsquo;t automatically generated (like /public). I then grabbed a copy of the &lt;em&gt;stack&lt;/em&gt; theme and installed it in the themes directory:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;git init
Initialized empty Git repository in C:/Users/Greg/OneDrive/myblog.dev.repo/.git/

C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;git submodule add git@github.com:gbeifuss/hugo-theme-stack themes/hugo-theme-stack
Cloning into &amp;#39;C:/Users/Greg/OneDrive/myblog.dev.repo/themes/hugo-theme-stack&amp;#39;...
remote: Enumerating objects: 3111, done.
remote: Total 3111 (delta 0), reused 0 (delta 0), pack-reused 3111
Receiving objects: 100% (3111/3111), 852.37 KiB | 2.10 MiB/s, done.
Resolving deltas: 100% (1964/1964), done.
warning: in the working copy of &amp;#39;.gitmodules&amp;#39;, LF will be replaced by CRLF the next time Git touches it
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After this, I restored all all of the necessary configuration files &amp;amp; assets from the backup into their appropriate locations. hugo.toml, archtypes/default.md, /static, /layout, /contents, etc.&lt;br&gt;
The next step is to link this back up with my github page. I did grab a copy of my id_ed25519.pub file (has my SSH key for github authentication) from my old laptop and validated a successful connection:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;ssh -T git@github.com
Hi gbeifuss! You&amp;#39;ve successfully authenticated, but GitHub does not provide shell access.

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git remote add origin https://github.com/gbeifuss/gbeifuss.github.io.git

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git remote -v
origin  https://github.com/gbeifuss/gbeifuss.github.io.git (fetch)
origin  https://github.com/gbeifuss/gbeifuss.github.io.git (push)


C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git push origin main
error: src refspec main does not match any
error: failed to push some refs to &amp;#39;https://github.com/gbeifuss/gbeifuss.github.io.git&amp;#39;

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git checkout -b main
Switched to a new branch &amp;#39;main&amp;#39;

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git push --force origin main
Enumerating objects: 372, done.
Counting objects: 100% (372/372), done.
Delta compression using up to 8 threads
Compressing objects: 100% (230/230), done.
Writing objects: 100% (372/372), 1.74 MiB | 1.72 MiB/s, done.
Total 372 (delta 152), reused 0 (delta 0), pack-reused 0 (from 0)
remote: Resolving deltas: 100% (152/152), done.
To https://github.com/gbeifuss/gbeifuss.github.io.git
 + e4d1dbd...cccf12b main -&amp;gt; main (forced update)

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git push origin main
Everything up-to-date

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, create new content:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg\OneDrive\myblog.dev.repo&amp;gt;hugo new content/post/esxi_vmware_converter_error.md
Content &amp;#34;C:\\Users\\Greg\\OneDrive\\myblog.dev.repo\\content\\post\\esxi_vmware_converter_error.md&amp;#34; created
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Use &lt;code&gt;hugo server -D&lt;/code&gt; to run the server in Draft mode, showing all published &lt;em&gt;and&lt;/em&gt; draft content.
Use &lt;code&gt;hugo&lt;/code&gt; to create the entire static copy of the site for publishing.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Installing OpenSSH Server on Windows 11</title>
        <link>http://localhost:1313/posts/win11_sshd_sftp/</link>
        <pubDate>Tue, 09 Jul 2024 10:12:04 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/win11_sshd_sftp/</guid>
        <description>&lt;p&gt;I needed to spin up an SFTP server to validate that a backup of our NSX appliance was working, so I tried a couple of free/lightweight SFTP applications that ended up not working (likely because they didn&amp;rsquo;t support the correct encryption keys/ciphers/algorithms). Dell Support recommends OpenSSH 8.1, so I decided to install the OpenSSH Server that comes with Windows 11.&lt;/p&gt;
&lt;p&gt;Install it via. Start &amp;gt; Optional Features &amp;gt; Add &amp;gt; OpenSSH Server&lt;/p&gt;
&lt;p&gt;After the installation is complete, validate that the service is running. I believe it is Stopped by default, so start it up.&lt;/p&gt;
&lt;p&gt;Services.msc &amp;gt; OpenSSH SSH Server &amp;gt; Start&lt;/p&gt;
&lt;p&gt;I then validated that it was working with the following command:
&lt;code&gt;ssh localhost -v&lt;/code&gt;
This command tries to connect to the SSH server and authenticate as the current user. Using &lt;code&gt;-v&lt;/code&gt; enables verbose mode, which is helpful for seeing the server host key (fingerprint).&lt;br&gt;
Next, I created a new user account, because I didn&amp;rsquo;t want to enter my domain user credentials in the NSX backup configuration window, especially during a vendor call.
Computer Management &amp;gt; Users &amp;gt; Create&lt;/p&gt;
&lt;p&gt;I then tried running an NSX backup, which failed. After checking Windows Firewall (a rule had already been created to allow :22), I decided to edit the SSH Server configuration since it seemed to be listening only via. localhost, not my IP address. Open &lt;code&gt;c:\programdata\ssh\sshd_config&lt;/code&gt; and uncomment the &lt;code&gt;#ListenAddress 0.0.0.0&lt;/code&gt; entry, which tells SSH Server to listen on all IPv4 IPs known to the system.&lt;br&gt;
Restart the OpenSSH SSH Server service for the changes to take effect.&lt;/p&gt;
&lt;p&gt;Connecting to the IP now worked: &lt;code&gt;ssh 10.1.1.15 -v&lt;/code&gt;&lt;br&gt;
I then tried connecting with the new user I&amp;rsquo;d created: &lt;code&gt;ssh tester@10.1.1.15 -v&lt;/code&gt;, which also worked.&lt;br&gt;
Retrying the NSX backup resulted in a successful backup&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Configuring Docker instance of ichapod</title>
        <link>http://localhost:1313/posts/omv_ichapod/</link>
        <pubDate>Thu, 11 Apr 2024 10:11:58 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/omv_ichapod/</guid>
        <description>&lt;p&gt;One of my favourite &amp;rsquo;listening experiences&amp;rsquo; is the radio show &lt;a class=&#34;link&#34; href=&#34;https://ciut.fm/shows-by-day/higher-ground&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Higher Ground&lt;/a&gt; on CUIT 89.5. It&amp;rsquo;s hosted by Jason Palma and I&amp;rsquo;ve been listening for 20+ years.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;tldr; I&amp;rsquo;ve been downloading the show for many years&lt;/em&gt;&lt;br&gt;
When I first discovered this show circa. 2000, the station allowed streaming of that week&amp;rsquo;s show with RealAudio. I discovered that the stream file could be opened, giving me the URL for the underlying .ra file. I faithfully downloaded the file weekly, and listened to the shows while working on my college labs. Later on, the station quit that, and the show would post the MP3s on a third party site. I downloaded all of those too, which were shows from 2008-2010.&lt;br&gt;
Sometime in/around September 2014, I managed to infect my laptop with CryptoWall (1.0). In the process of recovering/reformatting my laptop, I erased &lt;em&gt;all&lt;/em&gt; of my historical archives of Higher Ground shows. The only ones I had left were encrypted copies of the 2008-2010 shows. Of course, by 2014 the site hosting the originals had quit offering that service, so there was no way to re-download them. The station at that point was only hosting the .mp3 for the current show - each week a new file was posted for streaming.&lt;br&gt;
By then I was into Powershell and scripting, so I set up a scheduled task that ran my script to download the .mp3 file each week. This ran faithfully for a few years, until the station changed things again. Higher Ground was by this time posting the files to Podbean.com.&lt;/p&gt;
&lt;p&gt;I use &lt;a class=&#34;link&#34; href=&#34;https://www.openmediavault.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;OMV&lt;/a&gt; to host a SMB share plus a small &lt;a class=&#34;link&#34; href=&#34;https://jellyfin.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Jellyfin&lt;/a&gt; instance. I figured that with its embedded support for Docker, this would be a great opportunity to have OMV handle the downloading for me. I found a great docker container (ichapod) that will parse a podcast playlist and download all the files, including prefixing the filename with the posted date so that I can listen in order. If there&amp;rsquo;s nothing to download, ichapod will terminate.&lt;/p&gt;
&lt;p&gt;OMV &amp;gt; Services &amp;gt; Compose &amp;gt; Files &amp;gt; Add&lt;/p&gt;
&lt;p&gt;I used this configuration file:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;version: &amp;#39;3&amp;#39;
services:
  ichapod:
    image: shikasta/ichapod
    build: .
    volumes:
      - &amp;#34;./podcasts.yml:/var/lib/ichapod/podcasts.yml&amp;#34;
      - &amp;#34;/srv/dev-disk-by-uuid-964d6de1-d26d-4f07-b743-30799f1c511d/backup/archive:/podcasts&amp;#34; ##saves to Higher Ground Radio folder
    command:
      - &amp;#34;/var/lib/ichapod/podcasts.yml&amp;#34;
      - &amp;#34;/podcasts&amp;#34;
    user: &amp;#34;1000:10000&amp;#34;
    restart: &amp;#39;always&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;em&gt;volumes&lt;/em&gt; entries tell the Docker instance to present the &lt;code&gt;podcasts.yml&lt;/code&gt; file as &lt;code&gt;/var/lib/ichapod/podcasts.yml&lt;/code&gt;, which is where ichapod expects to find the list of podcasts. I also present my &lt;code&gt;/backup/archive directory&lt;/code&gt; as &lt;code&gt;/podcasts&lt;/code&gt;, which is where ichapod will create a directory named after the podcast series, and save the playlist files.&lt;/p&gt;
&lt;p&gt;I created a &lt;code&gt;podcasts.yml&lt;/code&gt; file with the following content:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;---
- series: Higher Ground Radio
  url: https://feed.podbean.com/ciuthigherground/feed.xml
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;Some articles I referenced when figuring this out were:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://hub.docker.com/r/shikasta/ichapod&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://hub.docker.com/r/shikasta/ichapod&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://github.com/shikasta-net/Ichapod&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/shikasta-net/Ichapod&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://ciut.fm/shows-by-day/higher-ground&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Higher Ground Radio&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://www.facebook.com/groups/highergroundradio/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Higher Ground Radio Facebook Group&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Configure SSH access via. Windows Terminal &amp; a private key</title>
        <link>http://localhost:1313/posts/omv_sshkey/</link>
        <pubDate>Tue, 05 Mar 2024 10:13:04 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/omv_sshkey/</guid>
        <description>&lt;p&gt;Windows Terminal is one of my most loved features of recent Windows releases. Seriously Microsoft, where was this application in Windows 2000? I can launch Powershell, Command Prompt &lt;em&gt;and&lt;/em&gt; ssh sessions from the same window - simply amazing! (Yes, I know that Linux has supported this for decades).&lt;/p&gt;
&lt;p&gt;I wanted to create a profile that would let me administer my omv Linux server, without having to input credentials &lt;em&gt;every. single. time.&lt;/em&gt; To do that, a public/private key needs to be created, before copying the public key over to the destination server. Then, when I connect via. SSH and present my private key, the connection is transparently (to me) approved.&lt;/p&gt;
&lt;p&gt;Start by running the command &lt;code&gt;ssh-keygen -t rsa&lt;/code&gt; to generate a keypair. I accepted all the defaults, and skipped a passphrase:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg&amp;gt;ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (C:\Users\Greg/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in C:\Users\Greg/.ssh/id_rsa.
Your public key has been saved in C:\Users\Greg/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:IaBSPSCx3y416+iY7qLYbMf9FoxBNhSNbAR/SMRh5yM greg@DESKTOP-SU06DHB
The key&amp;#39;s randomart image is:
+---[RSA 3072]----+
|o.oooBO=.        |
| + .o=O+.        |
|o .  =E.=        |
| o .  .+ o       |
|  . +  +S        |
|   o o. o        |
|  ..o.   .       |
|o=.+o . .        |
|X==..  o.        |
+----[SHA256]-----+

C:\Users\Greg&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now we copy the public key over to the omv server:&lt;br&gt;
&lt;code&gt;cat ~/.ssh/id_rsa.pub | ssh root@192.168.4.107 &amp;quot;mkdir -p ~/.ssh &amp;amp;&amp;amp; chmod 700 ~/.ssh &amp;amp;&amp;amp; cat &amp;gt;&amp;gt;  ~/.ssh/authorized_keys&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Finally, we setup the connection profile in Windows Terminal via. &lt;code&gt;Launch Terminal &amp;gt; Settings &amp;gt; Open JSON&lt;/code&gt; &lt;br&gt;
Paste this configuration string into the profiles section. You&amp;rsquo;ll need to update the username and IP address to reflect your situation:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{
    &amp;#34;commandline&amp;#34;: &amp;#34;ssh -i \&amp;#34;~/.ssh/id_rsa\&amp;#34; root@192.168.4.107&amp;#34;,
    &amp;#34;font&amp;#34;: {&amp;#34;size&amp;#34;: 10.0},
    &amp;#34;guid&amp;#34;: &amp;#34;{0caa0dad-35be-5f56-a8ff-afceaeaa6103}&amp;#34;,
    &amp;#34;hidden&amp;#34;: false,
    &amp;#34;name&amp;#34;: &amp;#34;OMV Server&amp;#34;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Save the settings, then test the connection!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ESXI VCentre Certificates</title>
        <link>http://localhost:1313/posts/esxi-vcentre-certificates/</link>
        <pubDate>Wed, 19 Jul 2023 13:28:02 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-vcentre-certificates/</guid>
        <description>&lt;p&gt;Someone on our VDI team informed me that they were getting an error when trying to log into their VSCA:
&amp;ldquo;An error occurred during authentication.&amp;rdquo;
&lt;img src=&#34;http://localhost:1313/img/esxi-vcsa-cert-error.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;VSCA Authentication Error&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;I started with the usual troubleshooting - did it work with my credentials? (No, it did not). Did it work in a private browser window, to rule out a caching issue? (No, it did not).&lt;/p&gt;
&lt;p&gt;I tried logging in locally, but none of the accounts that &lt;em&gt;should&lt;/em&gt; have worked, actually worked. So, before actually troubleshooting the issue, I had to break into the VCSA. Following the advice in &lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/2147144&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Resetting root password in vCenter Server Appliance 6.5 / 6.7 / 7.x (2147144)&lt;/a&gt;, I:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;took a snapshot (including memory) of the VCSA as currently configured&lt;/li&gt;
&lt;li&gt;Reboot the vCenter Server Appliance.&lt;/li&gt;
&lt;li&gt;After the VCSA Photon OS starts, press the e key to enter the GNU GRUB Edit Menu.&lt;/li&gt;
&lt;li&gt;Locate the line that begins with the word Linux, then appending these entries to the end of the line: &lt;code&gt;rw init=/bin/bash&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Press F10 to continue booting. Ran the command &lt;code&gt;mount -o remount,rw /&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;In the Command prompt, enter the command passwd and provide a new root password (twice for confirmation): &lt;code&gt;passwd&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Unmount the filesystem by running the &lt;em&gt;umount&lt;/em&gt; command: &lt;code&gt;umount /&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Reboot the vCenter Server Appliance via &lt;code&gt;reboot -f&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Confirm that you can access the vCenter Server Appliance using the new root password.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At that point, I was finally in via CLI.
I then had to reset the password for &lt;a class=&#34;link&#34; href=&#34;mailto:administrator@vsphere.local&#34; &gt;administrator@vsphere.local&lt;/a&gt;. I followed the steps in &lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/2146224&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;How to unlock and reset SSO password in vSphere 6.x/7.x using the vdcadmintool (2146224)&lt;/a&gt; to use the &lt;code&gt;/usr/lib/vmware-vmdir/bin/vdcadmintool&lt;/code&gt; tool for this.&lt;/p&gt;
&lt;p&gt;A look in &lt;code&gt;/var/log/vmware/vsphere-ui/logs/vsphere_client_virgo.log&lt;/code&gt; showed entries similar to this:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;The SSL certificate does not match when connecting to the vCenter Single Sign-On.
com.vmware.vim.vmomi.client.exception.VlsiCertificateException: Server certificate chain is not trusted and thumnprint verification is not configured.
![VSCA Log Errors](/img/esxi-vcsa-cert-log.png)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That confirmed that this was likely a certificate error. I started by checking the STS certificate, following the advice in &lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/79248&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Checking Expiration of STS Certificate on vCenter Servers (79248)&lt;/a&gt;, but the STS certificate was valid until 2029.&lt;/p&gt;
&lt;p&gt;I then looked at the other certificates by using &lt;code&gt;check-trust-anchors -cml&lt;/code&gt;, which showed that the certificates had indeed expired 10 days ago:
&lt;img src=&#34;http://localhost:1313/img/esxi-vcsa-cert-expired.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;VSCA Expired Certificates&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;I followed the advice in &lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/2112283&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;How to regenerate vSphere 6.x, 7.x, and 8.0 certificates using self-signed VMCA (2112283)&lt;/a&gt; to generate a new certificate:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Connect via. SSL or console&lt;/li&gt;
&lt;li&gt;Launch the vSphere 6.x Certificate Manager: &lt;code&gt;/usr/lib/vmware-vmca/bin/certificate-manager&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Select Option 4 (Regenerate a new VMCA Root Certificate and replace all certificates)&lt;/li&gt;
&lt;li&gt;Type the &lt;a class=&#34;link&#34; href=&#34;mailto:administrator@vsphere.local&#34; &gt;administrator@vsphere.local&lt;/a&gt; password when prompted.&lt;/li&gt;
&lt;li&gt;Enter the appropriate values when prompted by the VMCA&lt;/li&gt;
&lt;li&gt;Confirm proceeding: &lt;code&gt;You are going to regenerate Root Certificate and all other certificates using VMCA. Continue operation : Option[Y/N] ? : Y&lt;/code&gt;
After 5 minutes, the operation completed and the new certificates were in place.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Refreshing the VCSA website allowed me to log in, and the VDI team confirmed that everything was working again. Hurrah!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ESXi CPU Ready Time statistics</title>
        <link>http://localhost:1313/posts/esxi-cpu-ready/</link>
        <pubDate>Mon, 03 Apr 2023 17:00:36 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-cpu-ready/</guid>
        <description>&lt;p&gt;I worked on an issue at work today that was really interesting (from a technical troubleshooting perspective), so I thought that I&amp;rsquo;d write about it.&lt;/p&gt;
&lt;p&gt;Our organization is in the midst of moving from one datacentre to another. The PKI team reported that their new, just-spun-up servers at the new site were all performing very poorly. Their servers were all running at about 50% CPU usage on an 8 vCPU, 16GB RAM server, but took forever to boot or shutdown, and the GUI had noticible lag when clicking or moving around windows. They suspected a CPU issue - instead of having their 8 vCPU allocated as 8 sockets x 1 core each, they wanted 2 sockets x 4 core, or 1 socket x 8 core because they believed this would improve performance.&lt;br&gt;
According to VMWare, this allocation doesn&amp;rsquo;t make any real difference in terms of performance since ESXi 6.5/6.7 (but may be needed for licensing compliance).&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s what the VM metrics looked like:
&lt;img src=&#34;http://localhost:1313/img/cpu-ready-stats.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Monthly CPU Stats&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Migrating to another ESXi host in the cluster made no difference. The host servers in the cluster were all running at about 50% load, so it didn&amp;rsquo;t seem to be an oversubscription issue (my first suspicion).&lt;/p&gt;
&lt;p&gt;Even doubling the resources (to 16 vCPU, 32GB RAM) on a VM made no real difference in performance, although I could see that the VM CPU load dropped to about 30% from 50%.&lt;/p&gt;
&lt;p&gt;I found the CPU Ready Time metric and after reading up on what it was and what acceptable values should be, figured out that the problem was that the VM&amp;rsquo;s CPU couldn&amp;rsquo;t get &lt;em&gt;scheduled time&lt;/em&gt; on the host server.&lt;br&gt;
&lt;em&gt;CPU Ready Time in VSphere is a metric that records the amount of time that a VM is ready to use CPU, but cannot because all CPU resources (on an ESXi host) are busy.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/cpu-ready-wait.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;CPU Ready Time&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;The VM in question was averaging 1000 second wait time for each CPU call (1.05M ms) over the prior day. VMWare documentation suggests that CPU Ready Time at or over 5% could indicate a performance problem. I quickly crunched some numbers using the &lt;a class=&#34;link&#34; href=&#34;https://vmcalc.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;vmcalc.com&lt;/a&gt; website. An average wait time of 1046000ms works out to a CPU Ready Time of about 656%&amp;hellip; well above the 5% threshold!&lt;/p&gt;
&lt;p&gt;I compared the PKI Server&amp;rsquo;s CPU Ready Time (1.05M ms) to that of a random server on another cluster, which had an average of just 30 ms!&lt;/p&gt;
&lt;p&gt;I worked with a colleague to find the cause of this CPU throttling, which turned out to be a Resource Group limit set on the entire PKI &amp;lsquo;folder&amp;rsquo;, affecting 27 VMs.&lt;/p&gt;
&lt;p&gt;We changed the CPU Limit from 30,000 MHz to 60,000 Mhz, effectively doubling the amount of CPU that the servers in this PKI group could consume.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/cpu-ready-policy.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Resource Policy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;We also checked each VM to make sure that limits were not set on individual VMs. Each one &lt;em&gt;did&lt;/em&gt; have the CPU capped to 19200 MHz, which works out to 2.4GHz (when all 8 vCPU are considered). An effective 2.4GHz vCPU rate should be enough to run PKI, so this was contributing to the performance issue that the PKI team was experiencing.&lt;/p&gt;
&lt;p&gt;After applying the Limit change, we immediately saw the CPU Ready Time drop on the PKI VMs to something in the 300-400 ms range.&lt;br&gt;
It doesn&amp;rsquo;t show well in this image because the scale is too vast, but you can clearly see it drop off from 40000-80000 ms to a negligable level.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/cpu-ready-fixed.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;CPU Performance&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Using ovftool to migrate VMs between ESXi hosts</title>
        <link>http://localhost:1313/posts/esxi-ovftool/</link>
        <pubDate>Mon, 13 Mar 2023 15:38:51 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-ovftool/</guid>
        <description>&lt;p&gt;Last week I found some Shadow IT at work - a single business-managed ESXi server hosting legacy VMs for code testing. We have an arm of our business that supports products for 25 years, so releases need to be tested on Windows XP servers and other OSes of that era. In any case, this server was happily chugging along &amp;hellip; on ESXi 5.0! Needless to say, I need to bring these VMs into the IT-fold and migrate them to a modern ESXi server: VxRail running ESXi 7.0. But with such an obsolete product, migration can&amp;rsquo;t rely on some of the modern tools that I normally rely on.&lt;/p&gt;
&lt;p&gt;That meant it was time for Open Virtualization Formal Tool (ovftool) to come to my rescue! This is a VMWare tool used to manipulate VMs to OVFs (or OVAs), OVFs to VMs, and VM-to-VM migrations. Exactly what I need! The only caveat is that that no vmotion is possible - the VMs need to be powered down.&lt;/p&gt;
&lt;p&gt;I downloaded &lt;a class=&#34;link&#34; href=&#34;https://developer.vmware.com/web/tool/4.4.0/ovf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ovftool 4.4.3&lt;/a&gt; to my laptop and got to work. The syntax for a VM-VM migration on a VxRail took me quite a bit of time to figure out, because the documentation isn&amp;rsquo;t very helpful, and all of examples I found with Google-fu claimed that I could just use the destination server name or IP. (&lt;em&gt;Hint: I couldn&amp;rsquo;t.&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;The source server, source VM, destination storage and destination server (and credentials!) are needed, according to the documentation. Also, the &lt;em&gt;datastore&lt;/em&gt; is the destination file system, not the source.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://userid@domain.com@destination.server.hostname -ds=vxrail-vsan1
Error: Unexpected option:  -ds=vxrail-vsan1
Completed with errors
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I took a quick look at the help file and determined I should be providing the information like this:
&lt;code&gt;Usage: ovftool [options] &amp;lt;source&amp;gt; [&amp;lt;target&amp;gt;]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I found that I could specify only the information above, but then I&amp;rsquo;d be prompted for credentials each time I ran the command, and typing in credentials became old very fast&amp;hellip; so I added them to the command:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe -ds=vxrail-vsan1 vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://userid@domain.com@destination.server.hostname
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Enter login information for target vi://destination.server.hostname/
Username: username@hostname
Password: ****************
Error: Found wrong kind of object (Folder). Possible completions are:
  site/
Completed with errors
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Clearly I need to add &amp;lsquo;site/&amp;rsquo; to the destination server path, so that OVFTool knows where to create the file. Note that I need to add &amp;ldquo;host/&amp;rdquo; too:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe -ds=vxrail-vsan1 vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://h488735a@global.ds.honeywell.com@destination.server.hostname/site/host
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Enter login information for target vi://destination.server.hostname/
Username: username@hostname
Password: ****************
Error: Found wrong kind of object (Folder). Possible completions are:
  site-vxrail/
Completed with errors
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;sigh&lt;/em&gt; another folder to add to the destination server path. Your path may differ based on the heirarchy of your ESXi cluster. ovftool will continue generating an error about the Folder if you&amp;rsquo;re not at the final path:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe -ds=vxrail-vsan1 vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://h488735a@global.ds.honeywell.com@destination.server.hostname/site/host/site-vxrail/
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Enter login information for target vi://destination.server.hostname/
Username: username@hostname
Password: ****************
Opening VI target: vi://username@hostname@destination.server.hostname:443/site/host/site-vxrail/
Error: No network mapping specified. OVF networks:   VM Network. Target networks:   Management Network-92c1a646-e30f-436e-bfd6-b05f32371c4d  Virtual SAN-92c1a646-e30f-436e-bfd6-b05f32371c4d  VxRail Management-92c1a646-e30f-436e-bfd6-b05f32371c4d  site-VLAN101  site-VLAN200  site-VLAN210  vCenter Server Network-92c1a646-e30f-436e-bfd6-b05f32371c4d  vSphere vMotion-92c1a646-e30f-436e-bfd6-b05f32371c4d
Completed with errors
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Oh, this is finally promising!
I need to add the network mapping to the command, so I pick the appropriate target network (in this case, site-VLAN210)&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe -ds=vxrail-vsan1 vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://h488735a@global.ds.honeywell.com@destination.server.hostname/site/host/site-vxrail/ -nw=site-VLAN210
Error: Unexpected option: -nw=site-VLAN210
Completed with errors
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Grrrr&amp;hellip; foiled again by the order of the information I provide. One more time!&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\apps\ovftool&amp;gt;ovftool.exe -ds=vxrail-vsan1 -nw=site-VLAN210 vi://root:password@source.server.hostname/AMT-1800.BuildServer vi://h488735a@global.ds.honeywell.com@destination.server.hostname/site/host/site-vxrail/
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Opening VI source: vi://root@ip.address:443/AMT-1800.BuildServer
Enter login information for target vi://destination.server.hostname/
Username: username@hostname
Password: ****************
Opening VI target: vi://username@hostname@destination.server.hostname:443/site/host/site-vxrail/
Deploying to VI: vi://username@hostname@destination.server.hostname:443/site/host/site-vxrail/
Transfer Completed
Completed successfully
 
C:\apps\ovftool&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Hurrah! A quick check on the VxRail and I can see that the VM has been migrated, stored on the right datastore and joined to the right network. I power it on as a quick test and confirm that I can ping it. Success!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Dell USB driver halts Linux boot</title>
        <link>http://localhost:1313/posts/linux-initrd-drivers/</link>
        <pubDate>Mon, 06 Mar 2023 15:21:01 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/linux-initrd-drivers/</guid>
        <description>&lt;p&gt;I ran into an issue this week where a work server stopped booting after a linux kernel patch (3.10.0-xxxx.83.xxxx) was deployed.&lt;/p&gt;
&lt;p&gt;The server would always get &amp;lsquo;stuck&amp;rsquo; trying to load drivers for an Avocent USB Keyboard/Mouse. These seemed to be the Dell iDRAC drivers, because the virtual console lacked keyboard/mouse inputs.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/initrd.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Linux Error&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;If the old kernel (3.10.0-1160.80.xxxx) was selected during boot, the OS loaded properly. I&amp;rsquo;m not a Unix expert, so I looped in one of my colleagues.&lt;/p&gt;
&lt;p&gt;He explained that the kernel was trying to use old (or corrupted) drivers from the &lt;code&gt;initrd&lt;/code&gt; (initial ram disk) scheme. These drivers can be rebuilt by running &lt;code&gt;yum install kernel&lt;/code&gt;.&lt;br&gt;
After running the command, I rebooted the server which booted properly.&lt;/p&gt;
&lt;p&gt;Dell seems to have several similar KBs on this issue, like this one about &lt;a class=&#34;link&#34; href=&#34;https://www.dell.com/support/manuals/en-ca/redhat-enterprise-linux-v8.0/rhel8_rn_pub/drivers-available-in-oemdrv-drive-are-not-installed-during-the-operating-system-installation?guid=guid-f650622c-3711-404a-9f1d-2bca352b62be&amp;amp;lang=en-us&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Drivers available in OEMDRV drive are not installed during the operating system installation&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ESXi upgrade generates Dependency Errors</title>
        <link>http://localhost:1313/posts/esxi-failed-dependencies/</link>
        <pubDate>Mon, 06 Mar 2023 14:27:52 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-failed-dependencies/</guid>
        <description>&lt;p&gt;I was patching ESXi hosts at work (again!) and ran into an issue with dependencies.&lt;/p&gt;
&lt;p&gt;Update Manager generated an error when trying to patch ESXi 6.5, so I tried updating from the CLI:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@server00:~] esxcli software vib update -d &amp;#34;/vmfs/volumes/ecd3afaf-295422fc/VMware-VMvisor-Installer-6.5.0.update03-20502893.x86_64-DellEMC_Customized-A10.zip&amp;#34; --dry-run

[DependencyError]
VIB Brocade_bootbank_scsi-bfa_3.1.0.0-1OEM.500.0.0.472560 requires vmkapi_2_0_0_0, but the requirement cannot be satisfied within the ImageProfile.
VIB Brocade_bootbank_net-bna_3.1.0.0-1OEM.500.0.0.472560 requires com.vmware.driverAPI-9.2.0.0, but the requirement cannot be satisfied within the ImageProfile.
VIB Brocade_bootbank_net-bna_3.1.0.0-1OEM.500.0.0.472560 requires vmkapi_2_0_0_0, but the requirement cannot be satisfied within the ImageProfile.
VIB Brocade_bootbank_scsi-bfa_3.1.0.0-1OEM.500.0.0.472560 requires com.vmware.driverAPI-9.2.0.0, but the requirement cannot be satisfied within the ImageProfile.
Please refer to the log file for more details.
[root@server00:~]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;One server was patched by downloading the &lt;code&gt;DellEMC-ESXi-6.5U3-20502893-A10.iso&lt;/code&gt; image to the Update Manager and creating a baseline from it. I then attached it to the host and let it Remediate.&lt;/p&gt;
&lt;p&gt;Another server didn&amp;rsquo;t upgrade with the custom baseline I created, so I tried to remove the dependencies via. CLI:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@server00:~] esxcli software vib list | grep -i brocade
net-bna                        3.1.0.0-1OEM.500.0.0.472560           Brocade   VMwareCertified   2014-02-19
scsi-bfa                       3.1.0.0-1OEM.500.0.0.472560           Brocade   VMwareCertified   2014-02-19
 
[root@server00:~] esxcli software vib remove -n net-bna
[DependencyError]
VIB Brocade_bootbank_scsi-bfa_3.1.0.0-1OEM.500.0.0.472560 requires com.vmware.driverAPI-9.2.0.0, but the requirement cannot be satisfied within the ImageProfile.
VIB Brocade_bootbank_scsi-bfa_3.1.0.0-1OEM.500.0.0.472560 requires vmkapi_2_0_0_0, but the requirement cannot be satisfied within the ImageProfile.
Please refer to the log file for more details.
[root@server00:~] esxcli software vib remove -n scsi-bfa
[DependencyError]
VIB Brocade_bootbank_net-bna_3.1.0.0-1OEM.500.0.0.472560 requires com.vmware.driverAPI-9.2.0.0, but the requirement cannot be satisfied within the ImageProfile.
VIB Brocade_bootbank_net-bna_3.1.0.0-1OEM.500.0.0.472560 requires vmkapi_2_0_0_0, but the requirement cannot be satisfied within the ImageProfile.
Please refer to the log file for more details.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;As the error above shows, that didn&amp;rsquo;t work, because there were sub-requirements that were not met.&lt;/p&gt;
&lt;p&gt;I finally managed to apply the update via. CLI by instructing ESXi that it was okay to remove VIBs not associated with the profile being installed:
&lt;code&gt;esxcli software profile install -p DellEMC-ESXi-6.5U3-14320405-A03 -d /vmfs/volumes/datastore/ISO/VMware-VMvisor-Installer-6.5.0.update03-14320405.x86_64-DellEMC_Customized-A03.zip --ok-to-remove&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ESXi Staging Volume Full</title>
        <link>http://localhost:1313/posts/esxi-staging-volume-full/</link>
        <pubDate>Mon, 06 Mar 2023 14:27:15 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-staging-volume-full/</guid>
        <description>&lt;p&gt;Another tale of ESXi patching adventures. My company has some ESXi hosts in remote locations that don&amp;rsquo;t get much care. As long as they&amp;rsquo;re running the VMs and business users don&amp;rsquo;t complain, the hosts don&amp;rsquo;t get much attention.&lt;/p&gt;
&lt;p&gt;Today I was trying to patch a server with all the ESXi 6.5 patches released to date, but it was failing with this error:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;02 / 27 / 2023, 2:14:57 PM  The VFAT filesystem mpx.vmhba32:C0:T0:L0:8 (UUID 577b5b9f-bf67afef-822f-246e960d8318) is ...
02 / 27 / 2023, 2:56:00 PM  Could not stage image profile &amp;#39;(Updated) ESXi-5.5.0-20150104001-standard&amp;#39;: (&amp;#39;VMware_locker_tools-light_6.5.0-3.191.20448942&amp;#39;, &amp;#39;[Errno 32] Broken pipe&amp;#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Some quick searching revealed that this error is likely because the locker partition is out of space. Lo and behold, it was:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
[root@server02:~] ls -ltrh / | grep store
lrwxrwxrwx    1 root     root           6 Feb 27 20:21 locker -&amp;gt; /store
lrwxrwxrwx    1 root     root          49 Feb 27 20:21 store -&amp;gt; /vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318
[root@server02:~]

[root@server02: / vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318/packages] df -h
Filesystem   Size   Used Available Use% Mounted on
NFS          4.0T   2.2T      1.8T  55% /vmfs/volumes/vmds05
NFS          4.0T   2.9T      1.1T  72% /vmfs/volumes/vmds06
NFS          4.0T   2.4T      1.6T  61% /vmfs/volumes/vmds04
NFS          4.0T   2.9T      1.1T  73% /vmfs/volumes/vmds03
NFS          4.0T   2.3T      1.7T  56% /vmfs/volumes/vmds02
NFS          7.0T   6.5T    517.3G  93% /vmfs/volumes/vmds01
vfat       285.8M 285.8M     56.0K 100% /vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318
vfat       249.7M 166.1M     83.6M  67% /vmfs/volumes/930098e3-722a9454-fdea-b663aa3b7053
vfat       249.7M 166.1M     83.6M  67% /vmfs/volumes/3bc3cee8-10f1c748-e8e5-d729b7af1e64

[root@server02:~] df /locker
Filesystem         Bytes          Used     Available Use% Mounted on
vfat           299712512     299655168         57344 100% /vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Using the disk and partition information in the error, I formatted the partition with vfat:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@server02:~] vmkfstools -C vfat /dev/disks/mpx.vmhba32:C0:T0:L0:8
create fs deviceName:&amp;#39;/dev/disks/mpx.vmhba32:C0:T0:L0:8&amp;#39;, fsShortName:&amp;#39;vfat&amp;#39;, fsName:&amp;#39;(null)&amp;#39;
deviceFullPath:/dev/disks/mpx.vmhba32:C0:T0:L0:8 deviceFile:mpx.vmhba32:C0:T0:L0:8
Checking if remote hosts are using this device as a valid file system. This may take a few seconds...
Creating vfat file system on &amp;#34;mpx.vmhba32:C0:T0:L0:8&amp;#34; with blockSize 1048576 and volume label &amp;#34;none&amp;#34;.
Successfully created new volume: 577b5b9f-bf67afef-822f-246e960d8318
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then, I recreated the symlinks:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ln -snf /vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318 /store
ln -snf /vmfs/volumes/577b5b9f-bf67afef-822f-246e960d8318 /locker
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After a reboot, I found another host server running the same ESXi version and path level, then copied the contents of the store to my newly formatted partition. After another reboot (just to be safe), I was able to patch the host server without any problems.&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;An article I referenced when figuring this out was:&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://blog.ntitta.in/?p=254&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Fixing the broken/corrupt Locker Partition on Esxi&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Cancel Vmware Tools Installation on ESXi</title>
        <link>http://localhost:1313/posts/esxi-cancel-vmware-tools/</link>
        <pubDate>Mon, 06 Mar 2023 14:26:42 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-cancel-vmware-tools/</guid>
        <description>&lt;p&gt;I ran into an issue at work where a migraton was halted because of a VM waiting for a VMWare Tools install to finish&amp;hellip; but I didn&amp;rsquo;t want to deal with it right then. Tracking down the owner and getting permission to reboot it outside of the normal schedule was going to be a hassle.&lt;/p&gt;
&lt;p&gt;Luckily, these installs can be cancelled via. SSH on the host server:&lt;/p&gt;
&lt;p&gt;List all the VMs on the host: &lt;code&gt;vim-cmd vmsvc/getallvms&lt;/code&gt;
Cancel the installation for the specific guest VM by using the ID (from above): &lt;code&gt;vim-cmd vmsvc/tools.cancelinstall &amp;lt;VM ID&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@server01:~] vim-cmd vmsvc/getallvms
Vmid     Name                     File                        Guest OS          Version                                      Annotation
1      GUEST24   [vmds03] GUEST24/GUEST24.vmx     windows8Server64Guest   vmx-13
2      GUEST38   [vmds03] GUEST38/GUEST38.vmx     windows8Server64Guest   vmx-13
38     GUEST00   [vmds04] GUEST00/GUEST00.vmx     rhel6_64Guest           vmx-08    Initially created to refresh guest03 - cancelled later
Now used as test server.
40     GUEST16   [vmds01] GUEST16_1/GUEST16.vmx   rhel7_64Guest           vmx-13
45     GUEST09   [vmds01] GUEST09/GUEST09.vmx     rhel7_64Guest           vmx-13
47     GUEST43   [vmds05] GUEST43/GUEST43.vmx     rhel7_64Guest           vmx-13
48     GUEST02   [vmds01] GUEST02/GUEST02.vmx     rhel5Guest              vmx-10
49     GUEST39   [vmds06] GUEST39/GUEST39.vmx     windows7Server64Guest   vmx-10

[root@server01:~] vim-cmd vmsvc/tools.cancelinstall 48
[root@server01:~]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After cancelling the install, I was able to finish the migration.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>VMWare ESXi - Disable SLP</title>
        <link>http://localhost:1313/posts/esxi-slp/</link>
        <pubDate>Mon, 06 Mar 2023 14:26:07 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-slp/</guid>
        <description>&lt;p&gt;ESXi vulnerablities are in the news recently as they are being exploited &lt;em&gt;en masse&lt;/em&gt;&amp;hellip; not that active news coverage should be the sole driver for patching a server. The SLP (Service Location Protocol) service runs as root and parses network input without authentication. Since 2021 the recommendation from VMWare has been to disable the service. Newer versions (ie. 7.0 U2c and 8.0) disable it by default.&lt;/p&gt;
&lt;p&gt;VMWare has an article - &lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/76372&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;How to Disable/Enable the SLP Service on VMware ESXi (76372)&lt;/a&gt; - describing how to disable the service.&lt;/p&gt;
&lt;p&gt;Essentially, enable SSH on the host server, then connect to it with pUTTY or a similar tool.
Stop the SLD service: &lt;code&gt;/etc/init.d/slpd stop&lt;/code&gt;
Disable the SLP service: &lt;code&gt;esxcli network firewall ruleset set -r CIMSLP -e 0&lt;/code&gt;
Make the change persistent across reboots: &lt;code&gt;chkconfig slpd off&lt;/code&gt;
Confirm the change is persistent: &lt;code&gt;chkconfig --list | grep slpd&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
The server does not need a reboot for this change to take effect.
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>VMWare Tools Update/Install/Uninstall fails</title>
        <link>http://localhost:1313/posts/esxi-vmware-tools/</link>
        <pubDate>Thu, 13 Oct 2022 09:03:35 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-vmware-tools/</guid>
        <description>&lt;p&gt;I&amp;rsquo;m in the midst of migrating a number of VMs from ESXi 6.5 hosts to ESXi 7.0.3, which means there are newer versions of the VMWare Tools available for the guests. Usually, selecting &amp;ldquo;Upgrade VMWare Tools&amp;rdquo; works seamlessly, but occassionally, the installer cannot properly uninstall the old version of the Tools, which results in the error &lt;code&gt;Error upgrading VMWare Tools&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Attempting to remove it directly from the guest OS (x64 Windows, in my case) results in the installer prompting for a location for  missing file &lt;code&gt;VMWare Tools64.msi&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The fix for this is easy, but convoluted.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Determine the version of VMWare Tools currently installed. I found the &lt;a class=&#34;link&#34; href=&#34;https://packages.vmware.com/tools/versions&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;VMWare version-mapping file&lt;/a&gt; helpful.&lt;/li&gt;
&lt;li&gt;Download that version of the VMWare Tools package from &lt;a class=&#34;link&#34; href=&#34;https://packages,vmware.com/tools/esx/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;VMWare.com&lt;/a&gt;. I prefer to use the ISO.&lt;/li&gt;
&lt;li&gt;Copy the ISO to your guest VM.&lt;/li&gt;
&lt;li&gt;Mount this ISO (in Windows, this is done by right-clicking and choosing &amp;lsquo;mount&amp;rsquo;)&lt;/li&gt;
&lt;li&gt;Open a command prompt and browse to the newly mounted drive.&lt;/li&gt;
&lt;li&gt;Locate the &lt;code&gt;setup.exe&lt;/code&gt; file, which should be at the root&lt;/li&gt;
&lt;li&gt;Type &lt;code&gt;setup.exe /a&lt;/code&gt; and press &lt;code&gt;&amp;lt;ENTER&amp;gt;&lt;/code&gt;. You&amp;rsquo;ll be prompted for a location to save the extracted files&lt;/li&gt;
&lt;li&gt;After the files are extracted, re-uninstall VMWare Tools inside the guest.&lt;/li&gt;
&lt;li&gt;When prompted for the &lt;code&gt;VMWare Tools64.msi&lt;/code&gt; file, browse to the location you just finished extracting the files to&lt;/li&gt;
&lt;li&gt;The uninstall should complete&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Reboot the guest VM, then install the updated version of VMWare Tools!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Recovering SQL System Admin rights</title>
        <link>http://localhost:1313/posts/sql-sa/</link>
        <pubDate>Tue, 09 Aug 2022 15:49:19 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/sql-sa/</guid>
        <description>&lt;p&gt;It seems that a lot of my recent posts are related to my &amp;ldquo;adventures&amp;rdquo; at work. Oh well&amp;hellip; &lt;code&gt;&amp;lt;shrugs&amp;gt;&lt;/code&gt; Here&amp;rsquo;s another!&lt;/p&gt;
&lt;p&gt;We have a legacy SQL server (Windows 2012R2, SQL 2012) that was unmaintained for a number of years until I came along. We had a developer who was nominally responsible for it, but I discovered that even his credentials didn&amp;rsquo;t have full &lt;strong&gt;sa&lt;/strong&gt; rights, and some databases were simply not accessible by him. I decided to turn to a life of crime and break in.&lt;/p&gt;
&lt;p&gt;Is it really breaking in when I follow MS documentation? I suppose not.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;You can start an instance of SQL Server in single-user mode with either the -m or -f options from the command line. Any member of the computer&amp;rsquo;s local Administrators group can then connect to the instance of SQL Server as a member of the sysadmin fixed server role.
When you start the instance in single-user mode, first stop the SQL Server Agent service. Otherwise, SQL Server Agent might connect first, taking the only available connection to the server and blocking you from logging in.&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open a Windows PowerShell command. Run it as an Administrator&lt;/li&gt;
&lt;li&gt;Define the variables to use later:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$service_name = &amp;#34;MSSQL`$instancename&amp;#34;  
$sql_server_instance = &amp;#34;machine_name\instance&amp;#34;  
$login_to_be_granted_access = &amp;#34;[CONTOSO\PatK]&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Stop SQL Server service:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;`net stop $SERVICENAME`
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Execute a CREATE LOGIN command followed by ALTER SERVER ROLE command&amp;quot;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;`sqlcmd.exe -E -S $sql_server_instance -Q &amp;#34;CREATE LOGIN $login_to_be_granted_access FROM WINDOWS; ALTER SERVER ROLE sysadmin ADD MEMBER $login_to_be_granted_access; &amp;#34;`
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Exit, and restart the service normally&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/connect-to-sql-server-when-system-administrators-are-locked-out?view=sql-server-ver16&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Connect to SQL Server when system administrators are locked out&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Thick-provisioned VMs on vSAN - Fixing a vSAN Alert</title>
        <link>http://localhost:1313/posts/esxi-storage-policy-not-applying/</link>
        <pubDate>Mon, 08 Aug 2022 20:06:08 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-storage-policy-not-applying/</guid>
        <description>&lt;p&gt;We recently installed a VMWare/Dell VXRail deployment at my work to replace older ESXi 6.5 servers. I&amp;rsquo;m transitioning existing systems in the server room to the new VXRail through physical-to-virtual (P2V) or virtual-to-virtual (V2V) migrations. Since VMWare has removed their standalone converter, I&amp;rsquo;m using Veeam for the P2V.&lt;/p&gt;
&lt;p&gt;I had an issue a couple of days ago where I performed a P2V as usual, but the VM was showing up with thick provisioned disks on the vSAN, instead of thin provisioned ones, as the assigned storage policy mandates. I was alerted to this by a vSAN online health check, as the &amp;ldquo;Thick-provisioned VMs on vSAN&amp;rdquo; alert tripped. This alarm triggers when vSAN detects thick-provisioned VMs, which in my case was occurring despite the presence of Object Space Reservation = 0 (thin provisioned) in the applied vSAN Storage Policy.provisioned.&lt;/p&gt;
&lt;p&gt;There is no way in ESXi 7 to forcibly re-apply the currently-assigned storage policy, so I fixed this by cloning the existing policy, applying &lt;em&gt;that&lt;/em&gt;, then reapplying the original policy again.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open the &lt;strong&gt;Policies and Profiles&lt;/strong&gt; menu, and select &lt;strong&gt;VM Storage Policies&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Select the existing vSAN storage policy and click &lt;strong&gt;Clone&lt;/strong&gt;. We&amp;rsquo;ll create an exact copy of the existing profile and apply it to the problem disks.&lt;/li&gt;
&lt;li&gt;Assign a new name. I appended &amp;ldquo;Clone&amp;rdquo; to the end of my existing policy name. Press &lt;strong&gt;Next&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;There is nothing to change under &lt;em&gt;2 Policy Structure&lt;/em&gt;. Press &lt;strong&gt;Next&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Under &lt;em&gt;3 vSAN&lt;/em&gt;, select the &lt;em&gt;Advanced Policy Rules&lt;/em&gt; tab. Ensure that &lt;em&gt;Object Space Reservation = Thin Provisioning&lt;/em&gt;. Press &lt;strong&gt;Next&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;There is nothing to change under &lt;em&gt;4 Storage Compatibility&lt;/em&gt;. Press &lt;strong&gt;Next&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;There is nothing to change under &lt;em&gt;5 Review and Finish&lt;/em&gt;. Verify that &lt;em&gt;Object Space Reservation = Thin Provisioning&lt;/em&gt;. Press &lt;strong&gt;Finish&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Right-click the VM that has Thick Provisioned disks, select &lt;strong&gt;VM Policies &amp;gt; Edit VM Storage Policies&lt;/strong&gt;. Change the applied &lt;strong&gt;Storage Policy&lt;/strong&gt; to the newly created one. After selecting the new policy, the edit policy wizard will display the change (decrease) in storage consumption. Click OK to apply the change.&lt;/p&gt;
&lt;p&gt;Wait for the policy to apply, which could take 10-15 minutes, depending on the size of your disks. The disk should now show that it&amp;rsquo;s Thin Provisioned.&lt;/p&gt;
&lt;p&gt;After this is complete, reapply the original policy.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Expand a Linux Disk in ESXi</title>
        <link>http://localhost:1313/posts/esxi-expand-linux-disk/</link>
        <pubDate>Wed, 11 May 2022 10:51:54 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-expand-linux-disk/</guid>
        <description>&lt;p&gt;I came across a Linux Database VM at work that desperately needed more disk space. The DBA outlined how they wanted the storage to be allocated, so I set about with the work!&lt;/p&gt;
&lt;p&gt;First, I added new disks in ESXi to match the disk space requested. I added space in 500 or 1000 GB blocks to give flexibility with storage and vmotion. Disks were balanced across SCSI controllers as well.&lt;/p&gt;
&lt;p&gt;Then, I logged into the linux VM with admin credentials.&lt;/p&gt;
&lt;p&gt;At a high-level, I&amp;rsquo;ll:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Capture the existing disk statistics &amp;amp; configuration for reference:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;fdisk -l
lvs
df -TH | grep Disk
lsblk
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Add space to the disk group, then expand the logical volume to make use of that space:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo vgextend oralogvg /dev/sdaa
sudo pvresize /dev/sdaa
sudo lvextend -l+100%FREE /dev/oralogvg/oraloglv
sudo xfs_growfs /dev/oralogvg/oraloglv
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VMWare has an article outlining this process (&lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/1006371&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Extending a logical volume in a virtual machine running Red Hat or Cent OS&lt;/a&gt;), but it  assumes the creation of a disk partition prior to adding it to the disk group. The existing disks I dealt with aren&amp;rsquo;t configured like that, so I didn&amp;rsquo;t want to deviate from what&amp;rsquo;s already in place.&lt;/p&gt;
&lt;p&gt;I dumped the current disks to determine how Linux has labelled the new disks that I added in ESXi. They should be at the end of the list and not be mapped to any logical volumes or disk groups:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ lsblk
NAME                                            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                                               8:0    0   68G  0 disk
├─sda1                                            8:1    0    1M  0 part
├─sda2                                            8:2    0    1G  0 part /boot
└─sda3                                            8:3    0   62G  0 part
├─vg00-LogVol00_root                          253:0    0    5G  0 lvm  /
├─vg00-LogVol00_swap                          253:1    0   22G  0 lvm  [SWAP]
├─vg00-LogVol00_usr                           253:2    0   10G  0 lvm  /usr
├─vg00-LogVol00_vlogaudit                     253:10   0    2G  0 lvm  /var/log/audit
├─vg00-LogVol00_vlog                          253:11   0    2G  0 lvm  /var/log
├─vg00-LogVol00_vtmp                          253:12   0    2G  0 lvm  /var/tmp
├─vg00-LogVol00_tmp                           253:13   0    5G  0 lvm  /tmp
├─vg00-LogVol00_var                           253:14   0    5G  0 lvm  /var
├─vg00-LogVol00_opt                           253:15   0    6G  0 lvm  /opt
└─vg00-LogVol00_home                          253:16   0    2G  0 lvm  /home
sdb                                               8:16   0  220G  0 disk
└─oraredo1vg-oraredo1lv                         253:20   0  370G  0 lvm  /oraredo1
sdc                                               8:32   0   12G  0 disk
└─oratempvg-oratemplv                           253:5    0   12G  0 lvm  /oratemp
sdd                                               8:48   0   10G  0 disk
└─flash_recovery_area_vg-flash_recovery_area_lv 253:6    0   10G  0 lvm  /flash_recovery_area
sde                                               8:64   0  256G  0 disk
└─oraredo3vg-oraredo3lv                         253:4    0  406G  0 lvm  /oraredo3
sdf                                               8:80   0  257G  0 disk
└─oraredo4vg-oraredo4lv                         253:18   0  407G  0 lvm  /oraredo4
sdg                                               8:96   0   70G  0 disk
└─oraclevg-oraclelv                             253:21   0   70G  0 lvm  /oracle
sdh                                               8:112  0   30G  0 disk
└─oradatavg-oradatalv                           253:17   0   30G  0 lvm  /oradata
sdi                                               8:128  0  220G  0 disk
└─oraredo2vg-oraredo2lv                         253:19   0  370G  0 lvm  /oraredo2
sdj                                               8:144  0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdk                                               8:160  0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdl                                               8:176  0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdm                                               8:192  0   20G  0 disk
└─oraidxvg-oraidxlv                             253:9    0   20G  0 lvm  /oraidx
sdn                                               8:208  0   22G  0 disk
└─oralogvg-oraloglv                             253:7    0   22G  0 lvm  /oralog
sdo                                               8:224  0   25G  0 disk
└─oraexportvg-oraexportlv                       253:3    0  2.7T  0 lvm  /oraexport
sdp                                               8:240  0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdq                                              65:0    0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdr                                              65:16   0  1.4T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sds                                              65:32   0 1000G  0 disk
└─sds1                                           65:33   0 1000G  0 part
└─oradata1vg-oradata1lv                       253:8    0   11T  0 lvm  /oradata1
sdt                                              65:48   0  1.5T  0 disk
└─oradata1vg-oradata1lv                         253:8    0   11T  0 lvm  /oradata1
sdu                                              65:64   0  1.5T  0 disk
└─oraexportvg-oraexportlv                       253:3    0  2.7T  0 lvm  /oraexport
sdv                                              65:80   0  150G  0 disk
└─oraredo1vg-oraredo1lv                         253:20   0  370G  0 lvm  /oraredo1
sdw                                              65:96   0  150G  0 disk
└─oraredo2vg-oraredo2lv                         253:19   0  370G  0 lvm  /oraredo2
sdx                                              65:112  0  150G  0 disk
└─oraredo3vg-oraredo3lv                         253:4    0  406G  0 lvm  /oraredo3
sdy                                              65:128  0  150G  0 disk
└─oraredo4vg-oraredo4lv                         253:18   0  407G  0 lvm  /oraredo4
sdz                                              65:144  0  1.2T  0 disk
└─oraexportvg-oraexportlv                       253:3    0  2.7T  0 lvm  /oraexport
sr0                                              11:0    1 1024M  0 rom
sdaa                                             65:160  0  1.5T  0 disk
sdab                                             65:176  0  1.5T  0 disk
[admin@DB030035 ~]$
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Next, extend the existing group to include the new disk:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ sudo vgextend oralogvg /dev/sdaa
WARNING: Device for PV ovZDIW-axwB-1YVM-rZVF-V90Y-5cMl-tdyU3m not found or rejected by a filter.
Physical volume &amp;#34;/dev/sdaa&amp;#34; successfully created.
Volume group &amp;#34;oralogvg&amp;#34; successfully extended
[admin@DB030035 ~]$ sudo vgextend oralogvg /dev/sdab
WARNING: Device for PV ovZDIW-axwB-1YVM-rZVF-V90Y-5cMl-tdyU3m not found or rejected by a filter.
Physical volume &amp;#34;/dev/sdab&amp;#34; successfully created.
Volume group &amp;#34;oralogvg&amp;#34; successfully extended
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then, resize the physical volume:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ sudo pvresize /dev/sdaa
WARNING: Device for PV ovZDIW-axwB-1YVM-rZVF-V90Y-5cMl-tdyU3m not found or rejected by a filter.
Physical volume &amp;#34;/dev/sdaa&amp;#34; changed
1 physical volume(s) resized or updated / 0 physical volume(s) not resized
[admin@DB030035 ~]$ sudo pvresize /dev/sdab
WARNING: Device for PV ovZDIW-axwB-1YVM-rZVF-V90Y-5cMl-tdyU3m not found or rejected by a filter.
Physical volume &amp;#34;/dev/sdab&amp;#34; changed
1 physical volume(s) resized or updated / 0 physical volume(s) not resized
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Extend the logical volume to consume 100% of the free space in the disk group:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ sudo lvextend -l+100%FREE /dev/oralogvg/oraloglv
Size of logical volume oralogvg/oraloglv changed from &amp;lt;22.00 GiB (5631 extents) to 2.95 TiB (773629 extents).
Logical volume oralogvg/oraloglv successfully resized.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, resize the file system to consume all the new space in the logical volume:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ sudo xfs_growfs /dev/oralogvg/oraloglv
meta-data=/dev/mapper/oralogvg-oraloglv isize=512    agcount=4, agsize=1441536 blks
= sectsz=512   attr=2, projid32bit=1
= crc=1        finobt=0 spinodes=0
data = bsize=4096   blocks=5766144, imaxpct=25
= sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=2815, version=2
= sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 5766144 to 792196096
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;At this point, the new space should be available on the volume. Run &lt;code&gt;fdisk&lt;/code&gt; to confirm the new size of the mount point:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[admin@DB030035 ~]$ sudo fdisk -l | grep &amp;#34;Disk /dev/mapper/oralogvg-oraloglv&amp;#34;
Disk /dev/mapper/oralogvg-oraloglv: 3244.8 GB, 3244835209216 bytes, 6337568768 sectors
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>VMWare VCSA 6.7 Backup Failure</title>
        <link>http://localhost:1313/posts/vmware-vcsa-backup/</link>
        <pubDate>Thu, 05 May 2022 09:44:16 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/vmware-vcsa-backup/</guid>
        <description>&lt;p&gt;I set out to apply patches today on a relatively-newly-installed VCSA 6.7 virtual appliance today.&lt;/p&gt;
&lt;p&gt;I started with taking a backup, as recommended by VMWare. The FTP backup would start, but then sit at &lt;code&gt;Creating backup target directory&lt;/code&gt; until it reported the error:
&lt;code&gt;Structure com.vmware.appliance.recovery.backup.job.details.info has a union with a field not required for this case = end_time&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Most of the articles I found on the topic were related to permissions being incorrectly set. However, my account had full permissions both within the FileZilla FTP Server software and within Windows. The logs showed the VCSA logging in and creating directories, but the backup would fail with the above error before transferring data.&lt;/p&gt;
&lt;p&gt;It turns out that the VCSA backup uses passive FTP for the actual transfer, and strict Windows Firewall rules prevented this from being established. Of course, security policies prevented me from temporarily disabling the firewall&amp;hellip; thanks a lot, corporate IT Security! I ended up creating a temporary Firewall rule to permit TCP 1024-1048, then configured the passive ports used by FileZilla FTP Server to use the same range.&lt;/p&gt;
&lt;p&gt;After this, the backup completed successfully, and I proceeded with patching the VCSA.&lt;/p&gt;
&lt;p&gt;In case anyone wonders, I reverted all my changes so that IT Security stays happy :)&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Reverting an ESXi Upgrade</title>
        <link>http://localhost:1313/posts/esxi-vmware-revert/</link>
        <pubDate>Sun, 01 May 2022 10:51:36 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-vmware-revert/</guid>
        <description>&lt;p&gt;I was looking at the configuration of 3 VSphere servers at work today and determined that they were running an old BIOS. I upgraded their HP DL380 G9 BIOS from &lt;code&gt;P89 v1.50 (07/20/2015)&lt;/code&gt; to &lt;code&gt;P89 v2.72 (03/25/2019)&lt;/code&gt; using iLO.&lt;/p&gt;
&lt;p&gt;The first two updates went out without a hitch. The last server? Not so good, as there was a cascading chain of errors.&lt;/p&gt;
&lt;p&gt;After rebooting the server (which is necessary for the BIOS update to take effect), the ESXi cluster complained that the server was not reachable. I couldn&amp;rsquo;t ping it either.&lt;/p&gt;
&lt;p&gt;I connected via. the Direct Console User Interface (DCUI) and found that the ESXi IP &amp;amp; DNS settings had reverted to old settings from several years ago.
I manually reset them to the proper values and rebooted.&lt;/p&gt;
&lt;p&gt;I then reconnected the server to the cluster, which failed because of a SSL certificate naming error. I had to rejoin it again, which resulted in an IO error:&lt;br&gt;
&lt;code&gt;Registration/Unregistration of third-party IO filter storage providers fails on a hosts&lt;/code&gt; &lt;em&gt;(yes, the error message contains a subject/verb mismatch)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Dell has KB000058590: &lt;a class=&#34;link&#34; href=&#34;https://www.dell.com/support/kbdoc/en-ca/000058590/vxrail-alarm-for-registration-unregistration-of-third-party-io-filter-storage-providers-fails&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Dell EMC VxRail: Alarm for Registration/Unregistration of third-party IO filter storage providers fails&lt;/a&gt;. I followed the steps to replace the castore.pem file with one from a working server, and rebooted.&lt;/p&gt;
&lt;p&gt;That resulted in &lt;code&gt;&amp;quot;error loading /sb.v00 fatal error 33 (inconsistent data)&amp;quot;&lt;/code&gt; when trying to boot the ESXi OS.&lt;/p&gt;
&lt;p&gt;At this point I reverted back to the prior hypervisor via. DCUI:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;In the console screen of the ESXi host, press Ctrl+Alt+F2 to see the Direct Console User Interface (DCUI) screen.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Press F12 to view the shutdown options for the ESXi host.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Press F11 to reboot.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When the Hypervisor progress bar starts loading, press Shift+R (This must be done while the bar is loading, and not after). You will see the warning:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Current hypervisor will permanently be replaced  
with build: X.X.X-XXXXXX. Are you sure? [y/n]
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Press Y to roll back the build.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Press Enter to boot.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ESXi came back online properly, but still complained about the IO filters.
At this point, I noticed that while the IP was correct, DNS reverted to old entries. I set it back to the proper values.&lt;/p&gt;
&lt;p&gt;The ESXi host is finally healthy in the cluster!&amp;hellip; but now I have to upgrade it from 6.0 to 6.5 again.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Reset Root on RHEL 4</title>
        <link>http://localhost:1313/posts/linux-reset-root/</link>
        <pubDate>Sat, 02 Apr 2022 09:35:22 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/linux-reset-root/</guid>
        <description>&lt;p&gt;One of the legacy systems I inherited at my job was a standalone Red Hat Enterprise Linux 4.0 server with no documented credentials or purpose&amp;hellip; at least, none that I could find, or that anyone in the business could recall. It&amp;rsquo;s difficult to decide if a server is still necessary when there&amp;rsquo;s no information! L33T hacking skills to the rescue!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Reboot the server. We need to edit the startup configuration in order to reset the ROOT password.&lt;/li&gt;
&lt;li&gt;As the server begins to boot again, the GRUB screen will appear for a few seconds. Press a key in order to interrupt the boot sequence.&lt;br&gt;
&lt;img src=&#34;http://localhost:1313/img/rhel-boot-1.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/li&gt;
&lt;li&gt;If you interrupted the boot in time, you&amp;rsquo;ll be presented with a menu. Use the arrow keys to select the top option and press E.
&lt;img src=&#34;http://localhost:1313/img/rhel-boot-2.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/li&gt;
&lt;li&gt;Use the arrow keys to highlight the line starting with &lt;em&gt;kernel&lt;/em&gt; and press E.
&lt;img src=&#34;http://localhost:1313/img/rhel-boot-3.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/li&gt;
&lt;li&gt;Add the word &lt;em&gt;single&lt;/em&gt; to the end of the line you&amp;rsquo;re editing, and press ENTER to save the change. This instructs the boot process to load in single user mode:&lt;br&gt;
&lt;code&gt;kernel /vmlinuz-2.6.9-55.ELsmp ro root=LABEL=/1 nousb single&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Press &lt;code&gt;b&lt;/code&gt; to continue the boot process.&lt;/li&gt;
&lt;li&gt;Once the boot process is finished, you&amp;rsquo;ll be left at the prompt. Use the &lt;code&gt;passwd&lt;/code&gt; command to reset the password for the current user (Root).&lt;/li&gt;
&lt;li&gt;Issue the &lt;code&gt;reboot&lt;/code&gt; command to restart the computer. It should boot normally, at which point you can use the new Root password to log in.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I logged in and found that this server seemed to only run a very old copy of sendmail (which no longer had a valid configuration), so I took the server offline for a scream test. In a few days, I&amp;rsquo;ll formally decommission it!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Uninstalling Tivoli Storage Manager Client</title>
        <link>http://localhost:1313/posts/tsm-uninstall/</link>
        <pubDate>Sat, 02 Apr 2022 09:34:57 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/tsm-uninstall/</guid>
        <description>&lt;p&gt;One of the legacy ecosystems that I inherited is an IBM Tivoli Storage Manager install. Ours consists of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;5 servers&lt;/li&gt;
&lt;li&gt;2 tape libraries (totalling 8x LTO-6 drives)&lt;/li&gt;
&lt;li&gt;IBM V5000 storage array&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Our site has a 25 year retention policy, driven by customer requirements &amp;amp; contracts. For the past 2-5 years, this install has not been cared for in any way. One of the tape libraries has been online for &lt;strong&gt;65,930 hours&lt;/strong&gt;&amp;hellip; that&amp;rsquo;s 7.5 years without a reboot! According to the people I spoke with, we apparently migrated away from it a few years ago &amp;hellip; but nobody could give me a 100% guarantee that all the backups were properly migrated to the new system, that retention policies were followed, or whether the TSM system could be restored from if the need ever arose.&lt;/p&gt;
&lt;p&gt;I decided that the best course of action was to power down the systems and let everything age in place. At least that would give us a &lt;em&gt;chance&lt;/em&gt; at restoring data if it turned out something was improperly transitioned.&lt;/p&gt;
&lt;p&gt;We have about 10 Windows Servers still with the IBM TSM Client installed and running, even though it wasn&amp;rsquo;t being used. We have installations ranging from v.06.02.0301 (April 2014) to v.07.01.0800 (March 2018).&lt;/p&gt;
&lt;p&gt;I opened up Add/Remove Programs and removed the software&amp;hellip; which ended up actually doing nothing other than removing the entry. The TSM services were still installed (and running!), even after a reboot:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ft &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Status&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;                         &lt;span class=&#34;n&#34;&gt;DisplayName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;                         &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Running&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Acceptor&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Acceptor&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Running&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scheduler&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Scheduler&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Stopped&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Service&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Stopped&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Remote&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Agent&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;TSM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Remote&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Agent&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;More comprehensive methods were clearly needed!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Remove Services&lt;/strong&gt;&lt;br&gt;
Launch Command Prompt (as Administrator)&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sc delete &amp;#34;TSM Client Scheduler&amp;#34;
sc delete &amp;#34;TSM Client Acceptor&amp;#34;
sc delete &amp;#34;TSM Client Agent&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Remove Files and Directories&lt;/strong&gt;&lt;br&gt;
Delete the main software folder (ie. &lt;code&gt;C:\Program Files\Tivoli&lt;/code&gt;).  If Windows states that some files are in use, reboot and retry.&lt;br&gt;
Delete the installation folder (ie. &lt;code&gt;C:\tsm_images&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Delete Registry Entries&lt;/strong&gt;&lt;br&gt;
Launch Regedit as administrator:&lt;br&gt;
Delete &lt;code&gt;HKEY_LOCAL_MACHINE\SOFTWARE\IBM\ASDM&lt;/code&gt;&lt;br&gt;
Delete &lt;code&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Tivoli&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;After a reboot, there was no trace of the TSM Client any more!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Reset Confluence Password for an Administrator ID</title>
        <link>http://localhost:1313/posts/confluence-admin/</link>
        <pubDate>Tue, 22 Mar 2022 13:26:12 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/confluence-admin/</guid>
        <description>&lt;p&gt;I recently had a request to grant a new user access to a legacy Confluence install at work. This particular server was in active use from 2013-2018ish and runs Confluence 3.1 standalone (Apache &amp;amp; mySQL).&lt;/p&gt;
&lt;p&gt;The big problem was that &lt;strong&gt;nobody knew any credentials&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I started out by browsing to the configuration in &lt;code&gt;C:\confluence\confluence-3.1-std\conf\server.xml&lt;/code&gt;. Luckily, I found some credentials to connect to the mySQL instance:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;property name=&amp;#34;hibernate.connection.driver_class&amp;#34;&amp;gt;com.mysql.jdbc.Driver&amp;lt;/property&amp;gt;
&amp;lt;property name=&amp;#34;hibernate.connection.password&amp;#34;&amp;gt;conf*w0rk&amp;lt;/property&amp;gt;
&amp;lt;property name=&amp;#34;hibernate.connection.url&amp;#34;&amp;gt;jdbc:mysql://localhost/confluence?autoReconnect=true&amp;lt;/property&amp;gt;
&amp;lt;property name=&amp;#34;hibernate.connection.username&amp;#34;&amp;gt;confluenceuser&amp;lt;/property&amp;gt;
&amp;lt;property name=&amp;#34;hibernate.database.lower_non_ascii_supported&amp;#34;&amp;gt;true&amp;lt;/property&amp;gt;
&amp;lt;property name=&amp;#34;hibernate.dialect&amp;#34;&amp;gt;com.atlassian.hibernate.dialect.MySQLDialect&amp;lt;/property&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I was then able to follow Atlassian&amp;rsquo;s documentation on &lt;a class=&#34;link&#34; href=&#34;https://confluence.atlassian.com/display/CONF34/Restoring&amp;#43;Passwords&amp;#43;To&amp;#43;Recover&amp;#43;Admin&amp;#43;User&amp;#43;Rights&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Restoring Passwords To Recover Admin User Rights&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;First, I ran a query against the database using &lt;strong&gt;MySQL Query Browser&lt;/strong&gt; to identify existing administrators. This returns the users who belong to the Confluence-Administrators group:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;select name from users u, local_members l, groups g where g.groupname = &amp;#39;confluence-administrators&amp;#39; and g.id=l.groupid and u.id=l.userid;

administrator
confadmin
wikiadmin
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;rsquo;s reset the password for &amp;lsquo;administrator&amp;rsquo;. I began by stopping Confluence via. the &lt;code&gt;shutdown.bat&lt;/code&gt; script.&lt;/p&gt;
&lt;p&gt;Then, I used &lt;strong&gt;mySQL Query Browser&lt;/strong&gt; again to reset the administrator account&amp;rsquo;s password to &lt;code&gt;admin&lt;/code&gt;:&lt;br&gt;
&lt;code&gt;update users set password = &#39;x61Ey612Kl2gpFL56FT9weDnpSo4AV8j8+qx2AuTHdRyY036xxzTTrw10Wq3+4qQyB+XURPWx1ONxp3Y3pB37A==&#39; where name=&#39;administrator&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;After the password was reset, I started Confluence again via. the &amp;lsquo;startup.bat&amp;rsquo; script. I then logged in as administrator:admin and used Confluence&amp;rsquo;s interface to add a new user account.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ADFS - Change Service Account to gMSA</title>
        <link>http://localhost:1313/posts/adfs-gmsa/</link>
        <pubDate>Tue, 22 Mar 2022 11:14:45 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/adfs-gmsa/</guid>
        <description>&lt;p&gt;Our organization ran an ADFS instance, but it was configured with a Service Account, not with a Group-Managed Service Account (gMSA), which is Microsoft&amp;rsquo;s recommendation for security reasons. I wanted to change it, without losing any of our configuration. The ADFSToolbox module didn&amp;rsquo;t seem to support a change to a gMSA, and I could find no supported way to backup our configuration (certificates, transformations, relying trusts) and restore them to a properly configured instance.&lt;/p&gt;
&lt;p&gt;To start, my environment is 2 ADFS servers (Server 2019) running WID and ADFS Farm Behaviour 4.0.&lt;/p&gt;
&lt;p&gt;I needed these tools:&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://www.powershellgallery.com/packages/ADFSToolbox/2.0.17.0&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ADFS Toolbox&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Visual C+++ redistributable (2015-2019)&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-ver15&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ODBC Driver 17&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver15&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SQLCMD&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I also referenced the ServiceAccount Module documentation on the old ADFS Toolbox site.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Create the gMSA you&amp;rsquo;re going to use, and configure it, including the altering the local security policy on both 2 ADFS servers.&lt;br&gt;
The gMSA needs rights to both &lt;strong&gt;Generate Security Audits&lt;/strong&gt; and &lt;strong&gt;Log On As A Service&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install Visual C++ on both ADFS servers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install ODBC Driver 17 on both servers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install SQLCMD on both servers&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install ActiveDirectory module for Powershell on both servers:&lt;br&gt;
Add Roles\Features &amp;gt; RSAT &amp;gt; Remote Administrator Tools &amp;gt; AD DS &amp;amp; AD LDS &amp;gt; AD for Powershell Module&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install ADFS Toolbox on both servers via. Powershell.&lt;br&gt;
Make sure Powershell is using TLS 1.2 before trying to install the ADFS Toolbox!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Import the ADFS Toolbox module on both servers:&lt;br&gt;
&lt;code&gt;import-module adfstoolbox&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install AdfsServiceAccountModule on both servers:&lt;br&gt;
&lt;code&gt;Import-Module &amp;quot;C:\Program Files\WindowsPowerShell\Modules\ADFSToolbox\2.0.17.0\serviceAccountModule\AdfsServiceAccountModule.psm1&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;On the Primary ADFS server, add the GMSA account:&lt;br&gt;
&lt;code&gt;add-AdfsServiceAccountRule -ServiceAccount adfs-gmsa$ -SecondaryServers adfs02.company.com&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;On the Secondary server, run: &lt;code&gt;Update-AdfsServiceAccount&lt;/code&gt;&lt;br&gt;
When prompted, set the Operating Mode to &lt;strong&gt;#1 - Federation Server&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;On the Primary server, run: &lt;code&gt;Update-AdfsServiceAccount&lt;/code&gt;&lt;br&gt;
When prompted, set the Operating Mode to &lt;strong&gt;#2 - Final Federation Server&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The script errored out when trying to update the SPN.&lt;br&gt;
If necessary, delete the old SPN: &lt;code&gt;setspn -D HOST/STS.COMPANY.COM DOMAIN\adfssvc&lt;/code&gt;&lt;br&gt;
Generate the new SPN: &lt;code&gt;setspn -S HOST/STS.COMPANY.COM DOMAIN\ADFS-GMSA$&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Start &lt;strong&gt;ADFSSRV&lt;/strong&gt; service on Primary&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Start &lt;strong&gt;ADFSSRV&lt;/strong&gt; service on Secondary&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Validate that the service is running properly under the new GMSA and that replication is occurring (&lt;code&gt;Get-AdfsSyncProperties&lt;/code&gt;).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Remove the old service account information via. the Primary Server:&lt;br&gt;
&lt;code&gt;remove-AdfsServiceAccountRule -ServiceAccount DOMAIN\adfssvc -SecondaryServers adfs02.COMPANY.com&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cleanup tools and powershell modules.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;I derived this article from my Reddit posts on the matter:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.reddit.com/r/adfs/comments/hmghnf/service_account_to_gmsa/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Service Account to gMSA?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.reddit.com/r/adfs/comments/n7f2py/service_account_to_gmsa_success/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Service Account to GMSA - success!&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Creating an ESXi Thin Disk</title>
        <link>http://localhost:1313/posts/esxi-thick-disk-to-thin/</link>
        <pubDate>Sat, 26 Feb 2022 09:34:35 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-thick-disk-to-thin/</guid>
        <description>&lt;p&gt;I built a new Windows 2019 Server VM the other day on our ESXi platform. I&amp;rsquo;ll migrate some services currently running on a Windows 2008R2 Server over, then decommission the old VM. One of the challenges I faced was getting our corporate image, which is stored as an image file in Phoenix, Arizona. Because of the way our storage is setup, I couldn&amp;rsquo;t directly transfer it to our storage system.&lt;/p&gt;
&lt;p&gt;I downloaded the VMDK file to my laptop first. ESXi had to expand the file from 24GB to the full 80GB during the download, which took an hour or so.
Next, I uploaded the 80GB VMDK file to our local ESXi cluster. A couple of hours later, it was finished!&lt;/p&gt;
&lt;p&gt;I attached it to a new VM, and then did a storage vMotion. Fortunately, I have a couple of datastores to choose from!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Right-click the virtual machine and select Migrate.&lt;/li&gt;
&lt;li&gt;In Step 1 of the Wizard (Select a Migration Type), select &lt;strong&gt;Change Storage Only&lt;/strong&gt; and click &lt;strong&gt;Next&lt;/strong&gt;. We don&amp;rsquo;t need to move the VM to a new host, only the files.&lt;/li&gt;
&lt;li&gt;In Step 2 of the Wizard (Select Storage) select the option &lt;strong&gt;Configure Per Disk&lt;/strong&gt; in the upper right.&lt;/li&gt;
&lt;li&gt;Select the disk to modify.&lt;/li&gt;
&lt;li&gt;Under Storage category, select the destination datastore. Under the &lt;strong&gt;Disk Format&lt;/strong&gt; option select &lt;strong&gt;Thin Provision&lt;/strong&gt;, and click &lt;strong&gt;Next&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;In Step 3 of the Wizard (Ready to Complete), review the information and click &lt;strong&gt;Finish&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/2014832&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Changing the thick or thin provisioning of a virtual disk (2014832)&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Resolving HP iLO NAND Error</title>
        <link>http://localhost:1313/posts/hp-ilo-nand-error/</link>
        <pubDate>Mon, 27 Dec 2021 00:09:54 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/hp-ilo-nand-error/</guid>
        <description>&lt;p&gt;As previously mentioned in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/esxi-60-65-upgrade/&#34; &gt;ESXi 6.0 to 6.5 Upgrade&lt;/a&gt;, I recently took over a manufacturing site where patches had been sorely neglected for a couple of years. There were a number of HP DL380 G9 servers still running iLO 1.4. Once I gained access to iLO, I started by upgrading those HP servers to iLO 2.79, the most recent version.&lt;/p&gt;
&lt;p&gt;After the mandatory reboot to apply the new iLO firmware, 2/3 of the servers now displayed an iLO login screen warning of &lt;code&gt;Embedded Flash\NAND error&lt;/code&gt;:
&lt;img src=&#34;http://localhost:1313/img/iLO-nand-error.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;fantastic excel art&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;I found HP Knowledge Base article &lt;code&gt;Document ID: c04996097&lt;/code&gt; outlining my symptoms.&lt;/p&gt;
&lt;p&gt;I started by resetting iLO and cycling the server, which had no effect.&lt;br&gt;
The next step was to format the NAND:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Log into iLO&lt;/li&gt;
&lt;li&gt;Expand &lt;code&gt;Information &amp;gt; Diagnostics&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;iLO Health&lt;/code&gt;. The status should read something like:&lt;br&gt;
&lt;code&gt;Embedded Flash/SD-CARD | Controller firmware revision 2.10.00 Embedded media initialization failed due to media write-verify test failure&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Read the warning:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;WARNING: Formatting the Embedded Flash erases all data on the iLO partition and cannot be undone. External providers (like BIOS, Intelligent Provisioning, OneView and FLM) will need to be re-configured.
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;Format Embedded Flash and reset iLO&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Accept the confirmation. iLO will reset.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After the mandatory reboot, the same error was displayed on the iLO login page.
The next suggestion in the article (if the NAND reset didn&amp;rsquo;t work) was to perform a cold boot of the server. I shut down the server, removed the power cord for 15 seconds, plugged in the cord again and started the server.&lt;/p&gt;
&lt;p&gt;This time iLO didn&amp;rsquo;t complain about problems with the flash memory. Hurrah!&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;The articles I referenced when figuring this out were:
&lt;a class=&#34;link&#34; href=&#34;https://support.hpe.com/hpesc/public/docDisplay?docId=emr_na-c04996097&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HPE Integrated Lights-Out 4 (iLO 4) - HPE Active Health System (AHS) Logs and HPE OneView Profiles May Be Unavailable Causing iLO Self-Test Error 8192, Embedded Media Manager and Other Errors&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://support.hpe.com/hpesc/public/docDisplay?docId=emr_na-a00048622en_us&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HPE Integrated Lights-Out 4 (iLO 4) - How to Format the NAND Used to Store AHS logs, OneView Profiles, and Intelligent Provisioning&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HP iLO C7000 Credential Reset</title>
        <link>http://localhost:1313/posts/hp-boa-c7000-reset/</link>
        <pubDate>Mon, 27 Dec 2021 00:09:41 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/hp-boa-c7000-reset/</guid>
        <description>&lt;p&gt;As previously mentioned in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/esxi-60-65-upgrade/&#34; &gt;ESXi 6.0 to 6.5 Upgrade&lt;/a&gt;, I recently took over a manufacturing site where some administrative passwords that weren&amp;rsquo;t known. In particular, there were two HP Blade C7000 chassis with no credentials for the Blade Onboard Administrator.&lt;/p&gt;
&lt;p&gt;The easiest way to reset the Administrator credential is by plugging a USB key (with a reset script) in the chassis, then use the Insight LCD to run the script.&lt;/p&gt;
&lt;p&gt;Create a new text file containing only the following string: &lt;code&gt;SET USER PASSWORD &amp;quot;Administrator&amp;quot; &amp;quot;password&amp;quot;&lt;/code&gt; and save it with a .cfg extension on a USB key.
On the Insight LCD, select &lt;code&gt;USB Menu &amp;gt; Restore Configuration &amp;gt; usb://d1/resetadmin.cfg&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This will reset the Administrator password to &lt;code&gt;password&lt;/code&gt;. Launch your browser of choice, connect to the BOA and log in with &lt;code&gt;Administrator: password&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;resetadmin.cfg

SET USER PASSWORD &amp;#34;Administrator&amp;#34; &amp;#34;password&amp;#34;
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>Remediating Log4j in VMWare VCenter 6.5</title>
        <link>http://localhost:1313/posts/esxi-vcenter-log4j/</link>
        <pubDate>Wed, 22 Dec 2021 16:17:50 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-vcenter-log4j/</guid>
        <description>&lt;p&gt;The log3j vulnerability in an Apache Java component is one of the more serious and widespread software/security flaws to be identified in some time&amp;hellip; although, it does seem like that&amp;rsquo;s said every few months.
Basically, the flaw is triggered when a specific string is sent to the logging module. This string can be used to trigger a lookup on a remote server, returning a Java script that is then injected into the process. This then lets the attacker execute commands at the same privilege level as the application using the logging library. In short, it allows for remote code execution, and complete control by an attacker.&lt;/p&gt;
&lt;p&gt;I had a number of ESXi 6.5 servers that needed to be patched. Fortunately, VMWare has a Python script that can be used for automated remediation.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Enable SSH login on the VCenter appliance:&lt;br&gt;
Browse to https://vcenterappliance:5480/, then choose &lt;code&gt;Access &amp;gt; Edit &amp;gt; Enable SSH login&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Download the current Python script from VMWare:&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/87081&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Workaround instructions to address CVE-2021-44228 and CVE-2021-45046 in vCenter Server and vCenter Cloud Gateway (87081)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Launch Kitty, or your SSH application of choice. Connect to your VCenter appliance and load the shell:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;login as: root
Pre-authentication banner message from server:
| VMware vCenter Server Appliance 6.5.0.35000
|
| Type: vCenter Server with an embedded Platform Services Controller
End of banner message from server
Keyboard-interactive authentication prompts from server:
| Password:
End of keyboard-interactive prompts from server
Connected to service

* List APIS: &amp;#34;help api list&amp;#34;
* List Plugins: &amp;#34;help pi list&amp;#34;
* Launch BASH: &amp;#34;shell&amp;#34;

Command&amp;gt; shell
Shell access is granted to root
root@servername [ ~ ]#
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Create a new file in VI. Press &lt;code&gt;I&lt;/code&gt; for Insert mode, then paste in the script contents that were downloaded from VMWare by right-clicking in the terminal. After the paste is complete, press &lt;code&gt;ESC&lt;/code&gt;, then &lt;code&gt;:wq&lt;/code&gt; to save the file and quit VI. I also validate the size of the new file:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@servername [ ~ ]# vi /tmp/vmsa-2021-0028-kb87081.py
root@servername [ ~ ]# ls /tmp/vmsa* -l
-rw-r--r-- 1 root root 44290 Dec 21 20:43 /tmp/vmsa-2021-0028-kb87081.py
root@servername [ ~ ]#
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;Run the script with the command &lt;code&gt;python /tmp/vmsa-2021-0028-kb87081.py&lt;/code&gt;:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@servername [ ~ ]# python /tmp/vmsa-2021-0028-kb87081.py
2021-12-21T20:45:37 INFO main: Script version: 1.6.0
2021-12-21T20:45:37 INFO main: VCenter type: Version: 6.5.0.35000; Build: 179949
27; Deployment type: embedded; Gateway: False; VCHA: False; Windows: False;
A service stop and start is required to complete this operation. Continue? [y] y
2021-12-21T20:45:44 INFO Stop: stopping services
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;The script will run for some time. After it&amp;rsquo;s complete, review the output to make sure it completed successfully.&lt;/li&gt;
&lt;li&gt;For my own sanity, I run the script a second time with the &lt;code&gt;-r&lt;/code&gt; flag in order to validate the results:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@servername [ ~ ] python /tmp/vmsa-2021-0028-ib87081.py -r
2021-12-21T20:55:17 INFO main: Script version: 1.6.0
2021-12-21T20:55:17 INFO main: vCenter type: Version: 6.5.0.35000: Build: 17994927: Deployment type: embedded: Ga
teway: False: VCHA: False: Windows: False:
2021-12-21T20:55:17 INFO main: Running in dryrun mode.
2021-12-21T20:56:01 INFO print_summary:
Summary
No vulnerable files found!
Total found: 0
Log file: /var/log/vmsa-2021-0028_2021_12_21_20_55_17.log
2021-12-21T20:56:01 INFO main: Done.
ROOT@servername [ ~ ]:
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;The articles I referenced when figuring this out were:&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://kb.vmware.com/s/article/87081&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Workaround instructions to address CVE-2021-44228 and CVE-2021-45046 in vCenter Server and vCenter Cloud Gateway (87081)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.virtubytes.com/2021/12/15/mitigate-log4j-vmware-vulnerability-workaround&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;How to Mitigate Log4j VMware Vulnerability – Workaround&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>ESXi 6.0 to 6.5 Upgrade</title>
        <link>http://localhost:1313/posts/esxi-60-65-upgrade/</link>
        <pubDate>Mon, 20 Dec 2021 23:38:30 -0500</pubDate>
        
        <guid>http://localhost:1313/posts/esxi-60-65-upgrade/</guid>
        <description>&lt;p&gt;Almost two months ago, I assumed responsibility for a new site. It turned out that no one had really performed any administration at the site in about two years and there was a lot of basic work to do. There were failed UPSes, cables left hanging from racks when servers had been decommissioned, no administrative IDs for some hardware (iLO and iDRAC) and no patching. They had several ESXi clusters still running 6.0 (which has no HTML 5 support) so access and administration was a nightmare, to say nothing of the security risks. Updating to 6.5 was high on my priority list!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Download the offline bundle ZIP from VMWare for my HP DL380 G9 hardware.&lt;/li&gt;
&lt;li&gt;Upload the offline bundle zip to a datastore accessible by the host via. VCenter GUI&lt;/li&gt;
&lt;li&gt;Enable SSH mode for the host hardware. This can be done in the VCenter GUI via. Settings -&amp;gt; Configure -&amp;gt; System/Services/SSH.&lt;/li&gt;
&lt;li&gt;SSH to the host with your terminal of choice and sign in. I&amp;rsquo;m partial to &lt;a class=&#34;link&#34; href=&#34;https://github.com/kovidgoyal/kitty&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Kitty&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;If you haven&amp;rsquo;t already done so, move all guests to other hosts, then place the host server in Migration Mode:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@vsphere-sap01:~] esxcli system maintenanceMode set --enable true
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Update the software:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@vsphere-sap01:~] esxcli software vib update -d /vmfs/volumes/Tintri02-SAP/ISO/VMware-ESXi-6.5.0-Update3-18678235-HPE-Gen9plus-650.U3.10.8.0.36-Oct2021-depot.zip

[DependencyError]

VIB VMW_bootbank_ehci-ehci-hcd_1.0-4vmw.650.0.14.5146846 requires com.vmware.usb-10.0, but the requirement cannot be satisfied within the ImageProfile.

VIB VMW_bootbank_ata-pata-pdc2027x_1.0-3vmw.650.0.0.4564106 requires com.vmware.libata-9.2.3.0, but the requirement cannot be satisfied within the ImageProfile.

VIB Intel_bootbank_net-igb_5.2.10-1OEM.550.0.0.1331820 requires com.vmware.driverAPI-9.2.2.0, but the requirement cannot be satisfied within the ImageProfile.

VIB Broadcom_bootbank_scsi-bnx2fc_1.710.70.v55.3-1OEM.550.0.0.1331820 requires com.vmware.libfc-9.2.2.0, but the requirement cannot be satisfied within the ImageProfile.

VIB VMW_bootbank_ata-pata-serverworks_0.4.3-3vmw.650.0.0.4564106 requires com.vmware.driverAPI-9.2.3.0, but the requirement cannot be satisfied within the ImageProfile.

VIB VMW_bootbank_ipmi-ipmi-msghandler_39.1-5vmw.650.2.50.8294253 requires com.vmware.driverAPI-9.2.3.0, but the requirement cannot be satisfied within the ImageProfile.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Ugh. Of course this can&amp;rsquo;t be a straightforward upgrade!
I tried to work around the error. A quick search revealed that apparently, if I specify the profile, I can override these prerequistes. First, I determined the profile in the package, then tried to update the profile by using the &lt;em&gt;-p&lt;/em&gt; flag:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@vsphere-sap01:~] esxcli software sources profile list -d /vmfs/volumes/Tintri02-SAP/ISO/VMware-ESXi-6.5.0-Update3-18678235-HPE-Gen9plus-650.U3.10.8.0.36-Oct2021-depot.zip

Name                                                       Vendor                      Acceptance Level

---------------------------------------------------------  --------------------------  ----------------

HPE-ESXi-6.5.0-Update3-18678235-Gen9plus-650.U3.10.8.0.36  Hewlett Packard Enterprise  PartnerSupported


[root@vsphere-sap01:~] esxcli software profile update -d /vmfs/volumes/Tintri02-SAP/ISO/VMware-ESXi-6.5.0-Update3-18678235-HPE-Gen9plus-650.U3.10.8.0.36-Oct2021-depot.zip -p HPE-ESXi-6.5.0-Update3-18678235-Gen9plus-650.U3.10.8.0.36

[InstallationError]

(&amp;#39;VMware_bootbank_esx-ui_1.34.2-16361878&amp;#39;, &amp;#39;Could not find a trusted signer.&amp;#39;)

       vibs = VMware_bootbank_esx-ui_1.34.2-16361878

Please refer to the log file for more details.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;That clearly didn&amp;rsquo;t work. I decided to tell ESXi to ignore the signing errors with the &amp;ndash;no-sig-check flag and tried again to update the profile:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@vsphere-sap01:~] esxcli software profile update -d /vmfs/volumes/Tintri02-SAP/ISO/VMware-ESXi-6.5.0-Update3-18678235-HPE-Gen9plus-650.U3.10.8.0.36-Oct2021-depot.zip -p HPE-ESXi-6.5.0-Update3-18678235-Gen9plus-650.U3.10.8.0.36 --no-sig-check

Update Result

   Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.

   Reboot Required: true

   VIBs Installed: Avago_bootbank_lsi-mr3_7.706.09.00-1OEM.650.0.0.4598673, Avago_bootbank_scsi-mpt2sas_15.10.07.00-1OEM.550.0.0.1331820, BCM_bootbank_bnxtnet_218.0.38.0-1OEM.650.0.0.4598673, BCM_bootbank_bnxtroce_218.0.16.0-1OEM.650.0.0.4598673, ELX_bootbank_elx-esx-libelxima.so_12.0.1108.0-03, EMU_bootbank_brcmfcoe_12.0.1278.0-1OEM.650.0.0.4598673, EMU_bootbank_elxiscsi_12.0.1108.0-1OEM.650.0.0.4598673, EMU_bootbank_elxnet_12.0.1216.4-1OEM.650.0.0.4598673, EMU_bootbank_lpfc_12.8.317.0-1OEM.650.0.0.4598673, HPE_bootbank_amsd_650.11.8.0.15-1.4240417, HPE_bootbank_amshelpr_650.11.8.0.8-1.4240417, HPE_bootbank_bootcfg_6.0.0.02-06.00.16.2494585, HPE_bootbank_conrep_650.10.8.0.12-6.5.0.2494585, HPE_bootbank_cru_650.6.5.10.4-1OEM.650.0.0.4240417, HPE_bootbank_fc-enablement_650.3.8.0.6-4240417, HPE_bootbank_hponcfg_6.0.0.5.5-0.37.2494585, HPE_bootbank_ilo_650.10.7.5.2-1OEM.650.0.0.4240417, HPE_bootbank_ilorest_650.3.3.0.2-4240417, HPE_bootbank_oem-build_650.U3.10.8.0.2-4240417, HPE_bootbank_scsi-hpdsa_6.0.0.76-1OEM.600.0.0.2494585, HPE_bootbank_scsi-hpvsa_5.5.0.102-1OEM.550.0.0.1331820, HPE_bootbank_smx-provider_650.03.16.00.4-4240417, HPE_bootbank_sut_6.5.0.2.9.0.0-23, HPE_bootbank_sutesxcli_6.5.0.2.9.0.0-18, HPE_bootbank_testevent_6.5.0.02-01.00.9.4240417, INT_bootbank_i40en_1.10.6-1OEM.650.0.0.4598673, INT_bootbank_icen_1.5.5.0-1OEM.650.0.0.4598673, INT_bootbank_igbn_1.5.2.0-1OEM.650.0.0.4598673, INT_bootbank_ixgben_1.9.11.0-1OEM.650.0.0.4598673, MEL_bootbank_nmlx4-core_3.16.70.2-1OEM.650.0.0.4598673, MEL_bootbank_nmlx4-en_3.16.70.2-1OEM.650.0.0.4598673, MEL_bootbank_nmlx4-rdma_3.16.70.2-1OEM.650.0.0.4598673, MEL_bootbank_nmlx5-core_4.16.71.1-1OEM.650.0.0.4598673, MEL_bootbank_nmlx5-rdma_4.16.71.1-1OEM.650.0.0.4598673, MEL_bootbank_nmst_4.12.0.105-1OEM.650.0.0.4598673, MIS_bootbank_hpessacli_5.20.8.0-6.5.0.4240417.oem, MSCC_bootbank_smartpqi_65.4150.0.119-1OEM.650.0.0.4598673, Microsemi_bootbank_nhpsa_65.0072.0.149-1OEM.650.0.0.4598673, PEN_bootbank_ionic-en_18.0.0-1OEM.650.0.0.4598673, QLC_bootbank_qcnic_1.0.59.0-1OEM.650.0.0.4598673, QLC_bootbank_qedentv_3.11.16.0-1OEM.650.0.0.4598673, QLC_bootbank_qedf_1.3.42.50-1OEM.600.0.0.2768847, QLC_bootbank_qedrntv_3.11.16.0-1OEM.650.0.0.4598673, QLC_bootbank_qfle3_1.1.17.0-1OEM.650.0.0.4598673, QLC_bootbank_qfle3f_1.1.25.0-1OEM.650.0.0.4598673, QLC_bootbank_qfle3i_1.1.5.0-1OEM.650.0.0.4598673, QLC_bootbank_scsi-qedil_1.15.15.0-1OEM.600.0.0.2494585, QLogic_bootbank_qlnativefc_2.1.101.0-1OEM.600.0.0.2768847, VMW_bootbank_ata-libata-92_3.00.9.2-16vmw.650.0.0.4564106, VMW_bootbank_ata-pata-amd_0.3.10-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-atiixp_0.4.6-4vmw.650.0.0.4564106, VMW_bootbank_ata-pata-cmd64x_0.2.5-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-hpt3x2n_0.3.4-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-pdc2027x_1.0-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-serverworks_0.4.3-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-sil680_0.4.8-3vmw.650.0.0.4564106, VMW_bootbank_ata-pata-via_0.3.3-2vmw.650.0.0.4564106, VMW_bootbank_block-cciss_3.6.14-10vmw.650.0.0.4564106, VMW_bootbank_char-random_1.0-3vmw.650.0.0.4564106, VMW_bootbank_ehci-ehci-hcd_1.0-4vmw.650.0.14.5146846, VMW_bootbank_hid-hid_1.0-3vmw.650.0.0.4564106, VMW_bootbank_ipmi-ipmi-devintf_39.1-5vmw.650.2.50.8294253, VMW_bootbank_ipmi-ipmi-msghandler_39.1-5vmw.650.2.50.8294253, VMW_bootbank_ipmi-ipmi-si-drv_39.1-4vmw.650.0.0.4564106, VMW_bootbank_lsi-msgpt35_09.00.00.00-5vmw.650.3.96.13932383, VMW_bootbank_lsi-msgpt3_17.00.02.00-1vmw.650.3.96.13932383, VMW_bootbank_misc-drivers_6.5.0-3.96.13932383, VMW_bootbank_mtip32xx-native_3.9.5-1vmw.650.0.0.4564106, VMW_bootbank_ne1000_0.8.3-8vmw.650.2.75.10884925, VMW_bootbank_nenic_1.0.29.0-1vmw.650.3.96.13932383, VMW_bootbank_net-cdc-ether_1.0-3vmw.650.0.0.4564106, VMW_bootbank_net-e1000_8.0.3.1-5vmw.650.3.153.17459147, VMW_bootbank_net-e1000e_3.2.2.1-2vmw.650.0.0.4564106, VMW_bootbank_net-enic_2.1.2.38-2vmw.650.0.0.4564106, VMW_bootbank_net-fcoe_1.0.29.9.3-7vmw.650.0.0.4564106, VMW_bootbank_net-forcedeth_0.61-2vmw.650.0.0.4564106, VMW_bootbank_net-libfcoe-92_1.0.24.9.4-8vmw.650.0.0.4564106, VMW_bootbank_net-usbnet_1.0-3vmw.650.0.0.4564106, VMW_bootbank_net-vmxnet3_1.1.3.0-3vmw.650.3.138.16576891, VMW_bootbank_ntg3_4.1.3.2-1vmw.650.2.75.10884925, VMW_bootbank_nvme_1.2.2.28-5vmw.650.3.170.18678235, VMW_bootbank_nvmxnet3_2.0.0.23-1vmw.650.1.36.7388607, VMW_bootbank_ohci-usb-ohci_1.0-3vmw.650.0.0.4564106, VMW_bootbank_pvscsi_0.1-1vmw.650.1.26.5969303, VMW_bootbank_qflge_1.1.0.3-1vmw.650.0.0.4564106, VMW_bootbank_sata-ahci_3.0-26vmw.650.1.26.5969303, VMW_bootbank_sata-ata-piix_2.12-10vmw.650.0.0.4564106, VMW_bootbank_sata-sata-nv_3.5-4vmw.650.0.0.4564106, VMW_bootbank_sata-sata-promise_2.12-3vmw.650.0.0.4564106, VMW_bootbank_sata-sata-sil24_1.1-1vmw.650.0.0.4564106, VMW_bootbank_sata-sata-sil_2.3-4vmw.650.0.0.4564106, VMW_bootbank_sata-sata-svw_2.3-3vmw.650.0.0.4564106, VMW_bootbank_scsi-aacraid_1.1.5.1-9vmw.650.0.0.4564106, VMW_bootbank_scsi-adp94xx_1.0.8.12-6vmw.650.0.0.4564106, VMW_bootbank_scsi-aic79xx_3.1-5vmw.650.0.0.4564106, VMW_bootbank_scsi-fnic_1.5.0.45-3vmw.650.0.0.4564106, VMW_bootbank_scsi-ips_7.12.05-4vmw.650.0.0.4564106, VMW_bootbank_scsi-iscsi-linux-92_1.0.0.2-3vmw.650.0.0.4564106, VMW_bootbank_scsi-libfc-92_1.0.40.9.3-5vmw.650.0.0.4564106, VMW_bootbank_scsi-megaraid-mbox_2.20.5.1-6vmw.650.0.0.4564106, VMW_bootbank_scsi-megaraid-sas_6.603.55.00-2vmw.650.0.0.4564106, VMW_bootbank_scsi-megaraid2_2.00.4-9vmw.650.0.0.4564106, VMW_bootbank_scsi-mptsas_4.23.01.00-10vmw.650.0.0.4564106, VMW_bootbank_scsi-mptspi_4.23.01.00-10vmw.650.0.0.4564106, VMW_bootbank_shim-iscsi-linux-9-2-1-0_6.5.0-0.0.4564106, VMW_bootbank_shim-iscsi-linux-9-2-2-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libata-9-2-1-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libata-9-2-2-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libfc-9-2-1-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libfc-9-2-2-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libfcoe-9-2-1-0_6.5.0-0.0.4564106, VMW_bootbank_shim-libfcoe-9-2-2-0_6.5.0-0.0.4564106, VMW_bootbank_shim-vmklinux-9-2-1-0_6.5.0-0.0.4564106, VMW_bootbank_shim-vmklinux-9-2-2-0_6.5.0-0.0.4564106, VMW_bootbank_shim-vmklinux-9-2-3-0_6.5.0-0.0.4564106, VMW_bootbank_uhci-usb-uhci_1.0-3vmw.650.0.0.4564106, VMW_bootbank_usb-storage-usb-storage_1.0-3vmw.650.0.0.4564106, VMW_bootbank_usbcore-usb_1.0-3vmw.650.2.50.8294253, VMW_bootbank_vmkata_0.1-1vmw.650.1.36.7388607, VMW_bootbank_vmkplexer-vmkplexer_6.5.0-0.0.4564106, VMW_bootbank_vmkusb_0.1-1vmw.650.3.170.18678235, VMW_bootbank_vmw-ahci_1.1.6-1vmw.650.3.96.13932383, VMW_bootbank_xhci-xhci_1.0-3vmw.650.0.0.4564106, VMware_bootbank_cpu-microcode_6.5.0-3.134.16576879, VMware_bootbank_emulex-esx-elxnetcli_11.1.28.0-0.0.4564106, VMware_bootbank_esx-base_6.5.0-3.170.18678235, VMware_bootbank_esx-dvfilter-generic-fastpath_6.5.0-1.36.7388607, VMware_bootbank_esx-tboot_6.5.0-3.170.18678235, VMware_bootbank_esx-ui_1.34.2-16361878, VMware_bootbank_esx-xserver_6.5.0-3.120.15256549, VMware_bootbank_lsu-hp-hpsa-plugin_2.0.0-16vmw.650.3.96.13932383, VMware_bootbank_lsu-lsi-drivers-plugin_1.0.0-1vmw.650.2.79.11925212, VMware_bootbank_lsu-lsi-lsi-mr3-plugin_1.0.0-11vmw.650.2.75.10884925, VMware_bootbank_lsu-lsi-lsi-msgpt3-plugin_1.0.0-8vmw.650.2.79.11925212, VMware_bootbank_lsu-lsi-megaraid-sas-plugin_1.0.0-8vmw.650.1.26.5969303, VMware_bootbank_lsu-lsi-mpt2sas-plugin_2.0.0-6vmw.650.1.26.5969303, VMware_bootbank_native-misc-drivers_6.5.0-3.120.15256549, VMware_bootbank_rste_2.0.2.0088-4vmw.650.0.0.4564106, VMware_bootbank_vmware-esx-esxcli-nvme-plugin_1.2.0.36-3.96.13932383, VMware_bootbank_vsan_6.5.0-3.170.18569621, VMware_bootbank_vsanhealth_6.5.0-3.170.18569625, VMware_locker_tools-light_6.5.0-3.166.18677441

   VIBs Removed: EMU_bootbank_lpfc_10.4.236.0-1OEM.600.0.0.2159203, Emulex_bootbank_elxnet_10.5.65.4-1OEM.550.0.0.1331820, Hewlett-Packard_bootbank_char-hpcru_6.0.6.14-1OEM.600.0.0.2159203, Hewlett-Packard_bootbank_char-hpilo_600.9.0.2.8-1OEM.600.0.0.2159203, Hewlett-Packard_bootbank_hp-ams_600.10.2.0-22.2159203, Hewlett-Packard_bootbank_hp-build_600.9.3.30.2-2159203, Hewlett-Packard_bootbank_hp-conrep_6.0.0.1-0.0.13.2159203, Hewlett-Packard_bootbank_hp-esxi-fc-enablement_550.2.3.16-1198610, Hewlett-Packard_bootbank_hp-smx-provider_600.03.08.00.13-2159203, Hewlett-Packard_bootbank_hpbootcfg_6.0.0.02-01.00.11.2159203, Hewlett-Packard_bootbank_hponcfg_6.0.0.04-00.13.17.2159203, Hewlett-Packard_bootbank_hpssacli_2.20.11.0-6.0.0.2159203, Hewlett-Packard_bootbank_hptestevent_6.0.0.01-00.00.8.2159203, Hewlett-Packard_bootbank_scsi-hpdsa_5.5.0.36-1OEM.550.0.0.1331820, Hewlett-Packard_bootbank_scsi-hpvsa_5.5.0.100-1OEM.550.0.0.1331820, LSI_bootbank_scsi-mpt2sas_15.10.06.00.1vmw-1OEM.550.0.0.1198610, QLogic_bootbank_qlnativefc_2.1.20.0-1OEM.600.0.0.2159203, VMWARE_bootbank_mtip32xx-native_3.8.5-1vmw.600.0.0.2494585, VMware_bootbank_ata-pata-serverworks_0.4.3-3vmw.600.0.0.2494585, VMware_bootbank_ata-pata-sil680_0.4.8-3vmw.600.0.0.2494585, VMware_bootbank_ata-pata-via_0.3.3-2vmw.600.0.0.2494585, VMware_bootbank_block-cciss_3.6.14-10vmw.600.0.0.2494585, VMware_bootbank_cpu-microcode_6.0.0-0.0.2494585, VMware_bootbank_ehci-ehci-hcd_1.0-3vmw.600.2.52.4600944, VMware_bootbank_emulex-esx-elxnetcli_10.2.309.6v-0.0.2494585, VMware_bootbank_esx-base_6.0.0-2.52.4600944, VMware_bootbank_esx-dvfilter-generic-fastpath_6.0.0-0.0.2494585, VMware_bootbank_esx-tboot_6.0.0-2.34.3620759, VMware_bootbank_esx-ui_1.9.0-4392584, VMware_bootbank_esx-xserver_6.0.0-0.0.2494585, VMware_bootbank_ipmi-ipmi-devintf_39.1-4vmw.600.0.0.2494585, VMware_bootbank_ipmi-ipmi-msghandler_39.1-4vmw.600.0.0.2494585, VMware_bootbank_ipmi-ipmi-si-drv_39.1-4vmw.600.0.0.2494585, VMware_bootbank_lsi-mr3_6.605.08.00-7vmw.600.1.17.3029758, VMware_bootbank_lsi-msgpt3_06.255.12.00-8vmw.600.1.17.3029758, VMware_bootbank_lsu-hp-hpsa-plugin_2.0.0-3vmw.600.2.52.4600944, VMware_bootbank_lsu-lsi-lsi-mr3-plugin_1.0.0-2vmw.600.0.11.2809209, VMware_bootbank_lsu-lsi-lsi-msgpt3-plugin_1.0.0-1vmw.600.0.0.2494585, VMware_bootbank_lsu-lsi-megaraid-sas-plugin_1.0.0-2vmw.600.0.11.2809209, VMware_bootbank_lsu-lsi-mpt2sas-plugin_1.0.0-4vmw.600.1.17.3029758, VMware_bootbank_misc-drivers_6.0.0-2.52.4600944, VMware_bootbank_net-e1000_8.0.3.1-5vmw.600.0.0.2494585, VMware_bootbank_net-e1000e_3.2.2.1-1vmw.600.1.26.3380124, VMware_bootbank_net-forcedeth_0.61-2vmw.600.0.0.2494585, VMware_bootbank_nmlx4-core_3.0.0.0-1vmw.600.0.0.2494585, VMware_bootbank_nmlx4-en_3.0.0.0-1vmw.600.0.0.2494585, VMware_bootbank_nmlx4-rdma_3.0.0.0-1vmw.600.0.0.2494585, VMware_bootbank_nvme_1.0e.0.35-1vmw.600.2.34.3620759, VMware_bootbank_ohci-usb-ohci_1.0-3vmw.600.0.0.2494585, VMware_bootbank_rste_2.0.2.0088-4vmw.600.0.0.2494585, VMware_bootbank_sata-ahci_3.0-22vmw.600.2.34.3620759, VMware_bootbank_sata-ata-piix_2.12-10vmw.600.0.0.2494585, VMware_bootbank_sata-sata-nv_3.5-4vmw.600.0.0.2494585, VMware_bootbank_sata-sata-sil24_1.1-1vmw.600.0.0.2494585, VMware_bootbank_sata-sata-sil_2.3-4vmw.600.0.0.2494585, VMware_bootbank_scsi-aacraid_1.1.5.1-9vmw.600.0.0.2494585, VMware_bootbank_scsi-adp94xx_1.0.8.12-6vmw.600.0.0.2494585, VMware_bootbank_scsi-aic79xx_3.1-5vmw.600.0.0.2494585, VMware_bootbank_scsi-fnic_1.5.0.45-3vmw.600.0.0.2494585, VMware_bootbank_scsi-ips_7.12.05-4vmw.600.0.0.2494585, VMware_bootbank_scsi-megaraid-mbox_2.20.5.1-6vmw.600.0.0.2494585, VMware_bootbank_scsi-megaraid-sas_6.603.55.00-2vmw.600.0.0.2494585, VMware_bootbank_scsi-megaraid2_2.00.4-9vmw.600.0.0.2494585, VMware_bootbank_scsi-mptsas_4.23.01.00-9vmw.600.0.0.2494585, VMware_bootbank_vsan_6.0.0-2.52.4590152, VMware_bootbank_vsanhealth_6.0.0-3000000.3.0.2.52.4527730, VMware_bootbank_xhci-xhci_1.0-3vmw.600.2.52.4600944, VMware_locker_tools-light_6.0.0-2.43.4192238

   VIBs Skipped: VMW_bootbank_ima-qla4xxx_2.02.18-1vmw.650.0.0.4564106, VMW_bootbank_net-nx-nic_5.0.621-5vmw.650.0.0.4564106, VMW_bootbank_net-tg3_3.131d.v60.4-2vmw.650.0.0.4564106, VMW_bootbank_scsi-qla4xxx_5.01.03.2-7vmw.650.0.0.4564106
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Much better. Let&amp;rsquo;s issue the reboot:&lt;br&gt;
&lt;code&gt;[root@vsphere-sap01:~] reboot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&amp;hellip; and validate the version after the system comes back online:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@vsphere-sap01:~] vmware -v
VMware ESXi 6.5.0 build-18678235
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Since it&amp;rsquo;s been two years since this cluster had any attention, there must be patches that should be applied. Since the host is already in maintenance mode with the guests hosted elsewhere, let&amp;rsquo;s take advantage and use the GUI to patch this system.&lt;/p&gt;
&lt;p&gt;Once all the patching and rebooting is finished, exit maintenance mode:&lt;br&gt;
&lt;code&gt;[root@vsphere-sap01:~] esxcli system maintenanceMode set --enable false&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Forcibly Remove Computer from Domain</title>
        <link>http://localhost:1313/posts/forcibly-remove-domain-membership/</link>
        <pubDate>Thu, 04 Nov 2021 20:52:28 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/forcibly-remove-domain-membership/</guid>
        <description>&lt;p&gt;I ran into an issue earlier this week where I had to remove a computer from a particular domain&amp;hellip; but the domain no longer existed. This meant that I couldn&amp;rsquo;t provide &amp;lsquo;domain admin&amp;rsquo; credentials to nicely remove the computer and join it back to WORKGROUP.&lt;/p&gt;
&lt;p&gt;Fortunately, this can be done from the command prompt via. WMI.&lt;br&gt;
I started by logging into the computer as a local administrator.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;start /B /W wmic.exe /interactive:off ComputerSystem Where &amp;#34;Name=&amp;#39;%computername%&amp;#39;&amp;#34; Call UnJoinDomainOrWorkgroup FUnjoinOptions=0
start /B /W wmic.exe /interactive:off ComputerSystem Where &amp;#34;Name=&amp;#39;%computername%&amp;#39;&amp;#34; Call JoinDomainOrWorkgroup name=&amp;#34;WORKGROUP&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After a reboot, the computer was no longer a domain member, but a member of WORKGROUP.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Removing GIT History</title>
        <link>http://localhost:1313/posts/git-remove-history/</link>
        <pubDate>Tue, 02 Nov 2021 20:16:01 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/git-remove-history/</guid>
        <description>&lt;p&gt;I was training a colleague on using git last week with my Powershell script repository. When I reviewed the git history, I realized that there were lots of entries that were no longer necessary: primarily scripts that I deleted because they were obsolete, or never moved past development. I wanted to find a way to purge all entries related to these files from the git repository.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git filter-branch --index-filter &amp;quot;git rm -rf --cached --ignore-unmatch FILEPATH&amp;quot; HEAD&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This took about a dozen minutes to walk through my approx. 400 commits. Each commit has to be checked, and then removed if it referenced the file.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Managing Mailbox moves in Exchange 2016</title>
        <link>http://localhost:1313/posts/exchange-move-request/</link>
        <pubDate>Thu, 28 Oct 2021 08:54:40 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/exchange-move-request/</guid>
        <description>&lt;p&gt;I manage a 5-server Exchange 2016 DAG at my workplace. Recently, I needed to migrate about 60 users from one database to another. I happen to hate the browser-based Exchange Administration Console (EAC) because it&amp;rsquo;s not very helpful - there&amp;rsquo;s no way to see the status for many &amp;ldquo;in progress&amp;rdquo; tasks, and &lt;em&gt;cancelling&lt;/em&gt; a task generally means you have no way of knowing if was completely cancelled, or partially cancelled&amp;hellip; &lt;strong&gt;very frustrating!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I have a love for Powershell, so I fired up the EMC - hurrah!&lt;br&gt;
The default number of active migrations is configurable via. Powershell, but I really don&amp;rsquo;t like changing server defaults if there&amp;rsquo;s another way to accomplish what I want. Changing server defaults means that there&amp;rsquo;s one more configuration variation that needs to be tracked in case I need to rebuild a server, or add another server to the DAG.&lt;/p&gt;
&lt;p&gt;Generally speaking, I like to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Migrate all mailboxes&lt;/li&gt;
&lt;li&gt;Suspend all Move Requests&lt;/li&gt;
&lt;li&gt;Have Powershell report on the status of the migration every 30 seconds:
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;While&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-MoveRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;InProgress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Clear-Host&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MoveRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;InProgress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MoveRequestStatistics&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;sort &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PercentComplete&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Descending&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Start-Sleep&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Seconds&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;30&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Open a second EMC instance and have Powershell ensure there are 5 migrations happening concurrently. If there aren&amp;rsquo;t, resume another one:
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;While&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-MoveRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;suspended&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-gt&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-MoveRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;inprogress&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-lt&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-MoveRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;suspended&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Resume-MoveRequest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nb&#34;&gt;Start-Sleep&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Seconds&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;300&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I also like to make sure that Indexing is disabled when migrating mailboxes: &lt;code&gt;Set-MailboxDatabase tier3-d -IndexEnabled:$false&lt;/code&gt;&lt;br&gt;
This helps to speed up the process, since Exchange isn&amp;rsquo;t trying to index the mailbox as the move is occurring.&lt;/p&gt;
&lt;p&gt;If you don&amp;rsquo;t disable the indexing, you may see your migration slow to a crawl, with the error &lt;code&gt;StalledDueToTarget_ContentIndexing&lt;/code&gt;. Oof.&lt;/p&gt;
&lt;p&gt;After the move is complete, be sure to enable Indexing again, or your users won&amp;rsquo;t be able to search: &lt;code&gt;Set-MailboxDatabase tier3-d -IndexEnabled:$true&lt;/code&gt;&lt;br&gt;
Then, validate that Indexing is set correctly on all the databases: &lt;code&gt;Get-MailboxDatabase | Select Name,IndexEnabled&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Linux Upskill Challenge</title>
        <link>http://localhost:1313/posts/linux-upskill-challenge/</link>
        <pubDate>Thu, 28 Oct 2021 08:54:12 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/linux-upskill-challenge/</guid>
        <description>&lt;p&gt;I recently completed the &lt;a class=&#34;link&#34; href=&#34;https://reddit.com/r/linuxupskillchallenge&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Linux Upskill Challenge&lt;/a&gt;, a month-long, self-paced, self-led course curated on Reddit. It&amp;rsquo;s hands-on and is best run with a publically accessible remote server, so that you&amp;rsquo;re mimicing a production server that your organization might host online. (There&amp;rsquo;s &lt;em&gt;less pressure&lt;/em&gt; in administering a server that&amp;rsquo;s only locally available!)&lt;/p&gt;
&lt;p&gt;These are my thoughts and notes about each day&amp;rsquo;s content - not formal study notes, but informal jot notes on the things I found interesting and important.&lt;/p&gt;
&lt;h1 id=&#34;rlinuxupskillschallenge&#34;&gt;/r/linuxupskillschallenge
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Day 0 - Getting Started&lt;/strong&gt;&lt;br&gt;
Created new Azure Ubuntu VM. Used SSH key for authentication.&lt;br&gt;
Azure returned a .PEM file. Kitty won&amp;rsquo;t take this - I had to use puttygen.exe to load the PEM and output a PPK. I then created a Kitty profile using this PPK (Connection -&amp;gt; SSH -&amp;gt; Auth) and username &lt;code&gt;azureuser&lt;/code&gt; (Connection -&amp;gt; Data -&amp;gt; Autologin username)&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://docs.bitnami.com/azure/faq/get-started/connect-ssh/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://docs.bitnami.com/azure/faq/get-started/connect-ssh/&lt;/a&gt;&lt;br&gt;
&lt;em&gt;&lt;strong&gt;linux is case-sensitive&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 1 - Getting Connected&lt;/strong&gt;&lt;br&gt;
Log in with Windows Terminal (Powershell): &lt;code&gt;ssh -i .\Downloads\Ubuntu_SSH.pem azureuser@23.96.4.131&lt;/code&gt;&lt;br&gt;
&lt;code&gt;uname -a&lt;/code&gt; shows some server/OS information&lt;br&gt;
&lt;code&gt;uptime&lt;/code&gt; shows the uptime&lt;br&gt;
&lt;code&gt;free&lt;/code&gt; shows memory information&lt;br&gt;
&lt;code&gt;df -h&lt;/code&gt; shows disk space information&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 2 - Navigation&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;cd&lt;/code&gt; and &lt;code&gt;cd ~&lt;/code&gt; do the same thing - return you to your home directory&lt;br&gt;
&lt;code&gt;man&lt;/code&gt; brings up the manual/help for commands&lt;br&gt;
&lt;code&gt;pushd&lt;/code&gt; is a way to create a trail of where you&amp;rsquo;ve been. &lt;code&gt;dirs -v&lt;/code&gt; will list the trail easily. &lt;code&gt;popd&lt;/code&gt; will move you around the stack of directories&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 3 - Working as Administrator&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;/etc/shadow&lt;/code&gt; is where the hashed passwords are kept&lt;br&gt;
&lt;code&gt;sudo&lt;/code&gt; will let you run a command as root&lt;br&gt;
&lt;code&gt;sudo -i&lt;/code&gt; will pop an interactive sudo session if you&amp;rsquo;ve a number of commands to run. &lt;code&gt;logoff&lt;/code&gt; or &lt;code&gt;exit&lt;/code&gt; will bring you back. The command prompt will change from &lt;code&gt;$&lt;/code&gt; to &lt;code&gt;#&lt;/code&gt; to show you&amp;rsquo;re running as sudo.&lt;br&gt;
All sudo uses are logged in &lt;code&gt;/var/log/auth.log&lt;/code&gt;&lt;br&gt;
&lt;code&gt;sudo hostnamectl set-hostname XXXX&lt;/code&gt; will change the hostname of the server&lt;br&gt;
&lt;code&gt;timedatectl&lt;/code&gt; will adjust the time/date settings. &lt;code&gt;TAB&lt;/code&gt; will autocomplete and/or show other subsequent commands&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 4 - Package Management &amp;amp; File Structure&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;apt&lt;/code&gt; is the Ubuntu package manager for working with applications&lt;br&gt;
&lt;code&gt;apt search &amp;quot;search term&amp;quot;&lt;/code&gt; will find matching packages&lt;br&gt;
&lt;code&gt;apt list --installed&lt;/code&gt; will list all installed packages&lt;br&gt;
&lt;code&gt;apt install &amp;quot;packagename&amp;quot;&lt;/code&gt; will install the package&lt;br&gt;
Linux uses a different tree structure than Windows.&lt;br&gt;
&lt;code&gt;/&lt;/code&gt; is the mountpoint - this is eqivalent to C:\&lt;br&gt;
&lt;code&gt;/root&lt;/code&gt; is the home directory for the root user&lt;br&gt;
&lt;code&gt;/usr/&lt;/code&gt; is where user directories are kept&lt;br&gt;
&lt;code&gt;/var&lt;/code&gt; is where variable files are stored. &lt;code&gt;/var/log&lt;/code&gt; is primarily where logs are stored.&lt;br&gt;
&lt;code&gt;/bin&lt;/code&gt; is where binary files (non-system level) are stored&lt;br&gt;
&lt;code&gt;/sbin&lt;/code&gt; is where system-level binaries are stored&lt;br&gt;
&lt;code&gt;/etc&lt;/code&gt; is where most configuration files are stored&lt;br&gt;
&lt;code&gt;/etc/passwd&lt;/code&gt; is the file containing userids, SSIDs and passwords&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 5 - Less&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;less&lt;/code&gt; is similar to &lt;code&gt;more&lt;/code&gt;, except it doesn&amp;rsquo;t read the whole file at load. In &lt;code&gt;less&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;G&lt;/code&gt; skips to the end&lt;/li&gt;
&lt;li&gt;&lt;code&gt;g&lt;/code&gt; skipts to the beginning&lt;/li&gt;
&lt;li&gt;&lt;code&gt;q&lt;/code&gt; quits&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The bash shell stores your command history, writing it all to /usr/azureuser/.bash_history (files beginning with a &lt;code&gt;.&lt;/code&gt; are hidden). &lt;code&gt;history&lt;/code&gt; will list the contents of the file and allow you to manipulate it. Pressing &lt;code&gt;up&lt;/code&gt; or &lt;code&gt;down&lt;/code&gt; will navigate the history from the prompt.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 6 - vi and vim&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;vi&lt;/code&gt; is the classic unix editor. On most modern *nix systems, &lt;code&gt;vi&lt;/code&gt; is an alias for &lt;code&gt;vim&lt;/code&gt; - vi improved.&lt;br&gt;
&lt;code&gt;h, j, k, l&lt;/code&gt; act as the arrow keys within vim, although modern vim instances also have support for the arrow keys&lt;br&gt;
&lt;em&gt;vi&lt;/em&gt; has two modes: normal mode and insert mode. insert mode actually allows editing of what&amp;rsquo;s on the screen, while normal mode is used for inputing commands. &lt;code&gt;esc esc&lt;/code&gt; will always return to normal mode.&lt;br&gt;
Many vi commands are made from an operator and a motion. For example, &lt;code&gt;dw&lt;/code&gt; will delete (&lt;code&gt;d&lt;/code&gt;) a word (&lt;code&gt;w&lt;/code&gt;). Quick list of motions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; will jump to the next word&lt;/li&gt;
&lt;li&gt;&lt;code&gt;e&lt;/code&gt; will jump to the end of the current word&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$&lt;/code&gt; will jump to the end of the line&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Typing a number before a motion will repeat it that many times&lt;br&gt;
&lt;code&gt;u&lt;/code&gt; will undo actions &lt;br&gt;
&lt;code&gt;x&lt;/code&gt; will delete the character your cursor is on &lt;br&gt;
&lt;code&gt;i&lt;/code&gt; (insert), &lt;code&gt;a&lt;/code&gt; (append), &lt;code&gt;c&lt;/code&gt; (change), &lt;code&gt;r&lt;/code&gt; (replace) &lt;br&gt;
&lt;code&gt;ce&lt;/code&gt; will delete the remaining letters in the current word, after the cursor&lt;br&gt;
&lt;code&gt;c$&lt;/code&gt; will delete the remaining text in the line&lt;br&gt;
&lt;code&gt;33dd&lt;/code&gt; will cut the line 33 times (equivalent to deleting 33 rows). They can be pasted wherever your cursor is with &lt;code&gt;p&lt;/code&gt;&lt;br&gt;
&lt;code&gt;gg&lt;/code&gt; will jump to the start of the file, while &lt;code&gt;G&lt;/code&gt; will jump to the end.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:s/old/new&lt;/code&gt; will substitute &amp;rsquo;new&amp;rsquo; for the first instance of &amp;lsquo;old&amp;rsquo; in the current line&lt;/li&gt;
&lt;li&gt;&lt;code&gt;:s/old/new/g&lt;/code&gt; will substitute &amp;rsquo;new&amp;rsquo; for all instances of &amp;lsquo;old&amp;rsquo; in the current line&lt;/li&gt;
&lt;li&gt;&lt;code&gt;#,#s/old/new/g&lt;/code&gt; will substitute &amp;rsquo;new&amp;rsquo; for all instances of &amp;lsquo;old&amp;rsquo; between the two line numbers provides&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%s/old/new/g&lt;/code&gt; will substitute &amp;rsquo;new&amp;rsquo; for all instances of &amp;lsquo;old&amp;rsquo; in the file&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;/SEARCHTERM&lt;/code&gt; will search for the first instance of the searchterm in the file. &lt;code&gt;n&lt;/code&gt; will jump to the next instance&lt;br&gt;
&lt;code&gt;%&lt;/code&gt; while on any bracket/parenthesis will jump to its match&lt;br&gt;
&lt;code&gt;v&lt;/code&gt; starts a Visual selection. Then use an operator (ie. &lt;code&gt;:w&lt;/code&gt; to write the selected text to a file)&lt;br&gt;
&lt;code&gt;:r FILENAME&lt;/code&gt; will merge the contents of FILENAME into the open file.&lt;br&gt;
&lt;code&gt;:r !ls&lt;/code&gt; will merge the output of &lt;code&gt;ls&lt;/code&gt; into the current file.&lt;br&gt;
&lt;code&gt;:!COMMAND&lt;/code&gt; will execute an external program in vi. For example &lt;code&gt;:!ls&lt;/code&gt; will print the directory listing.&lt;br&gt;
&lt;code&gt;:q!&lt;/code&gt; will quit without saving&lt;br&gt;
&lt;code&gt;:w&lt;/code&gt; will write/save the file with the current file name. &lt;code&gt;:w FILENAME&lt;/code&gt; will save it with the specified filename.&lt;br&gt;
&lt;code&gt;:wq&lt;/code&gt; will save and quit&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 7 - Server &amp;amp; Services&lt;/strong&gt;&lt;br&gt;
install apache2 (&lt;em&gt;httpd&lt;/em&gt;)&lt;br&gt;
stop the apache service: &lt;code&gt;sudo systemctl stop apache2&lt;/code&gt;&lt;br&gt;
start the apache service: &lt;code&gt;sudo systemctl start apache2&lt;/code&gt;&lt;br&gt;
check the status: &lt;code&gt;sudo systemctl status apache2&lt;/code&gt;. This pulls information from the logs.&lt;br&gt;
Application configuration is controlled by files under the &lt;code&gt;/etc&lt;/code&gt; directory for most Linux distros. The Apache config is in &lt;code&gt;/etc/apache2/apache2.conf&lt;/code&gt;&lt;br&gt;
In /etc/apache2/apache2.conf there&amp;rsquo;s the line with the text: &lt;code&gt;IncludeOptional conf-enabled/*.conf&lt;/code&gt; This tells Apache that the *.conf files in the subdirectory conf-enabled should be merged in with those from &lt;code&gt;/etc/apache2/apache2.conf&lt;/code&gt; at load.&lt;br&gt;
The location of the default webpage is defined by the &lt;em&gt;DocumentRoot&lt;/em&gt; parameter in the file &lt;code&gt;/etc/apache2/sites-enabled/000-default.conf&lt;/code&gt; &amp;hellip; in this case, it&amp;rsquo;s &lt;code&gt;/var/www/html&lt;/code&gt;, so &lt;code&gt;/var/www/html/index.html&lt;/code&gt;&lt;br&gt;
&lt;code&gt;sudo apt update&lt;/code&gt;, then &lt;code&gt;sudo apt upgrade&lt;/code&gt; will install all upgraded packages for any software that&amp;rsquo;s been installed with the apt package manager.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 8 - &lt;em&gt;grep&lt;/em&gt; and others&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 9 - networking &amp;amp; ports&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ss&lt;/code&gt; is the replacement for the &lt;code&gt;netstat&lt;/code&gt; comment. &lt;code&gt;ss -ltpn&lt;/code&gt; will print the open ports. (use &lt;code&gt;sudo&lt;/code&gt; for it to list the Processes that control these listeners)&lt;br&gt;
&lt;code&gt;iptables&lt;/code&gt;, &lt;code&gt;nftables&lt;/code&gt; and &lt;code&gt;ufw&lt;/code&gt; are all firewall utilities for Linux.&lt;br&gt;
&lt;code&gt;sudo iptables -L&lt;/code&gt; will list firewall rules in place.&lt;br&gt;
Set UFW rules to allow SSH but deny HTTP: &lt;code&gt;sudo ufw allow ssh; sudo ufw deny http&lt;/code&gt;&lt;br&gt;
Enable UFW: &lt;code&gt;sudo ufw enable&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 10 - scheduled tasks&lt;/strong&gt;&lt;br&gt;
see your scheduled tasks with &lt;code&gt;crontab -l&lt;/code&gt;, or &lt;em&gt;root&lt;/em&gt; with &lt;code&gt;sudo crontab -l&lt;/code&gt;&lt;br&gt;
&lt;code&gt;/etc/cron&lt;/code&gt; lists the timing of daily, weekly &amp;amp; monthly jobs that run from &lt;code&gt;/etc/cron.daily&lt;/code&gt;, &lt;code&gt;etc/cron.weekly&lt;/code&gt;, etc.&lt;br&gt;
&lt;code&gt;systemd&lt;/code&gt; starts and stops services, but can also be used to run tasks via. timers: &lt;code&gt;systemctl list-timers&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 11 - finding things&lt;/strong&gt;&lt;br&gt;
&lt;em&gt;locate&lt;/em&gt; will search an index for &lt;code&gt;&amp;quot;*something*&amp;quot;&lt;/code&gt; by default. The index is built by a nightly &lt;code&gt;cron&lt;/code&gt; job but can be updated with &lt;code&gt;sudo updatedb&lt;/code&gt;&lt;br&gt;
&lt;em&gt;find&lt;/em&gt; will try to match a file(s) based on criteria: &lt;code&gt;find /var -name access.log&lt;/code&gt; or &lt;code&gt;find /home -mtime -3&lt;/code&gt; (find any file under /home modified in the last 3 days)&lt;br&gt;
&lt;em&gt;grep&lt;/em&gt; will search within plaintext files for specific text. &lt;code&gt;grep -R -i &amp;quot;PermitRootLogin&amp;quot; /etc/*&lt;/code&gt; will search recursively through /etc/ for files containing the case-insensitive string &amp;lsquo;permitrootlogin&amp;rsquo;&lt;br&gt;
&lt;em&gt;which&lt;/em&gt; will list the patch from  the PATH statement that a utility runs from: &lt;code&gt;which nano&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 12 - transferring things&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;winscp&amp;gt; open sftp://azureuser@23.96.4.131 -privatekey=&amp;quot;c:\users\gbeifuss\downloads\ubuntu_ssh.ppk&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 13 - permissions&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;ls -l&lt;/code&gt; will list permissions: owner(user), group, others&lt;br&gt;
&lt;code&gt;chmod u-w filename.txt&lt;/code&gt; will remove the W permission for the user&lt;br&gt;
&lt;code&gt;chmod g-w filename.txt&lt;/code&gt; will remove the W permission for the group&lt;br&gt;
&lt;code&gt;chmod o-w filename.txt&lt;/code&gt; will remove the W permission for others&lt;br&gt;
&lt;code&gt;chmod u+w filename.txt&lt;/code&gt; will add the W permission for the user&lt;br&gt;
&lt;code&gt;groups&lt;/code&gt; will list the groups a user belongs to&lt;br&gt;
&lt;code&gt;groupadd&lt;/code&gt; will add a new group (&lt;code&gt;sudo groupadd newgroup&lt;/code&gt;)&lt;br&gt;
&lt;code&gt;usermod -a -G group username&lt;/code&gt; will add &lt;em&gt;username&lt;/em&gt; to &lt;em&gt;group&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 14 - users &amp;amp; groups&lt;/strong&gt;&lt;br&gt;
Add a new user with &lt;code&gt;sudo adduser helen&lt;/code&gt;. (If not prompted by a password, set one for helen: &lt;code&gt;sudo passwd helen&lt;/code&gt;)&lt;br&gt;
Login as helen: &lt;code&gt;sudo su helen&lt;/code&gt;&lt;br&gt;
Permissions for &lt;em&gt;sudo&lt;/em&gt; are controlled by the &lt;code&gt;visudo&lt;/code&gt; utility&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 15 - repositories&amp;hellip;&lt;/strong&gt;&lt;br&gt;
Linux versions control the versions of applications that can be installed. Ubuntu 18.04 ships with Apache 2.4.29 - even if you install apache with &lt;em&gt;apt&lt;/em&gt; 5 years later, you&amp;rsquo;ll get 2.4.29 installed. (Security patches are made to repositories, but by backporting fixes (from fixed versions) into older versions).&lt;br&gt;
&lt;code&gt;/etc/apt/sources.list&lt;/code&gt; is the default &lt;em&gt;apt&lt;/em&gt; repository source. This can be edited to enable &lt;em&gt;multiverse/universe&lt;/em&gt; repositories, which &amp;ldquo;*may contain software which has been classified as non-free &amp;hellip; and may not include security updates&amp;rdquo;.&lt;br&gt;
Ubuntu 20.04 ships with 99589 packages (&lt;code&gt;apt-cache dump | grep &amp;quot;Package:&amp;quot; | wc -l&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 16 - archiving &amp;amp; compressing&lt;/strong&gt;&lt;br&gt;
Unlike Windows, Linux gathers content in one step, and compresses in another.&lt;br&gt;
&lt;code&gt;tar&lt;/code&gt; stands for &amp;lsquo;Tape ARchive&amp;rsquo;&lt;br&gt;
&lt;code&gt;tar -cvf myinits.tar /etc/init.d&lt;/code&gt; takes a snapshof of the files currently in &lt;em&gt;/etc/init.d&lt;/em&gt;&lt;br&gt;
This file can then be compressed: &lt;code&gt;gzip myinits.tar&lt;/code&gt;, which will create &lt;code&gt;myinits.tar.gz&lt;/code&gt;, a &lt;em&gt;tarball&lt;/em&gt;. Tarballs often use the extension .tgz&lt;br&gt;
&lt;em&gt;.bz2&lt;/em&gt; files use a different compression than &lt;em&gt;gzip&lt;/em&gt; - it uses higher compression, but takes longer. A &lt;em&gt;.bz2&lt;/em&gt; file can only contain a single file, so it&amp;rsquo;s usually used to futher compress a tarball or other archive.
In practice, these two steps can be condensed into on: &lt;code&gt;tar -cvzf myinits.tgz /etc/init.d&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;c = create&lt;/li&gt;
&lt;li&gt;v = verbose&lt;/li&gt;
&lt;li&gt;z = zip/compress&lt;/li&gt;
&lt;li&gt;f = specify the output file&lt;/li&gt;
&lt;li&gt;x = extract (expand)&lt;/li&gt;
&lt;li&gt;j = uncompress a &lt;em&gt;.bz2&lt;/em&gt; file first&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Day 17 - from the source&lt;/strong&gt;&lt;br&gt;
&lt;em&gt;build-essential&lt;/em&gt; is a standard bundle of complilers and similar tools: &lt;code&gt;sudo apt install build-essential&lt;/code&gt;&lt;br&gt;
Download the latest nmap: &lt;code&gt;wget -v https:/nmap.org/dist/nmap-7.92.tar.bz2&lt;/code&gt;&lt;br&gt;
Extract the files: &lt;code&gt;tar -jxvf nmap-7.92.tarb.bz2&lt;/code&gt;&lt;br&gt;
&lt;code&gt;./configure&lt;/code&gt;  is a script which checks the server&lt;br&gt;
&lt;code&gt;make&lt;/code&gt; complies the software, typically via the GNU complier &lt;em&gt;gcc&lt;/em&gt;&lt;br&gt;
&lt;code&gt;sudo make install&lt;/code&gt; will take the compiled files, install them plus documentation, and in some cases setup services and scheduled tasks.&lt;br&gt;
Any software installed outside of &lt;em&gt;apt&lt;/em&gt; won&amp;rsquo;t be updated by &lt;code&gt;apt update&lt;/code&gt;, so new releases and security fixes need to be manually tracked.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 18 - log rotation&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;logrotate&lt;/code&gt; is used by &lt;em&gt;cron&lt;/em&gt; to rotate logs (&lt;em&gt;/etc/cron.daily/logrotate&lt;/em&gt;), (&lt;em&gt;/etc/logrotate.conf&lt;/em&gt; + &lt;em&gt;/etc/logrotate.d&lt;/em&gt;)&lt;br&gt;
For example, edit &lt;em&gt;/etc/logrotate.d/apache2&lt;/em&gt; to adjust the configuration for all apache logs.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Day 19 - inodes, symlinks and other shortcuts&lt;/strong&gt;&lt;br&gt;
Linux disks use &lt;em&gt;ext3&lt;/em&gt;, &lt;em&gt;ext4&lt;/em&gt;, &lt;em&gt;zfs&lt;/em&gt;, or perhaps&lt;em&gt;ntrfs&lt;/em&gt;. Above that sits the VFS - Linux Virtual FileSystem&lt;br&gt;
Each filename points to an inode (a numerical value), which is seen most easily in two places: &lt;code&gt;ls -i&lt;/code&gt; and &lt;code&gt;stat&lt;/code&gt;:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-linux&#34; data-lang=&#34;linux&#34;&gt;ls -li /etc/hosts
 35356766 -rw------- 1 root root 260 Nov 25 04:59 /etc/hosts
 
stat /etc/hosts
 File: `/etc/hosts&amp;#39;
 Size: 260           Blocks: 8           IO Block: 4096   regular file
 Device: 2ch/44d     Inode: 35356766     Links: 1
 Access: (0600/-rw-------)  Uid: (  0/   root)   Gid: (	0/	root)
 Access: 2012-11-28 13:09:10.000000000 +0400
 Modify: 2012-11-25 04:59:55.000000000 +0400
 Change: 2012-11-25 04:59:55.000000000 +0400
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Several filenames could point to the same inode, and have the same contents/permissions/ownerships.dates. These attributes are stored at the inode level, &lt;em&gt;hard links&lt;/em&gt;.
&lt;code&gt;ln&lt;/code&gt; is used to create hard and symbolic links (symlinks):&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-linux&#34; data-lang=&#34;linux&#34;&gt;ln /etc/passwd link1
ln -s /etc/passwd link2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Hard links:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;point to files, not directories&lt;/li&gt;
&lt;li&gt;can&amp;rsquo;t reference a file on another disk/volume&lt;/li&gt;
&lt;li&gt;link references work even if it is moved&lt;/li&gt;
&lt;li&gt;refer to physical locations/inodes on disk&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Symbolic links (symlinks):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;can link to directories&lt;/li&gt;
&lt;li&gt;can reference files/directories on another disk/volume&lt;/li&gt;
&lt;li&gt;remain if the original file is deleted&lt;/li&gt;
&lt;li&gt;will NOT reference the file anymore if it&amp;rsquo;s moved&lt;/li&gt;
&lt;li&gt;reference abstract names and not physical locations&lt;/li&gt;
&lt;li&gt;have their own inode&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Day 20 - scripts&lt;/strong&gt;&lt;br&gt;
Scripts are regular files with the X permission &lt;code&gt;chmod +x filename&lt;/code&gt;&lt;br&gt;
Scripts typically start with &lt;code&gt;#!/bin/bash&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Hugo &amp; Google Analytics</title>
        <link>http://localhost:1313/posts/hugo-google-analytics/</link>
        <pubDate>Tue, 05 Oct 2021 14:54:15 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-google-analytics/</guid>
        <description>&lt;p&gt;Hugo has integrated support (via. Internal Templates) for Google Analytics. An internal template adds support for some very common use cases on static websites. For example: Google Analytics, Disqus comments, Google News, and Twitter Cards. Internal templates certainly exist in v.0.87 and higher, but I&amp;rsquo;m not sure when support for them was first added. If your install of Hugo is out of date, now might be a good time to update it.&lt;/p&gt;
&lt;p&gt;The first step, is to sign up for Google Analytics and adding your particular site (aka. &lt;em&gt;property&lt;/em&gt;), if you&amp;rsquo;ve not done so already. I&amp;rsquo;ll wait while you do that&amp;hellip;
&lt;em&gt;&amp;hellip;twiddles thumbs&amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Next, we need to find the Measurement ID (previously, &lt;em&gt;Tracking ID&lt;/em&gt;) that Google has assigned to the property that you have setup.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Click Admin&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Data Streams&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Click on your property from the list&lt;/li&gt;
&lt;li&gt;Measurement ID should appear in the upper-right portion of the panel&lt;/li&gt;
&lt;li&gt;Copy or make a note of the Measurement ID&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The Measurement ID should have the format &lt;code&gt;G-HMPAE821CR&lt;/code&gt;. The ID is unique! With this in hand, let&amp;rsquo;s tell Hugo to use it for all our webpages.&lt;/p&gt;
&lt;p&gt;Open the &lt;code&gt;config&lt;/code&gt; file. (This will be located in the root directory of your Hugo site. The &lt;code&gt;config&lt;/code&gt; file can be variety of different formats - mine is YAML so it&amp;rsquo;s named &lt;code&gt;config.yaml&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;There will be a line that looks something like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# GA Tracking ID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;googleAnalytics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Add the Measurement ID that you&amp;rsquo;d previously noted to the &lt;code&gt;googleAnalytics:&lt;/code&gt; field:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# GA Tracking ID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;googleAnalytics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;G-HMPAE821CR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Save the file.&lt;/p&gt;
&lt;p&gt;That’s really all you have to do to set the Google Analytics Tracking ID in Hugo. My theme - &lt;a class=&#34;link&#34; href=&#34;https://docs.stack.jimmycai.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;hugo-stack-theme&lt;/a&gt;] - automatically has support for this internal template, so my site started sending tracking data to Google Analytics right away.&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;An article I referenced when figuring this out was:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://cloudywithachanceofdevops.com/posts/2018/05/17/setting-up-google-analytics-on-hugo/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Setting Up Google Analytics on Hugo&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>VS Code &amp; Markdown</title>
        <link>http://localhost:1313/posts/vscode-markdown-trailing-whitespace/</link>
        <pubDate>Tue, 05 Oct 2021 09:51:28 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/vscode-markdown-trailing-whitespace/</guid>
        <description>&lt;p&gt;VS Code automatically trims any trailing whitespace in a file, which makes sense for a lot of formats, but in markdown, a double trailing whitespace has special meaning - it acts as a &lt;code&gt;LF&lt;/code&gt; and creates a line break without a hard return (&lt;code&gt;CRLF&lt;/code&gt;).
This automatic trim also occurs when formatting a file according to the language&amp;rsquo;s rules.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s configure VS Code to continue automatically trimming trailing whitespace, &lt;em&gt;except&lt;/em&gt; for markdown files:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open the Command Palette (View, Command Palette…. or CTRL+SHIFT+P)&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Preferences: Open Settings (JSON)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Add the snippet:
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[markdown]&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;#34;files.trimTrailingWhitespace&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;Save &lt;code&gt;settings.json&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>Working with JSON in Powershell</title>
        <link>http://localhost:1313/posts/powershell-json/</link>
        <pubDate>Mon, 04 Oct 2021 15:47:05 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-json/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve recently been editing a Powershell script that manages our Let&amp;rsquo;s Encrypt certificates and their integration with Netscaler. I&amp;rsquo;ve been using John Billeken&amp;rsquo;s excellent &lt;a class=&#34;link&#34; href=&#34;https://github.com/j81blog/GenLeCertForNS&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GenLeCertForNS&lt;/a&gt; script to do the heavy lifting, but I&amp;rsquo;ve written a front-end wrapper for it to handle the way I need it to work in my environment. [I started using this with &lt;em&gt;v.2.63&lt;/em&gt;, which didn&amp;rsquo;t have email capabilities. My front-end wrapper adds email reporting, plus obfuscuating any credentials in the log, and loading the credentials from an encypted XML file].
I was rewriting my wrapper to include SAN support &lt;em&gt;and&lt;/em&gt; to update two Netscaler appliances with the same certificate: if the CN matched certain values, the script will find the same Let&amp;rsquo;s Encrypt certificate .pfx, upload it to the Netscaler at our warm Disaster Recovery site and properly bind it.&lt;/p&gt;
&lt;p&gt;To do that, I needed to make a number of API calls to Netscaler, which I generally discuss in my article &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/netscaler-api/&#34; &gt;Powershell &amp;amp; Netscaler API&lt;/a&gt;. This time, I needed to pass specific parameters in JSON format in order to link and unlink the certificate from others in the chain.&lt;/p&gt;
&lt;p&gt;According to the &lt;a class=&#34;link&#34; href=&#34;https://developer-docs.citrix.com/projects/citrix-adc-nitro-api-reference/en/12.1/configuration/ssl/sslcertkey/sslcertkey/#link&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Citrix ADC NITRO API Reference&lt;/a&gt;, I need:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;**URL:** http://&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;Citrix-ADC-IP-address&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;NSIP&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;/nitro/v1/config/sslcertkey?action=link  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;**HTTP Method:** POST  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;**Request Headers:** Cookie:NITRO_AUTH_TOKEN=&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tokenvalue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; Content-Type:application/json  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;**Request Payload:**
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;sslcertkey&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;certkey&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s2&#34;&gt;&amp;#34;linkcertkeyname&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is a JSON format. While I could just use a straight string (ie. &lt;code&gt;$string=&amp;quot;{&amp;quot;sslcertkey&amp;quot;:{&amp;quot;linkcertkeyname&amp;quot;:&amp;quot;Sectigo RSA CA 2018&amp;quot;,&amp;quot;certkey&amp;quot;:&amp;quot;sts.agricorp.com&amp;quot;}}&amp;quot;)&lt;/code&gt;) or a multiline string (ie. &lt;code&gt;$string=&amp;quot;@TEXT@&amp;quot;&lt;/code&gt;), I figured that I should take the effort to learn a bit about taking an object and converting it to JSON.&lt;/p&gt;
&lt;p&gt;My initial attempts to get this working were all wrong. I finally managed to get the key/value pairs properly written to a hashtable, and then converted it to JSON.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;certkey&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CertificateCertKeyName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;linkcertkeyname&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$IntermediateCACertKeyName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$hashtablePayload&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sslcertkey&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$jsonPayload&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertTo-Json&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-InputObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$hashtablePayload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Depth&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Compress&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The output of &lt;code&gt;$jsonPayload&lt;/code&gt; looks like this:&lt;br&gt;
&lt;code&gt;{&amp;quot;sslcertkey&amp;quot;:{&amp;quot;linkcertkeyname&amp;quot;:&amp;quot;Sectigo RSA CA 2018&amp;quot;,&amp;quot;certkey&amp;quot;:&amp;quot;sts.company.com&amp;quot;}}&lt;/code&gt;&lt;br&gt;
&amp;hellip;perfectly formatted JSON that I can pass through to the Netscaler:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$URI&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://netscaler03.corp.company.com/nitro/v1/config&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;X-NITRO-USER&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$netscalerID&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-NITRO-PASS&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$netscalerPwd&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$hashtablePayload&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$hashtablePayload&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sslcertkey&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;certkey&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CertificateCertKeyName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;linkcertkeyname&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$IntermediateCACertKeyName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$jsonPayload&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertTo-Json&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-InputObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$hashtablePayload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Depth&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Compress&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$response&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;POST&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$uri&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;`/sslcertkey?action=link&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$JsonPayload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Cisco Management Tunnel - ASA Configuration</title>
        <link>http://localhost:1313/posts/cisco-management-tunnel-asa/</link>
        <pubDate>Fri, 24 Sep 2021 10:12:43 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/cisco-management-tunnel-asa/</guid>
        <description>&lt;p&gt;This is part 3 of a 3-part series.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel/&#34; &gt;Cisco Management Tunnel&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel-ndes/&#34; &gt;Cisco Management Tunnel - NDES Setup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Cisco Management Tunnel - ASA Setup&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you&amp;rsquo;ve stuck with me so far, now we come to the payoff - a working Management Tunnel! Let&amp;rsquo;s jump in.&lt;/p&gt;
&lt;p&gt;This article is based on my jot notes. There may be missing steps or information, although I&amp;rsquo;ve tried my best to make sure everything is here, at least at a high-level. I use a mix of CLI and ASDM when working on the ASA, so be prepared to jump around a little.&lt;/p&gt;
&lt;h2 id=&#34;requirements&#34;&gt;Requirements
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Requires ASA 9.0.1 (or later) and ASDM 7.10.1 (or later)&lt;/li&gt;
&lt;li&gt;Connects whenever the user initiated VPN tunnel is disconnected, before or after user login. The Management VPN tunnel is not established when a trusted network is detected by the Trusted Network Detection (TND) feature or when an AnyConnect software update is in progress.&lt;/li&gt;
&lt;li&gt;Disconnects whenever the user initiates a VPN tunnel, before or after user login.&lt;/li&gt;
&lt;li&gt;Uses only machine store certificate authentication.&lt;/li&gt;
&lt;li&gt;Requires split-tunneling configuration, by default, to avoid impacting user initiated network communication (since the management VPN tunnel is meant to be transparent to the end user).&lt;/li&gt;
&lt;li&gt;Works with backup server list.&lt;/li&gt;
&lt;li&gt;Currently available only on Windows and macOS. Linux support will be added in subsequent releases.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;install-certificates&#34;&gt;Install Certificates
&lt;/h2&gt;&lt;p&gt;If you don&amp;rsquo;t already have your Issuing CA certificate installed on the ASA, you&amp;rsquo;ll need to do that. I used the ASDM: Device Management &amp;gt; Certificate Management &amp;gt; CA Certificates. We can import it directly from the NDES/SCEP server we just set up by clicking &amp;lsquo;Add&amp;rsquo; and entering the proper information. It should be something like: &lt;code&gt;http://10.0.0.1/certsrv/mscep/mscep.dll&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: We will need two Profiles - one for Users to authenticate to and get the certificate, and one for the actual Management Tunnel&lt;/em&gt;. I&amp;rsquo;ll call it the User Tunnel just to be clear, and we&amp;rsquo;ll work on it first.&lt;/p&gt;
&lt;h2 id=&#34;create-a-new-vpn-connection-profile&#34;&gt;Create a new VPN Connection Profile
&lt;/h2&gt;&lt;p&gt;Create a new VPN Connection profile on the ASA via. ASDM. I called mine &amp;ldquo;Helpdesk&amp;rdquo;, since that&amp;rsquo;s who my pilot testers will be. I don&amp;rsquo;t want to mess around with the production VPN that 100+ users are connected to!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Set the Authentiction method &lt;code&gt;AAA and certificate&lt;/code&gt;.
&lt;ul&gt;
&lt;li&gt;Also configure the AAA Server group. You can use LOCAL, or if you&amp;rsquo;re tied into another authentication service for MFA, like RSA, you can select it.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Configure DHCP, DNS and the domain name&lt;/li&gt;
&lt;li&gt;Enable SCEP Enrollment (Advanced\General)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;set-group-policy-to-use-scep&#34;&gt;Set Group Policy to use SCEP
&lt;/h2&gt;&lt;p&gt;The Group Policy will need to be edited as well. Either edit an existing one, or create a new one and associate it with the previously created Connection Profile.
I did this via. CLI, under a group policy named Helpdesk:
group-policy Helpdesk attributes
scep-forwarding-url value &lt;a class=&#34;link&#34; href=&#34;http://server.corp.company.com/certsrv/mscep/mscep.dll&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://server.corp.company.com/certsrv/mscep/mscep.dll&lt;/a&gt;
exit
I prefer the CLI for this because it gives instant feedback about the success or failure. If you happen to disregard the requirement that NDES is NOT installed on your CA, then this step will repeatedly fail. &amp;hellip;Or so I&amp;rsquo;ve heard :)&lt;/p&gt;
&lt;h2 id=&#34;edit-client-profile&#34;&gt;Edit Client Profile
&lt;/h2&gt;&lt;p&gt;These next steps are best done in the ASDM, because the output is XML files. CLI cannot manipulate them directly.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open the Client Profile that you&amp;rsquo;ll use for the User Tunnel - mine is called &amp;lsquo;Helpdesk&amp;rsquo;.&lt;/li&gt;
&lt;li&gt;Open the &lt;em&gt;Preferences (Part 2)&lt;/em&gt; page.
&lt;ul&gt;
&lt;li&gt;Enable &amp;lsquo;Automatic VPN Policy&amp;rsquo;&lt;/li&gt;
&lt;li&gt;Add your internal Trusted DNS Domains and Servers. If you have multiple, separate them with commas.&lt;/li&gt;
&lt;li&gt;Trusted Network Policy = Disconnect&lt;/li&gt;
&lt;li&gt;Untrusted Network Policy = Connect&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open the &lt;em&gt;Certificate Enrolment&lt;/em&gt; page.
&lt;ul&gt;
&lt;li&gt;Enable Certificate Enrollment&lt;/li&gt;
&lt;li&gt;Set the Certificate Expiration Threshold (days).&lt;/li&gt;
&lt;li&gt;Enter &lt;code&gt;%USER%&lt;/code&gt; or &lt;code&gt;%MACHINEID%&lt;/code&gt; in the Name (CN) box. Either will work, but will affect whom the certificate is issued to (machine name or user id), which in turn will affect how the endpoint shows up in the VPN monitoring logs.&lt;/li&gt;
&lt;li&gt;Enter whatever you&amp;rsquo;d like under Department, but we will reuse this entry later on. I chose &lt;code&gt;AnyConnect&lt;/code&gt; for the sake of simplicity.&lt;/li&gt;
&lt;li&gt;Enter your domain name in the CA Domain field: &lt;code&gt;corp.company.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Enter the keysize. I recommend &lt;code&gt;2048&lt;/code&gt;, which is what NDES should be expecting in the certificate request.&lt;/li&gt;
&lt;li&gt;Complete any other certificate fields you&amp;rsquo;d like as they&amp;rsquo;re optional, but nice to have completed.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open the &lt;em&gt;Certificate Matching&lt;/em&gt; page.
&lt;ul&gt;
&lt;li&gt;Click &amp;lsquo;Add&amp;rsquo; under the &amp;lsquo;Distinguished Name (Max 10)&amp;rsquo; section.&lt;/li&gt;
&lt;li&gt;Select OU in the Name drop down box. Then type in the value you entered for OU in the last step (under Certificate Enrollment) ito the Pattern field. For me, it’s &lt;code&gt;AnyConnect&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Ensure &amp;lsquo;Match Case&amp;rsquo; is enabled. Click OK and you’ll see the entry appear under &amp;lsquo;Distinguished Name (Max 10)&amp;rsquo;.&lt;/li&gt;
&lt;li&gt;Click OK as we&amp;rsquo;re done. This process will allow the ASA to select the correct cert during authentication.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;create-the-management-tunnel-group-group-policy&#34;&gt;Create the Management Tunnel Group, Group Policy
&lt;/h2&gt;&lt;p&gt;Back to the CLI! We&amp;rsquo;ll create a Management Tunnel Profile, and link it to our existing Split-Tunnel list. &lt;em&gt;Please note, the Profile name is case-sensitive!&lt;/em&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;group-policy Management internal
group-policy Management attributes
 dns-server value 192.168.1.23 192.168.1.24
 vpn-tunnel-protocol ssl-client
 split-tunnel-policy tunnelspecified
 split-tunnel-network-list value VPNSplitTunnelList
 default-domain value corp.agricorp.com
 client-bypass-protocol enable
 address-pools value SSLVPNDHCP
 anyconnect-custom ManagementTunnelAllAllowed value Value

tunnel-group Management type remote-access
tunnel-group Management general-attributes
 default-group-policy Management
tunnel-group Management webvpn-attributes
 group-alias Management enable
 group-url https://vpn.company.com/Management enable
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &amp;lsquo;Client Bypass Protocol&amp;rsquo; needs to be enabled if you don&amp;rsquo;t have BOTH IPv4 and IPv6 address pools configured to issue IP addresses. If you only have IPv4, like me, then the Client Bypass Protocol must be enabled. If it’s not, and the everything else is configured correctly, you’ll see the Management Connection State show as &amp;ldquo;Disconnected (invalid VPN configuration)&amp;rdquo;&lt;/p&gt;
&lt;h2 id=&#34;create-the-management-tunnel-profile&#34;&gt;Create the Management Tunnel Profile
&lt;/h2&gt;&lt;p&gt;Back to ASDM! Add an AnyConnect Client Profile under Remote Access VPN &amp;gt; Network (Client) Access &amp;gt; AnyConnect Client Profile:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enter a Profile Name&lt;/li&gt;
&lt;li&gt;Select &amp;lsquo;AnyConnect Management VPN Profile&amp;rsquo; from the Profile Usage dropdown box. The resulting profile will have an &lt;code&gt;.vpnm&lt;/code&gt; extension.&lt;/li&gt;
&lt;li&gt;Select the previously created User VPN Group Policy. In my case, it&amp;rsquo;s &lt;code&gt;Helpdesk&lt;/code&gt;. This associates the two policies, and when a user authenticates to &lt;code&gt;Helpdesk&lt;/code&gt;, it&amp;rsquo;ll download the Management Tunnel profile as well.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now, edit the Management VPN Profile:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open the &lt;em&gt;Preferences (Part 2)&lt;/em&gt; page. Per Cisco: &amp;ldquo;For a consistent user experience, we recommend that you use identical Trusted Network Detection settings in both user and management VPN tunnel profiles.&amp;rdquo;
&lt;ul&gt;
&lt;li&gt;Enable &amp;lsquo;Automatic VPN Policy&amp;rsquo;&lt;/li&gt;
&lt;li&gt;Add your internal Trusted DNS Domains and Servers. If you have multiple, separate them with commas.&lt;/li&gt;
&lt;li&gt;Trusted Network Policy = Disconnect&lt;/li&gt;
&lt;li&gt;Untrusted Network Policy = Connect&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open the &lt;em&gt;Certificate Matching&lt;/em&gt; page.
&lt;ul&gt;
&lt;li&gt;Click &amp;lsquo;Add&amp;rsquo; under the &amp;lsquo;Distinguished Name (Max 10)&amp;rsquo; section.&lt;/li&gt;
&lt;li&gt;Select OU in the Name drop down box. Then type in the value you entered for OU in the last step (under Certificate Enrollment) ito the Pattern field. For me, it’s &lt;code&gt;AnyConnect&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Ensure &amp;lsquo;Match Case&amp;rsquo; is enabled. Click OK and you’ll see the entry appear under &amp;lsquo;Distinguished Name (Max 10)&amp;rsquo;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open the &lt;em&gt;Server List&lt;/em&gt; page.
&lt;ul&gt;
&lt;li&gt;Click Add. Enter a Display Name (which doesn&amp;rsquo;t seem to actually be used anywhere else).&lt;/li&gt;
&lt;li&gt;Under FQDN, enter the same value that&amp;rsquo;s in your User Tunnel - vpn.company.com for example.&lt;/li&gt;
&lt;li&gt;Under User Group, enter the Management VPN Tunnel Alias (configured under the Management Tunnel Group). In my case, it&amp;rsquo;s &lt;code&gt;Management&lt;/code&gt; .&lt;br&gt;
&lt;img src=&#34;http://localhost:1313/img/asdm-management-profile-server-list.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/li&gt;
&lt;li&gt;Click OK until you&amp;rsquo;re back at the main ASDM page, then click Apply to write the changes.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At this point, everything should be setup. Let&amp;rsquo;s test.&lt;/p&gt;
&lt;h2 id=&#34;management-tunnel-behaviour&#34;&gt;Management Tunnel Behaviour
&lt;/h2&gt;&lt;p&gt;Load AnyConnect and establish a connection to your User Tunnel as usual. After successfully connecting, the ASA will contact the NDES for certificate enrollment on your behalf. After a few seconds, AnyConnect will issue a notice:
popup-certificate-enrollment-succeeded.png)
Click OK to acknowledge the notice. AnyConnect will indeed disconnect you and try to re-establish a connection. You can either authenticate and establish a User Tunnel, or click Cancel. If you click Cancel, AnyConnect will take a few minutes to perform Trusted Network Detection, determine you&amp;rsquo;re not on the corporate network, then transparently establish the Management Tunnel using your certificate. You can see the Management Tunnel status in the AnyConnect client Statistics:
&lt;img src=&#34;http://localhost:1313/img/anyconnect-information-window-management-tunnel-connected.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;br&gt;
When you connect back to a User Tunnel, the Management Tunnel will disconnect and show &lt;code&gt;Disconnected (user tunnel active)&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;behind-the-scenes&#34;&gt;Behind The Scenes
&lt;/h2&gt;&lt;p&gt;AnyConnect actually grabs 2 certificates based on your VPN username and stores them in &lt;code&gt;Local User Certificates\Personal\Certificates&lt;/code&gt; and &lt;code&gt;Local Machine Certificates\Personal\Certificates&lt;/code&gt;. If you created a standard certificate template, NDES issues them with a 1 year validity period. However, AnyConnect inspects the &amp;lsquo;Date Issued&amp;rsquo; field and compares the age to the value set under &lt;code&gt;Certificate Expiration Threshold (days)&lt;/code&gt;. If the value = 2, then if the certificate is older than 2 days, AnyConnect will request another certificate the next time a VPN session is established.&lt;/p&gt;
&lt;p&gt;If you need to delete your certificates during testing and pilot use:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;Stop the Cisco AnyConnect service&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open up the certificates mmc (mmc.exe). Add both the Current User plugin and the Current Machine plugin.&lt;/li&gt;
&lt;li&gt;Delete the certificate in Local User Certificates\Personal\Certificates&lt;/li&gt;
&lt;li&gt;Delete the certificate in Local Machine Certificates\Personal\Certificates&lt;/li&gt;
&lt;li&gt;Start the Cisco AnyConnect service again&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I also had to adjust the Dynamic Access Policy in use by the User Profile. We were checking for the presence of a certain AV product, but it was causing problems. Now we don&amp;rsquo;t check that, but check for other things.&lt;/p&gt;
&lt;p&gt;I also originally set &lt;code&gt;anyconnect-custom-data ManagementTunnelAllAllowed Value true/true&lt;/code&gt; based on another article I&amp;rsquo;d read, but this is not necessary.&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;Some articles I referenced when figuring this out were:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://technook.home.blog/2019/07/11/cisco-anyconnect-managent-vpn-tunnel-microsoft-ca/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cisco AnyConnect Management VPN Tunnel (Microsoft CA)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.cisco.com/c/en/us/support/docs/security/adaptive-security-appliance-asa-software/215442-configure-anyconnect-management-vpn-tunn.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Configure AnyConnect Management VPN Tunnel on ASA&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Cisco Management Tunnel - NDES Setup</title>
        <link>http://localhost:1313/posts/cisco-management-tunnel-ndes/</link>
        <pubDate>Fri, 24 Sep 2021 08:25:46 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/cisco-management-tunnel-ndes/</guid>
        <description>&lt;p&gt;This is part 2 of a 3-part series.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel/&#34; &gt;Cisco Management Tunnel&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Cisco Management Tunnel - NDES Setup&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel-asa/&#34; &gt;Cisco Management Tunnel - ASA Setup&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since an AnyConnect Management Tunnel seems like it will help resolve my organization&amp;rsquo;s work-from-home challenges, let&amp;rsquo;s setup a pilot.&lt;/p&gt;
&lt;p&gt;The first thing we need to do is configure the certificates that are needed for user authentication.&lt;/p&gt;
&lt;h2 id=&#34;install-and-configure-ndes&#34;&gt;Install and Configure NDES
&lt;/h2&gt;&lt;p&gt;We already have a dedicated server running AD Certificate Services (AD CS), acting as our Certificate Authority (CA). Network Device Enrollment Service (NDES) acts as a registration authority for a CA using Simple Certificate Enrollment Protocol (SCEP). The CA has to fully trust the NDES to verify inbound certificate requests. The result is that NDES owns an extremely powerful type of certificate (Exchange Enrollment Agent (Offline request)), which allows NDES to request certificates with almost any subject from the CA. All of that to say, it&amp;rsquo;s important to secure NDES as much as warranted.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The most important advice I can give is to pay attention to the warning that &lt;strong&gt;NDES cannot run on a CA Server&lt;/strong&gt;!&lt;/em&gt;
Don&amp;rsquo;t ask me how I know.&lt;/p&gt;
&lt;p&gt;I decided to piggyback NDES on an existing Windows 2016 server we have, so I was able to use Powershell for most of the heavy lifting. I usually roll with Powershell 7, but there are steps that require Powershell 5.1. I&amp;rsquo;ll try to be clear about when Powershell 5.1 is needed.&lt;/p&gt;
&lt;h3 id=&#34;create-gmsa&#34;&gt;Create gMSA
&lt;/h3&gt;&lt;p&gt;Let&amp;rsquo;s start by creating (and testing the creation of) the gMSA:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ADServiceAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NDES-gMSA&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DNSHostName&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NDES-gMSA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;corp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PrincipalsAllowedToRetrieveManagedPassword&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SERVER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Enter-PSSession&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;corpca&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-WindowsFeature&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;RSAT-AD&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-ADServiceAccount&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NDES-gMSA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Test-ADServiceAccount&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NDES-gMSA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;install-ndes&#34;&gt;Install NDES
&lt;/h3&gt;&lt;p&gt;You can&amp;rsquo;t install NDES as a gMSA, but we&amp;rsquo;ll convert it later. I&amp;rsquo;m going to use my admin account for the initial installation, and convert it to a gMSA later. You cannot initially install it as a gMSA. Let&amp;rsquo;s install the NDES role first:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Install-AdcsNetworkDeviceEnrollmentService -Force -ServiceAccountName &amp;#34;CORP\admin&amp;#34; -ServiceAccountPassword &amp;#34;System.Security.SecureString&amp;#34; -RAName &amp;#34;SERVER-MSCEP-RA&amp;#34; -RAEmail &amp;#34;helpdesk@company.com&amp;#34; -RACompany &amp;#34;Company&amp;#34; -RADepartment &amp;#34;IT-CNS&amp;#34; -RACity &amp;#34;Guelph&amp;#34; -RAState &amp;#34;Ontario&amp;#34; -RACountry &amp;#34;CA&amp;#34; -SigningProviderName &amp;#34;Microsoft Strong Cryptographic Provider&amp;#34; -SigningKeyLength &amp;#34;2048&amp;#34; -EncryptionProviderName &amp;#34;Microsoft Strong Cryptographic Provider&amp;#34; -EncryptionKeyLength &amp;#34;2048&amp;#34; -CAConfig &amp;#34;corpca.corp.company.com\Company Corporate Issuing CA&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;configure-iis&#34;&gt;Configure IIS
&lt;/h3&gt;&lt;p&gt;Now, add the installation account to the IIS_IUSRS group:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-LocalGroupMember&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Group&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IIS_IUSRS&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Member&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;corp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;corp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NDES-gMSA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Since NDES was installed on a server with the Web Enrollment server role, the IIS virtual directories won&amp;rsquo;t show. However, the site is still working and vsible under the IIS Applications, and IIS Application Pools pages. We need to use &lt;em&gt;Powershell 5.1&lt;/em&gt; to check that SSL is properly set on the MSCEP_ADMIN site by first querying the current values, then setting them:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-WebConfigurationProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-pspath&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MACHINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WEBROOT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;APPHOST&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-location&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Web&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Site&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CertSrv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mscep_admin&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-filter&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;webServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-name&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sslFlags&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-WebConfigurationProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-pspath&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MACHINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WEBROOT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;APPHOST&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-location&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Web&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Site&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CertSrv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mscep_admin&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-filter&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;webServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-name&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sslFlags&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-value&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ssl&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To return to the stock IIS settings, run this command from &lt;em&gt;Powershell 5.1&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-WebConfigurationProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-pspath&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MACHINE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WEBROOT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;APPHOST&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-location&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Web&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Site&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CertSrv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mscep_admin&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;’&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-filter&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;webServer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-name&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sslFlags&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-value&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;“&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;”&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The SCEP site (MSCEP) &lt;em&gt;must&lt;/em&gt; remain accessible via. HTTP, as that&amp;rsquo;s the only mechanism that the ASA supports.&lt;/p&gt;
&lt;h2 id=&#34;run-ndes-under-a-gmsa&#34;&gt;Run NDES under a gMSA
&lt;/h2&gt;&lt;p&gt;Next, I used the IIS GUI to change the SCEP application pool identity (which is actually the NDES Application Pool) to the gMSA (under Advanced Settings), and restarted IIS.&lt;/p&gt;
&lt;p&gt;Since we&amp;rsquo;re using a gMSA, I need to grant that account permissions to manage the private key for the certs we have, but it needs to be done via. powershell since remote GUI access doesn&amp;rsquo;t support it. I modified a script from &lt;a class=&#34;link&#34; href=&#34;https://www.codyhosterman.com/2019/06/assigning-read-access-to-windows-private-key/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Assigning Read Access to Windows Private Key&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;foreach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$certobj&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;gci &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cert&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;localmachine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;my&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;where &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;subject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-like&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;E=helpdesk*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$rsaCert&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Security.Cryptography.X509Certificates.RSACertificateExtensions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetRSAPrivateKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$CertObj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$fileName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$rsaCert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;UniqueName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$env:ALLUSERSPROFILE&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;\Microsoft\Crypto\rsa\machinekeys\&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$filename&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$permissions&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-Acl&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$path&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$rule&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new-object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;accesscontrol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;filesystemaccessrule&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;corp\ndes-gmsa$&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;read&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$permissions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;AddAccessRule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$rule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;Set-Acl&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$path&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AclObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$permissions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;get-acl&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;access&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;#*validate that the settings worked&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FileSystemRights&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FullControl&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AccessControlType&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Allow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdentityReference&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AUTHORITY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SYSTEM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IsInherited&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InheritanceFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PropagationFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FileSystemRights&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FullControl&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AccessControlType&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Allow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdentityReference&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BUILTIN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrators&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IsInherited&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InheritanceFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PropagationFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;FileSystemRights&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Synchronize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AccessControlType&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Allow&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdentityReference&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CORP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ndes-gmsa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IsInherited&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InheritanceFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PropagationFlags&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, configure NDES to use the certificate template we&amp;rsquo;ll create in the next step. I&amp;rsquo;m going to create a certificate template named &amp;lsquo;AnyConnect&amp;rsquo; for NDES to issue to my ASA via. SCEP.
Change the default GeneralTemplateProperty registry value from &amp;ldquo;IPSECIntermediateOffline&amp;rdquo; to &amp;ldquo;AnyConnect&amp;rdquo;, and set NDES to not require a password:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKLM&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOFTWARE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cryptography&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MSCEP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GeneralPurposeTemplate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;AnyConnect&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKLM&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOFTWARE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cryptography&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MSCEP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EnforcePassword&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EnforcePassword&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;create-certificate-template&#34;&gt;Create Certificate Template
&lt;/h2&gt;&lt;p&gt;Let&amp;rsquo;s create a new template to use for issuing to AnyConnect. I prefer to create new template because we can modify it in many ways not available when we just use the default &amp;lsquo;User&amp;rsquo; template.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open the Certificate Templates MMC.&lt;/li&gt;
&lt;li&gt;Make a copy of the &amp;lsquo;User&amp;rsquo; template, and configure these settings:
&lt;ul&gt;
&lt;li&gt;rename to &amp;lsquo;AnyConnect&amp;rsquo; (General tab)&lt;/li&gt;
&lt;li&gt;set OS compatibility (Compatibility tab)&lt;/li&gt;
&lt;li&gt;edit Extensions/Applition Policies and remove all entries EXCEPT Client Authentication&lt;/li&gt;
&lt;li&gt;edit Security and add the CORP\NDES-gMSA$ account. (If using the GUI to browse for this account, you may need to change the account filtering options to list gMSAs). Allow the account Enroll permission only.&lt;/li&gt;
&lt;li&gt;set Subject Name to &amp;lsquo;supply in the request&amp;rsquo;. Accept the popup notification.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Clikc OK and close the Templates MMC.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In the CA MMC, right-click Certificate Templates, select New, Certificate Template to Issue, then select AnyConnect. Your new template is now ready to issue!
Reboot the NDES server for the registry settings made earlier to take effect.&lt;/p&gt;
&lt;p&gt;Now, let&amp;rsquo;s tackle the ASA configuration in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel-asa/&#34; &gt;Cisco Management Tunnel - ASA Setup&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References
&lt;/h2&gt;&lt;p&gt;Some articles I referenced when figuring this out were:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://gsecse.wordpress.com/2015/10/06/ndes-deployment-and-troubleshooting/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;NDES Deployment and troubleshooting&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.sysadmins.lv/retired-msft-blogs/pki/setting-up-ndes-using-a-group-managed-service-account-gmsa.aspx&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Setting up NDES using a Group Managed Service Account (gMSA)&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Cisco Management Tunnel</title>
        <link>http://localhost:1313/posts/cisco-management-tunnel/</link>
        <pubDate>Fri, 24 Sep 2021 07:26:05 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/cisco-management-tunnel/</guid>
        <description>&lt;p&gt;This is part 1 of a 3-part series.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Cisco Management Tunnel&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel-ndes/&#34; &gt;Cisco Management Tunnel - NDES Setup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel-asa/&#34; &gt;Cisco Management Tunnel - ASA Setup&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When the Covid-19 pandemic started, our organization sent everyone to work from home. Of course, with everyone on VPN and not continually connected, like in the office, that&amp;rsquo;s posed some problems for login scripts, and some of our automated processes like WSUS patch deployment, NTP time sync and SCCM. I recently heard this was an issue - I&amp;rsquo;m not sure why the sysadmins didn&amp;rsquo;t raise it sooner - and did some research into ways I can address those problems for our team. We use Cisco AnyConnect for VPN, and AnyConnect has two features that seemed to meet our needs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AnyConnect Start Before Login (SBL)&lt;/strong&gt;
In essence, this forces the user to authenticate to VPN before signing to their machine with domain credentials. This would mean that a VPN connection exists before the user sign in, which should address login script issues.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AnyConnect Management VPN&lt;/strong&gt;
In this scenario, a VPN Management Tunnel would establish whenever the user/computer is disconnected from VPN. If the user reauthenticates, the Management Tunnel drops as the VPN connection is already present. Certificates are used for authentication. This would address our ability to patch machines that are powered on but not signed into VPN, and it sounds like it’d help with login scripts too.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here’s how Cisco describes the Management Tunnel feature in &lt;a class=&#34;link&#34; href=&#34;https://www.cisco.com/c/en/us/support/docs/security/adaptive-security-appliance-asa-software/215442-configure-anyconnect-management-vpn-tunn.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Configure AnyConnect Management VPN Tunnel on ASA&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Background Information&lt;/strong&gt;
&lt;em&gt;A management VPN tunnel ensures connectivity to the corporate network whenever the client system is powered up, not just when a VPN connection is established by the end-user. You can perform patch management on out-of-the-office endpoints, especially devices that are infrequently connected by the user, via VPN, to the office network. Endpoint OS login scripts that require corporate network connectivity also benefits from this feature.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;AnyConnect Management Tunnel allows administrators to have AnyConnect connected without user intervention prior to the user log in. AnyConnect Management tunnel can work in conjunction with Trusted Network Detection and therefore is triggered only when the endpoint is off-premise and disconnected from User-initiated VPN. AnyConnect Management tunnel is transparent to the end-user and disconnects automatically when the user initiates VPN.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Working of Management Tunnel&lt;/strong&gt;
&lt;em&gt;AnyConnect VPN agent service is automatically started upon system boot-up. It detects that the management tunnel feature is enabled (via the management VPN profile), therefore it launches the management client application to initiate a management tunnel connection. The management client application uses the host entry from the management VPN profile to initiate the connection. Then the VPN tunnel is established as usual, with one exception: no software update is performed during a management tunnel connection since the management tunnel is meant to be transparent to the user.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The user initiates a VPN tunnel via the AnyConnect UI, which triggers the management tunnel termination. Upon management tunnel termination, the user tunnel establishment continues as usual.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The user disconnects the VPN tunnel, which triggers the automatic re-establishment of the management tunnel.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Limitations&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;User interaction is not supported.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Certificate-based authentication through Machine Certificate Store (Windows) is only supported.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Strict Server Certificate checking is enforced.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Private Proxy is not supported.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;A public proxy is not supported (ProxyNative value is supported on platforms where Native Proxy settings are not retrieved from the browser).&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;AnyConnect Customization Scripts are not supported.&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The biggest risk I see to deploying either of these is how it might be affected by our web filtering proxy.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s really only one way to find out how/if this will work, and that&amp;rsquo;s to set it up! I&amp;rsquo;ll do that in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/cisco-management-tunnel/&#34; &gt;Cisco Management Tunnel - NDES Setup&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Installing a certificate in PowerApps</title>
        <link>http://localhost:1313/posts/powerapps-certificate/</link>
        <pubDate>Thu, 23 Sep 2021 08:43:28 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powerapps-certificate/</guid>
        <description>&lt;p&gt;My organization has a Microsoft Dynamics PowerApps-based website to allow a subset of our customers to manage their applications to us. It&amp;rsquo;s secured using HTTPS, as all good website should be. That means I need to update the certificate annually, and it&amp;rsquo;s a time-consuming process because we don&amp;rsquo;t actually own the domain that our PowerApps site is listening on. Here&amp;rsquo;s a high-level overview of what a renewal entails:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Generate a CSR&lt;/li&gt;
&lt;li&gt;Complete paperwork for our parent organization&amp;rsquo;s certificate management department:
&lt;ul&gt;
&lt;li&gt;Information about the requested certificate type, my contact information, my manager&lt;/li&gt;
&lt;li&gt;Send this to our parent company for signoff from our representative&lt;/li&gt;
&lt;li&gt;Attach the CSR to the form and send it to our parent company&amp;rsquo;s certificate management department. I don&amp;rsquo;t know why our rep. cannot sign this after we&amp;rsquo;ve submitted it to the certificate management department.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Get the new certificate&lt;/li&gt;
&lt;li&gt;Merge the CSR with the private KEY and create a PFX&lt;/li&gt;
&lt;li&gt;Upload the PFX to Netscaler
&lt;ul&gt;
&lt;li&gt;Bind to the VSRV object&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Upload to PowerApps
&lt;ul&gt;
&lt;li&gt;Bind to the proper portal&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Confirm that the certificate is now in use and working&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Honestly, getting the paperwork filled out is the hardest part of the whole process because it gets bounced around and needs to be escalated a certain way (politics). Documenting that hassle isn&amp;rsquo;t going to be useful for anyone else, so let&amp;rsquo;s focus on the technical parts.&lt;/p&gt;
&lt;h2 id=&#34;generate-a-csr&#34;&gt;Generate a CSR
&lt;/h2&gt;&lt;p&gt;I&amp;rsquo;ve used the &lt;a class=&#34;link&#34; href=&#34;https://www.certificatetools.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CertificateTools.com X509 Certificate Generator&lt;/a&gt; site in the past because it can handle SANs (Subject Alternative Name). This particular site needs 4 domains:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;company.com&lt;/li&gt;
&lt;li&gt;company.ca&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.company.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;www.company.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.company.ca&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;www.company.ca&lt;/a&gt;
I enter all of the required information and then a Certificate Request (CSR) is generated, along with the Private Key. This can also be done in openssl, if you&amp;rsquo;re worried about having the private key for your certificate generated by a server outside your control.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let&amp;rsquo;s walk through generating this with openssl! First, let&amp;rsquo;s generate the random file and set the config file:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\&amp;gt;set OPENSSL_CONF=d:\apps\OpenSSL\bin\openssl.cfg
D:\&amp;gt;set RANDFILE=.rnd
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now, enable support for SAN in your request. Edit the config file &lt;code&gt;d:\apps\OpenSSL\bin\openssl.cfg&lt;/code&gt; to add the requirement for req_ext, and add SAN/DNS names to the &lt;code&gt;req_ext&lt;/code&gt; section.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[ req_ext ]
subjectAltName = DNS: www.company.com, DNS: company.com, DNS: www.company.ca
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;rsquo;s generate the private key for this request:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\Apps\OpenSSL\bin&amp;gt;openssl genrsa -out rsa.private 2048
Generating RSA private key, 2048 bit long modulus (2 primes)
................................................................
...........................................................+++++
..........................................+++++
e is 65537 (0x010001)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then, we generate the CSR:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\Apps\OpenSSL\bin&amp;gt;openssl req -new -key rsa.private -out company.csr.txt
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &amp;#39;.&amp;#39;, the field will be left blank.
-----
Country Name (2 letter code) [CA]:
State or Province Name (full name) [Ontario]:
Locality Name (eg, city) [Port Colbourne]:
Organization Name (eg, company) [Company]:
Organizational Unit Name (eg, section) [IT-CNS]:
Common Name (e.g. server FQDN or YOUR name) []:company.com
Email Address [helpdesk@company.com]:

Please enter the following &amp;#39;extra&amp;#39; attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:

D:\Apps\OpenSSL\bin&amp;gt;openssl.exe req -noout -text -in company.csr.txt
Certificate Request:
    Data:
        Version: 1 (0x0)
        Subject: C = CA, ST = Ontario, L = Port Colbourne, O = company, OU = IT-CNS, CN = company.com, emailAddress = helpdesk@company.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:e8:cb:2a:71:99:b1:5f:17:fd:c7:db:7e:82:f9:
                    1a:a4:fc:7b:ae:d8:2b:1c:e6:06:96:8b:13:e8:77:
                    6d:28:ed:ba:5a:09:79:7b:58:32:7d:97:05:51:8c:
                    eb:ea:63:c3:c8:11:15:ce:3c:b5:6d:e3:12:22:cb:
                    8e:1d:c9:0a:01:12:2c:1a:34:59:f1:fc:48:c5:32:
                    9a:5c:93:85:e8:75:33:c2:fc:b6:3a:37:71:85:9a:
                    e7:b3:b4:f0:9c:86:b2:a1:d6:3f:49:c3:05:9c:ab:
                    1b:6b:94:f7:66:90:69:48:40:dc:cb:2e:f1:04:8a:
                    b9:4b:da:7c:34:f1:a2:a9:9b:a5:4e:41:47:0a:f9:
                    63:ff:f3:23:c0:be:01:45:92:57:48:6b:27:40:e5:
                    af:a0:fd:b1:80:5c:a4:6e:26:34:a1:1b:4e:10:c0:
                    de:3b:0e:1d:0c:48:e6:4f:0c:3a:2b:92:9c:60:6a:
                    20:35:8a:b0:c1:af:81:ae:3f:fe:c6:90:25:7d:b6:
                    09:a6:9e:47:88:dc:68:72:fe:7f:2d:4d:0f:95:77:
                    00:bf:7f:a0:8e:aa:00:98:90:32:93:ae:da:54:52:
                    79:6d:6c:d0:4e:63:fb:93:e3:c8:a9:3f:17:29:33:
                    56:1c:3c:3c:0e:29:99:23:ff:44:ac:03:de:c9:eb:
                    16:73
                Exponent: 65537 (0x10001)
        Attributes:
        Requested Extensions:
            X509v3 Subject Alternative Name:
                DNS:company.com, DNS:www.company.com, DNS:www.company.ca, DNS:company.ca
    Signature Algorithm: sha256WithRSAEncryption
         cd:39:8f:f7:9d:30:84:ab:0f:7e:60:a1:ee:bd:78:a8:ad:95:
         b0:cc:a4:df:64:8c:ec:94:9f:a1:79:36:ed:b9:74:00:8c:29:
         9b:72:d8:4b:5a:24:0a:c5:65:36:6b:8a:0d:80:24:7b:6f:f7:
         65:08:f9:60:6c:d8:58:3a:62:cd:df:e7:00:2a:7c:13:41:df:
         51:e8:32:3a:c4:55:ca:2d:1d:fb:ed:f4:43:e4:55:0a:b4:f0:
         cc:3a:ca:6d:42:70:c9:03:f5:83:b4:be:6e:e5:ce:06:70:ea:
         99:3c:59:cd:6e:75:ce:c2:c6:7b:20:32:62:3c:63:12:03:e3:
         69:5d:ab:9c:9c:be:c1:4c:be:9e:98:63:a9:5a:b0:75:25:c3:
         17:0a:47:e7:91:c4:10:01:5f:13:8f:7b:96:e1:cf:63:39:87:
         8f:e4:2f:92:02:b6:68:9a:cb:d8:aa:28:8f:b4:e7:fe:4e:18:
         83:cb:a8:9e:1e:46:72:bb:b6:f6:f1:9e:3a:b6:f9:f6:07:b6:
         69:92:0e:18:35:d4:00:48:5a:71:21:9f:61:ae:69:4d:34:d2:
         dd:d7:24:1d:7f:e9:2b:cd:a4:9b:70:82:8f:ee:8e:1a:49:43:
         a3:54:b2:e7:78:4d:47:5e:f3:08:71:d7:07:a5:af:9e:89:e0:
         bb:50:1a:1f
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;merging-the-cer-and-key-to-create-a-pfx&#34;&gt;Merging the CER and KEY to create a PFX
&lt;/h2&gt;&lt;p&gt;After sending off the CSR, I received back a certificate (CER) file from the certificate management department. This is the certificate I need, but it does not have the private key attached. If I were to import this, I&amp;rsquo;d get a notice saying that it&amp;rsquo;s missing the private key (&amp;ldquo;You do not have the private key for this certificate&amp;rdquo;). Let&amp;rsquo;s merge the KEY with the CER and generate a PFX, with everything nicely bundled together and protected by a password. Back to openssl:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\Apps\OpenSSL\bin&amp;gt;openssl pkcs12 -export -out company.pfx -inkey rsa.private -in ServerCertificate.crt
Enter Export Password:
Verifying - Enter Export Password:
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Now that I have the PFX, I can import into Netscaler and bind it to my VSRV.&lt;/p&gt;
&lt;h2 id=&#34;bind-to-powerapps&#34;&gt;Bind to PowerApps
&lt;/h2&gt;&lt;p&gt;I also have to upload this to PowerApps and bind it to the proper portal:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Launch the PowerApps Portals Admin Centre in a browser&lt;/li&gt;
&lt;li&gt;Click &amp;ldquo;Manage SSL Certificates&amp;rdquo;. You&amp;rsquo;ll see a list of certificates that PowerApps knows about.
&lt;ul&gt;
&lt;li&gt;Click &amp;ldquo;Add New&amp;rdquo;. Browse to the PFX you&amp;rsquo;d generated and upload it, along with the password.&lt;/li&gt;
&lt;li&gt;Verify your new certificate is now listed with the proper expiry date and SAN. Make a note of the Thumbprint!&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Click &amp;ldquo;Setup Custom Domains and SSL&amp;rdquo;. Under &lt;em&gt;SSL Bindings&lt;/em&gt;, you&amp;rsquo;ll see the currently bound certificate.
&lt;ul&gt;
&lt;li&gt;Delete the currently bound certificate&lt;/li&gt;
&lt;li&gt;Click &amp;ldquo;Add New&amp;rdquo; and add the certificate you&amp;rsquo;d previously uploaded.&lt;/li&gt;
&lt;li&gt;Verify the bound certificate&amp;rsquo;s Thumbprint matches what you&amp;rsquo;d previously recorded (above)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now use a tool like &lt;a class=&#34;link&#34; href=&#34;https://www.ssllabs.com/ssltest/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Qualys&amp;rsquo; SSL Server Test&lt;/a&gt; to make sure that the new certificate is actually in use.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Rewrite HTTP/1.0 requests to HTTP/1.1 with Netscaler</title>
        <link>http://localhost:1313/posts/netscaler-http1/</link>
        <pubDate>Tue, 21 Sep 2021 10:18:20 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/netscaler-http1/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve already written about &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/netscaler-internal-ip-disclosure/&#34; &gt;Remediating an Internal IP Disclosure with Netscaler&lt;/a&gt;, but I found out today that the route I&amp;rsquo;d chosen prevents Outlook from authenticating. Oops!&lt;/p&gt;
&lt;p&gt;To summarize the earlier post, Exchange was leaking an internal IP and servername when an HTTP/1.0 packet was set &lt;em&gt;without a host header&lt;/em&gt; to &lt;code&gt;/autodiscover/autodiscover.xml&lt;/code&gt;. I initially tried to fix it by deleting the WWW-Authenticate and X-FEServer headers from the replies using Netscaler.&lt;/p&gt;
&lt;p&gt;However, while that prevents the information from being leaked, it also prevents Outlook from properly loading when the traffic flows through Netscaler. In our case, internal traffic was fine, but people who rely on Outlook and autodiscover outside of our network couldn&amp;rsquo;t log in. I tested and removing the X-FEServer header permitted Outlook to load normally; it was removing the WWW-Authenticate header that caused the problem.&lt;/p&gt;
&lt;p&gt;I tried out some alternate methods of blocking an internal IP in the WWW-Authenticate field (specifically, a reply containing &lt;code&gt;basic realm=&amp;quot;10.10.10.10&lt;/code&gt;), but it seems like there&amp;rsquo;s important authentication using that field. I came up with another approach which seems to be working: Since this vulnerability is the result of a HTTP/1.0 request, rewrite HTTP/1.0 requests to HTTP/1.1. HTTP/1.1 &lt;em&gt;requires&lt;/em&gt; the host header field, which means that IIS won&amp;rsquo;t happily disclose internal IPs in response to a missing host header. HTTP/1.1 has been a standard since 1997 and there should literally be no device in the past 20 years which does not support it.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s get to work. I&amp;rsquo;ll create a rewrite policy that looks for HTTP/1.0. If it&amp;rsquo;s found, replace it with HTTP/1.1.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;add rewrite action RW_ACTION_HTTP1.0 replace HTTP.REQ.VERSION.MINOR &amp;#34;\&amp;#34;1\&amp;#34;&amp;#34;
add rewrite policy RW_POLICY_HTTP1.0 &amp;#34;HTTP.REQ.VERSION.MINOR.EQ(0)&amp;#34; RW_ACTION_HTTP1.0
bind lb vserver VSRV-Exchange-OWA-External -policyName RW_POLICY_HTTP1.0 -priority 110 -gotoPriorityExpression END -type REQUEST
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;rsquo;s test and make sure that the internal information is no longer returned:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET /autodiscover/autodiscover.xml HTTP/1.0

HTTP/1.1 400 Bad Request
Content-Type: text/html; charset=us-ascii
Server: Microsoft-HTTPAPI/2.0
Date: Tue, 21 Sep 2021 14:16:46 GMT
Connection: close
Content-Length: 334
Strict-Transport-Security: max-age=15552000

&amp;lt;!DOCTYPE HTML PUBLIC &amp;#34;-//W3C//DTD HTML 4.01//EN&amp;#34;&amp;#34;http://www.w3.org/TR/html4/strict.dtd&amp;#34;&amp;gt;
&amp;lt;HTML&amp;gt;&amp;lt;HEAD&amp;gt;&amp;lt;TITLE&amp;gt;Bad Request&amp;lt;/TITLE&amp;gt;
&amp;lt;META HTTP-EQUIV=&amp;#34;Content-Type&amp;#34; Content=&amp;#34;text/html; charset=us-ascii&amp;#34;&amp;gt;&amp;lt;/HEAD&amp;gt;
&amp;lt;BODY&amp;gt;&amp;lt;h2&amp;gt;Bad Request - Invalid Hostname&amp;lt;/h2&amp;gt;
&amp;lt;hr&amp;gt;&amp;lt;p&amp;gt;HTTP Error 400. The request hostname is invalid.&amp;lt;/p&amp;gt;
&amp;lt;/BODY&amp;gt;&amp;lt;/HTML&amp;gt;
closed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Great! The request is rejected (404) because HTTP/1.1 requires a host header, and this rewritten HTTP/1.0 request doesn&amp;rsquo;t have one.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Remediating an Internal IP Disclosure with Netscaler</title>
        <link>http://localhost:1313/posts/netscaler-internal-ip-disclosure/</link>
        <pubDate>Fri, 17 Sep 2021 15:49:45 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/netscaler-internal-ip-disclosure/</guid>
        <description>&lt;p&gt;Our security administrator sent over a few security &amp;lsquo;vulnerabilities&amp;rsquo; that had been flagged during a recent audit. One of them was a finding that one of our websites was leaking an internal IP. All I was given to track this down was the output from the auditor&amp;rsquo;s Nessus scan:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Nessus was able to verify the issue with the following request :

GET autodiscover/autodiscover.xml HTTP/1.0
Accept-Charset: iso-8859-1,utf-8;q=0.9,*;q=0.1
Accept-Language: en
Connection: Close
User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)
Pragma: no-cache
AcceptL image/gif, image/x-xbitmap, image/jpeg, impage/pjpeg, image/png, */*

Which returned the following IP address :

10.10.0.31
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;After some quick research, I learned that this is actually  &lt;strong&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.tenable.com/plugins/nessus/77026&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Microsoft Exchange Client Access Server Information Disclosure&lt;/a&gt;&lt;/strong&gt;. That it was being termed a vulnerability was pretty generous use of the term by our auditors in the PCI Compliance Report. Knowing an internal IP isn&amp;rsquo;t actually going to open the door for an attacker, but it could be useful as part of the enumeration or in a wider attack, the internal IP address might be very useful.&lt;/p&gt;
&lt;p&gt;This vulnerability is usually found in conjunction with &lt;a class=&#34;link&#34; href=&#34;https://www.tenable.com/plugins/nessus/10759&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Web Server HTTP Header Internal IP Disclosure&lt;/a&gt;, which returns the internal IP in the location field. However, a previous audit had found that and I&amp;rsquo;d remediated it. I wonder how come this first audit didn&amp;rsquo;t find the Microsoft Exchange Client Access Server Information Disclosure vulnerability? Hmm.&lt;/p&gt;
&lt;p&gt;In both of these &amp;lsquo;vulnerabilities&amp;rsquo;, an attacker can send an IIS webserver a specially-crafted HTTP 1.0 GET request, without any host header set. This causes the server to return its internal IP address in the reply. The reason for this is that the HTTP 1.0 protocol does not require the host header to be set by the client in the request. The HTTP 1.1 protocol requires the client to specify a host in the header, so is not affected.&lt;/p&gt;
&lt;p&gt;Once I sorted out &lt;em&gt;what&lt;/em&gt; I was looking for, it was time to replicate the findings, so that I can self-test that the &amp;lsquo;vulnerability&amp;rsquo; has been remediated.&lt;/p&gt;
&lt;p&gt;I love the &lt;a class=&#34;link&#34; href=&#34;https://chocolatey.org&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;chocolatey&lt;/a&gt; package manager for Powershell, especially since Windows doesn&amp;rsquo;t ship with anything useful. (WinGet seems to be what Microsoft is positioning as their Package Manager, but it&amp;rsquo;s far behind chocolatey at this point). In any case, since I have chocolatey already installed, let&amp;rsquo;s use it to download and install the openssl package:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;choco install openssl&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Wow, that was pretty easy, right? Let&amp;rsquo;s get started by opening a connection to the Exchange server using SSL/TLS:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Program Files\OpenSSL-Win64\bin&amp;gt;openssl s_client -host 206.98.14.28 -port 443

CONNECTED(00000130)
Can&amp;#39;t use SSL_get_servername
depth=1 C = GB, ST = Greater Manchester, L = Salford, O = Sectigo Limited, CN = Sectigo RSA Domain Validation Secure Server CA
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = webmail.company.com
verify return:1
---
Certificate chain
 0 s:OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = webmail.company.com
   i:C = GB, ST = Greater Manchester, L = Salford, O = Sectigo Limited, CN = Sectigo RSA Domain Validation Secure Server CA
 1 s:C = GB, ST = Greater Manchester, L = Salford, O = Sectigo Limited, CN = Sectigo RSA Domain Validation Secure Server CA
   i:C = US, ST = New Jersey, L = Jersey City, O = The USERTRUST Network, CN = USERTrust RSA Certification Authority
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIGkzCCBXugAwIBAgIQeMhcbdyCJZhuKNK1eI9BnDANBgkqhkiG9w0BAQsFADCB
jzELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4G
A1UEBxMHU2FsZm9yZDEYMBYGA1UEChMPU2VjdGlnbyBMaW1pdGVkMTcwNQYDVQQD
Ey5TZWN0aWdvIFJTQSBEb21haW4gVmFsaWRhdGlvbiBTZWN1cmUgU2VydmVyIENB
MB4XDTE5MTEwNTAwMDAwMFoXDTIxMTEwNDIzNTk1OVowZTEhMB8GA1UECxMYRG9t
YWluIENvbnRyb2wgVmFsaWRhdGVkMSEwHwYDVQQLExhQb3NpdGl2ZVNTTCBNdWx0
aS1Eb21haW4xHTAbBgNVBAMTFHdlYm1haWwuYWdyaWNvcnAuY29tMIIBIjANBgkq
hkiG9w0BAQEFAAOCAQ8AM11BCgKCAQEAzkoRlNCs5fI4iiNvh2YcaV3y3KynScoj
F7sk8frQY1iYBrQ4oLfDI2h+Np7a21kvdMyYufLzWeAz1n0EDu29/kkp8QBIVaDU
CgCNdsocnvwC41E7Qyc9wumBRNWbz0c4B7tyDvhImgBfl6IIXUe+cy/KsrqWb3Tq
mJKJ7acSBNzRcPgK8qUbUCdtNixhBRruWKjnQ7qwmzLwsRozFZGExUCms5/MX4Od
uZ5UHWGYZed+w30vu86Hy1/jf0VWeDGSAsiPUySLq55fvwClyRftN1aS9bwROrvE
sTJ1rAkR26wUFNyQi9ijkOEPCh2TqyclQNvRnokSI346ZMKKkaPpFwIDAQABo4ID
EjCCAw4wHwYDVR0jBBgwFoAUjYxexFStiuF36Zv5mwXhuAGNYeEwHQYDVR0OBBYE
FKb+bHu4DBzyNq5bUYs8Ppfr2EXFMA4GA1UdDwEB/wQEAwIFoDAMBgNVHRMBAf8E
AjAAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjBJBgNVHSAEQjBAMDQG
CysGAQQBsjEBAgIHMCUwIwYIKwYBBQUHAgEWF2h0dHBzOi8vc2VjdGlnby5jb20v
Q1BTMAgGBmeBDAECATCBhAYIKwYBBQUHAQEEeDB2ME8GCCsGAQUFBzAChkNodHRw
Oi8vY3J0LnNlY3RpZ28uY29tL1NlY3RpZ29SU0FEb21haW5WYWxpZGF0aW9uU2Vj
dXJlU2VydmVyQ0EuY3J0MCMGCCsGAQUFBzABhhdodHRwOi8vb2NzcC5zZWN0aWdv
LmNvbTA6BgNVHREEMzAxghR3ZWJtYWlsLmFncmljb3JwLmNvbYIZYXV0b2Rpc2Nv
dmVyLmFncmljb3JwLmNvbTCCAX8GCisGAQQB1nkCBAIEggFvBIIBawFpAHYAfT7y
+I//iFVoJMLAyp5SiXkrxQ54CX8uapdomX4i8NcAAAFuPDgr2gAABAMARzBFAiAi
1bJ3H3IUyTUswT99xLn8P2xHsFjAm4FjcuqpbSdgxAIhAPZOftlPa1H1jQPQ1ESb
IMox3lbDRSrPOOESq+oGMCPZAHcARJRlLrDuzq/EQAfYqP4owNrmgr7YyzG1P9Mz
lrW2gagAAAFuPDgrzgAABAMASDBGAiEAgNOhZoOzgj8DwuR516eWmpms/RmaQ61x
5z8CAnfYOL0CIQD5ODhJYisT5s7oRmqXgEzCg84dWeysi5/DjYzWvlqzFQB2AFWB
1MIWkDYBSuoLm1c8U/DA5Dh4cCUIFy+jqh0HE9MMAAABbjw4K5wAAAQDAEcwRQIg
adxDdH5iWyGh6tReXl/1t0zLEBcPwXe24St5WYnSwlcCIQC5RKhMAD63eyKpojIo
6fJocT/P6SBsfAykYhwThDFIPDANBgkqhkiG9w0BAQsFAAOCAQEAnUwWuOimEN5k
zzXFVVDFdwRYmTdnW7fzOgXnQKVmtkqAXiL0Qp05OnUq7qPJuTaOR+KaGPS0nnLN
b3/U3SimzH+tukkDZWcVch7tFzrEzpmWzighsQrzdCO0fv7SL3un7aKxQzf/u+se
iCZ5F8W40+YmZq8mW7LUdYINbtR/vGgays/7xzjWioWVjbgNsWiFdpmZ/Fch1H9q
m7UoFGNcTPDQrsg5rI2fKU/JBxWWqaUlWQ6DClhzwBp55DY3MGCoPesiiIU0HN/7
GyqwDIklkHOX6pRRmlXb5ZEK31Bo4qvwv/yolil83NL1q/Lk3C64jLmPEtH5rJy1
JaY6tu+MsA==
-----END CERTIFICATE-----
subject=OU = Domain Control Validated, OU = PositiveSSL Multi-Domain, CN = webmail.company.com

issuer=C = GB, ST = Greater Manchester, L = Salford, O = Sectigo Limited, CN = Sectigo RSA Domain Validation Secure Server CA

---
No client certificate CA names sent
Peer signing digest: SHA256
Peer signature type: RSA-PSS
Server Temp Key: ECDH, P-256, 256 bits
---
SSL handshake has read 3885 bytes and written 683 bytes
Verification error: unable to get local issuer certificate
---
New, TLSv1.3, Cipher is TLS_AES_128_GCM_SHA256
Server public key is 2048 bit
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
Early data was not sent
Verify return code: 20 (unable to get local issuer certificate)
---
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;At this point, openssl has successfully established the connection and is awaiting a case-sensitive command. Let&amp;rsquo;s send the HTTP 1.0 packet to the autodiscover URL. You may need to press ENTER a couple of times:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;GET /autodiscover/autodiscover.xml HTTP/1.0

HTTP/1.1 401 Unauthorized
Server: Microsoft-IIS/10.0
request-id: e1722265-bc09-4d32-a25e-02bf98f7d8f9
X-SOAP-Enabled: True
X-WSSecurity-Enabled: True
X-WSSecurity-For: None
X-OAuth-Enabled: True
X-OWA-Version: 15.1.2308.14
WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
X-Powered-By: ASP.NET
X-FEServer: EXCHANGE02
WWW-Authenticate: Basic realm=&amp;#34;10.1.0.31&amp;#34;
Date: Fri, 17 Sep 2021 19:04:53 GMT
Connection: keep-alive
Content-Length: 0
Strict-Transport-Security: max-age=15552000

closed
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And there it is! The internal server name and IP, in black and white. Thanks for nothing, IIS.&lt;/p&gt;
&lt;p&gt;Alright, let&amp;rsquo;s go about fixing this. Instead of fixing this in IIS with the URL-Rewrite module, I decided to use Netscaler.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The same change is made on just 2 Netscaler devices, vs. 5 Exchange servers&lt;/li&gt;
&lt;li&gt;The changes are not dependant on IIS, which may possibly be reset by patches or other installed software&lt;/li&gt;
&lt;li&gt;Netscaler is where I generally do this sort of thing (consistency leads to ease of administration)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In any case, this is what Netscaler will do:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Any replies from the Webmail object are inspected for the WWW-Authenticate header.&lt;/li&gt;
&lt;li&gt;If it’s found, the WWW-Authenticate header is deleted as well as any X-FEServer header.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I accomplished this with a couple of Responder Policies in Netscaler:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;add rewrite action RW_ACTION_OWA_FEServer delete_http_header X-FEServer
add rewrite action RW_ACTION_OWA_WWWAuthenticate delete_http_header WWW-Authenticate
add rewrite policy RW_POLICY_OWA_FEServer &amp;#34;HTTP.RES.HEADER(\&amp;#34;X-FEServer\&amp;#34;).EXISTS&amp;#34; RW_ACTION_OWA_FEServer NOREWRITE
add rewrite policy RW_POLICY_OWA_WWWAuthenticate &amp;#34;HTTP.RES.HEADER(\&amp;#34;WWW-Authenticate\&amp;#34;).EXISTS&amp;#34; RW_ACTION_OWA_WWWAuthenticate NOREWRITE

bind lb vserver VSRV-Exchange-OWA-External -policyName RW_POLICY_OWA_WWWAuthenticate -priority 100 -gotoPriorityExpression NEXT -type RESPONSE
bind lb vserver VSRV-Exchange-OWA-External -policyName RW_POLICY_OWA_FEServer -priority 110 -gotoPriorityExpression END -type RESPONSE
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;rsquo;s repeat the test and make sure that the internal information is no longer returned:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;get /autodiscover/autodiscover.xml HTTP/1.0

HTTP/1.1 401 Unauthorized
Server: Microsoft-IIS/10.0
request-id: 068763fb-67ff-4f09-8ca9-02139957f4c2
X-SOAP-Enabled: True
X-WSSecurity-Enabled: True
X-WSSecurity-For: None
X-OAuth-Enabled: True
X-OWA-Version: 15.1.2308.14
X-Powered-By: ASP.NET
Date: Fri, 17 Sep 2021 19:16:43 GMT
Connection: keep-alive
Content-Length: 0
Strict-Transport-Security: max-age=15552000

closed
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>Using multicursor in VS Code</title>
        <link>http://localhost:1313/posts/vscode-multi-cursor/</link>
        <pubDate>Mon, 13 Sep 2021 23:35:20 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/vscode-multi-cursor/</guid>
        <description>&lt;p&gt;CTRL-ALT-L enables multiple cursors in Visual Studio Code.&lt;/p&gt;
&lt;p&gt;That is all.&lt;/p&gt;
&lt;p&gt;(Technically CTRL-ALT-L is the keyboard shortcut for &amp;lsquo;Select all occurrences of current selection&amp;rsquo;. Select a word, press CTRL-ALT-L and a cursor will appear to the left of every instance of that word. It&amp;rsquo;s a useful alternative to Find/Replace.)&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Hugo error - REF_NOT_FOUND</title>
        <link>http://localhost:1313/posts/hugo-ref_not_found/</link>
        <pubDate>Mon, 13 Sep 2021 23:35:09 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-ref_not_found/</guid>
        <description>&lt;p&gt;I tried generating updated content for my website the other day and Hugo threw an error instead:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;hugo v0.88.1-5BC54738+extended windows/amd64 BuildDate=2021-09-04T09:39:19Z VendorInfo=gohugoio
ERROR 2021/09/10 14:59:54 [en] REF_NOT_FOUND: Ref &amp;#34;exchange-clustergroup.md&amp;#34;: &amp;#34;C:\myblog.dev.repo\content\post\exchange-transaction-logs.md:15:458&amp;#34;: page not found
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I went back and triplechecked my code: the formatting of the &lt;code&gt;ref&lt;/code&gt; block was proper and had no typographical errors.&lt;/p&gt;
&lt;p&gt;I finally realized that my Front Matter tag &lt;code&gt;draft:&lt;/code&gt; on the destination page was set to &lt;code&gt;true&lt;/code&gt;. This meant that when Hugo was building the code, the destination page wasn&amp;rsquo;t being generated, which meant that there was no destination page for this reference to link to.&lt;/p&gt;
&lt;p&gt;Changing the Front Matter to &lt;code&gt;draft: false&lt;/code&gt; allowed Hugo to generate the content properly.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Exchange Transaction Logs won&#39;t clear</title>
        <link>http://localhost:1313/posts/exchange-transaction-logs/</link>
        <pubDate>Thu, 09 Sep 2021 09:29:17 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/exchange-transaction-logs/</guid>
        <description>&lt;p&gt;I solved a problem today that&amp;rsquo;s been plaguing me for a two weeks now. Exchange transaction logs are a record of every single operation that changes the state of any data in the database. Adding a new item, deleting an old item, modifying an existing item - all of these  are recorded in a transaction log at the same time they&amp;rsquo;re applied to the database itself. When an Exchange database is mounted, the transaction logs are reprocessed to make sure there aren&amp;rsquo;t any discrepancies or database errors. If there are, the transaction logs are used to rebuild the database state. This same process applied to the DAG as well. The entire purpose of transaction logs in Exchange is to provide information on the transactions that occurred since the last time you ran a complete backup of your Exchange environment.&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;re using Exchange-aware backup software, Exchange will &amp;lsquo;know&amp;rsquo; when a full backup occurs and then it&amp;rsquo;ll delete all transaction logs prior to that point. They&amp;rsquo;re no longer needed for a database rebuild because there&amp;rsquo;s a backup.&lt;/p&gt;
&lt;p&gt;The problem I ran into is that the transaction logs were not being purged despite a successful backup (by our Exchange-aware software) and filled up the volume, which caused a database dismount&amp;hellip; which led to some unhappy employees. Fortunately, it was just 1 of our 6 databases and I was able to fix it within 15 minutes, so not many people even noticed an issue. I wrote about workarounds and solutions for that in &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/exchange-clustergroup/&#34; &gt;Exchange DAGs and Cluster Ownership&lt;/a&gt;. As I mentioned in that post, I believed that the root cause was that the Owner of our DAG cluster objects wasn&amp;rsquo;t the proper host. However, this wasn&amp;rsquo;t the case because the transaction logs continued to grow!&lt;/p&gt;
&lt;p&gt;The Transaction Logs for Journaling are causing the problem. Despite no old logs (they&amp;rsquo;re all timestamped AFTER our daily backup occurs, which tells me that the backup is working properly and Exchange is aware of it), they&amp;rsquo;re consuming 10+ GB more disk space each passing day. Yesterday morning they occupied 60GB, and 24 hours later they&amp;rsquo;re already consuming 84GB.&lt;/p&gt;
&lt;p&gt;I checked the Queues and found dozens of messages in the Journaling queue:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-QueueDigest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Dag&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exchange2016&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ft &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;GroupByValue&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MessageCount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DeferredMessageCount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LockedMessageCount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StaleMessageCount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Details&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;------------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-----------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;journaling&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;85&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;85&lt;/span&gt;                   &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;                  &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;                 &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exchange06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXCHANGE04&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;get-queue&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exchange04&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Identity&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;DeliveryType&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;Status&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MessageCount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Velocity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RiskLevel&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OutboundIPPool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NextHopDomain&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;------------&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;---------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;EXCHANGE04&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SmtpDeliveryToMailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ready&lt;/span&gt;  &lt;span class=&#34;mf&#34;&gt;29&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;Normal&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;              &lt;span class=&#34;n&#34;&gt;journaling&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I took a look at one of these messages via. the Exchange Toolbox\Queue Viewer GUI. This message has been stuck in the Journaling queue for &lt;em&gt;almost 30 days&lt;/em&gt; (since August 13/21):&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Identity: EXCHANGE04\4\75801877807477
Subject: Fw:&amp;#39;RE: 137396- Ray &amp;amp; Rachel Application&amp;#39;.
Internet Message ID: &amp;lt;59d5803a-273b-4123-a41f-dfb67fc6cf1e@journal.report.generator&amp;gt;
From Address: &amp;lt;&amp;gt;
Status: Retry
Size (KB): 11170
Message Source Name: Journaling
Source IP: 255.255.255.255
SCL: 0
Date Received: 8/13/2021 10:48:12 AM
Expiration Time:
Last Error: 400 4.4.7 The server responded with: 554 5.2.0 STOREDRV.Deliver.Exception:MessageSubmissionExceededException.MapiExceptionMaxSubmissionExceeded; Failed to process message due to a permanent exception with message Cannot save changes made to an item to store. 16.55847:09020000, 17.43559:0000000090000000000000000100000000000000, 20.52176:010F04890E00000000000000, 20.50032:010F04897E17103100000000, 0.35180:010F0489, 255.23226:00000000, 255.27962:0E000000, 255.31418:21000000, 16.55847:E3000000, 17.43559:0000000070010000000000000000000000000000, 20.52176:010F04890E00001080030400, 20.50032:010F04897E17F01F010F0489, 0.35180:2C000000, 255.23226:2C000000, 255.27962:0A000000, 255.27962:0C000000, 255.17082:DA040000, 0.18273:00000000, 4.21921:DA040000, 255.27962:FA000000, 255.1494:010F0489, 5.59176:0000A0004C696D69746174696F6E001005000780, 5.34600:A418B00043757272656E7453697A65000F010480, 4.42792:DA040000, 7.40748:000000000000000031343163, 7.57132:000000000000000005000780, 1.63016:0C000000, 4.39640:DA040000, 8.45434:7EFF3D197915D443BAF1677741440BB605000780, 5.10786:0000000031352E30312E323330382E3031343A45786368616E676530353A36623134316338652D663135382D346465612D616564652D3837656131656238336534310080, 255.1750:2C000000, 255.31418:2C000000, 0.21457:010F0489, 4.19665:DA040000, 0.37632:DA040000, 4.37888:DA040000 [Stage: CreateMessage]. The failure was replaced by a retry response because the message was marked for retry if rejected.
Queue ID: EXCHANGE04\4
Recipients:  Tier3M.Journaling@Company.com;3;3;[{LED=400 4.4.7 The server responded with: 554 5.2.0 STOREDRV.Deliver.Exception:MessageSubmissionExceededException.MapiExceptionMaxSubmissionExceeded; Failed to process message due to a permanent exception with message Cannot save changes made to an item to store. 16.55847:09020000, 17.43559:0000000090000000000000000100000000000000, 20.52176:010F04890E00000000000000, 20.50032:010F04897E17103100000000, 0.35180:010F0489, 255.23226:00000000, 255.27962:0E000000, 255.31418:21000000, 16.55847:E3000000, 17.43559:0000000070010000000000000000000000000000, 20.52176:010F04890E00001080030400, 20.50032:010F04897E17F01F010F0489, 0.35180:2C000000, 255.23226:2C000000, 255.27962:0A000000, 255.27962:0C000000, 255.17082:DA040000, 0.18273:00000000, 4.21921:DA040000, 255.27962:FA000000, 255.1494:010F0489, 5.59176:0000A0004C696D69746174696F6E001005000780, 5.34600:A418B00043757272656E7453697A65000F010480, 4.42792:DA040000, 7.40748:000000000000000031343163, 7.57132:000000000000000005000780, 1.63016:0C000000, 4.39640:DA040000, 8.45434:7EFF3D197915D443BAF1677741440BB605000780, 5.10786:0000000031352E30312E323330382E3031343A45786368616E676530353A36623134316338652D663135382D346465612D616564652D3837656131656238336534310080, 255.1750:2C000000, 255.31418:2C000000, 0.21457:010F0489, 4.19665:DA040000, 0.37632:DA040000, 4.37888:DA040000 [Stage: CreateMessage]. The failure was replaced by a retry response because the message was marked for retry if rejected.};{MSG=};{FQDN=};{IP=};{LRT=}];0;CN=Journaling,CN=Databases,CN=Exchange Administrative Group (FYDIBOHF23SPDLT),CN=Administrative Groups,CN=Company,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=corp,DC=Company,DC=com;0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The error is &lt;em&gt;MessageSubmissionExceededException&lt;/em&gt;, which made me suspect a size limit problem. Indeed, all 28 messages in the Journaling queue have a size &amp;gt; 10MB. Our standard maximum message size is 10GB across the organization (to discourage people from using email as a file transfer/file storage mechanism), but last month an exception was granted for one of our customer service mailboxes. That mailbox has a maximum message size of 30MB.&lt;/p&gt;
&lt;p&gt;I realized that this current problem is probably stemming from the changes made several weeks ago to allow large messages to this mailbox - they arrive there, but the Journaling process cannot handle them because the &lt;em&gt;Journal mailbox limit is still 10MB&lt;/em&gt;. The Journaling process continually tries to add them to the Journaling mailbox which causes the retry process to generate a huge volume of transaction logs. I checked the mailbox message limits to be sure the sizes matched my hypothesis:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;get-mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;contact&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;MaxSendSize&lt;/span&gt;              &lt;span class=&#34;n&#34;&gt;MaxReceiveSize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;--------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;contact&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;457&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;280&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;457&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;280&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;get-mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Tier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;              &lt;span class=&#34;n&#34;&gt;MaxSendSize&lt;/span&gt;              &lt;span class=&#34;n&#34;&gt;MaxReceiveSize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;--------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3A&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3B&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3C&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3D&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3L&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Tier3M&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;485&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;760&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I increased the max message size that Journaling mailboxes can handle:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;get-mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Tier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Set-mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-MaxReceiveSize&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;MB&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-MaxSendSize&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This flushed the 28 queued messages within 15 minutes.&lt;/p&gt;
&lt;p&gt;I then ran a pair of consecutive diskshadow backups on Exchange05, which is the server that has mounted the Journaling database. This cleared out the logs on disk within 30 minutes. Instead of taking 84GB, the logs now consume a much-more-reasonable 2GB.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Exchange DAGs and Cluster Ownership</title>
        <link>http://localhost:1313/posts/exchange-clustergroup/</link>
        <pubDate>Mon, 06 Sep 2021 22:12:49 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/exchange-clustergroup/</guid>
        <description>&lt;p&gt;We run Exchange on a multiserver DAG, which behaves similarly to a cluster. It&amp;rsquo;s built on the same principles as a cluster, but it&amp;rsquo;s technically not a cluster and is administered differently than a cluster. It&amp;rsquo;s &amp;hellip; &lt;em&gt;clusterish&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;One of the issues that we run in to occasionally is that Cluster Owner changes to another DAG member server, which causes problems with our backup software. (The backup software can&amp;rsquo;t truely handle a cluster and wants to connect to the IP of a single server). The fix is pretty simple - change the owner back to the server it should be! Powershell makes this really easy:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;H:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Move-ClusterGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;                                    &lt;span class=&#34;n&#34;&gt;OwnerNode&lt;/span&gt;                               &lt;span class=&#34;n&#34;&gt;State&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;                                    &lt;span class=&#34;p&#34;&gt;---------&lt;/span&gt;                               &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Available&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Storage&lt;/span&gt;                       &lt;span class=&#34;n&#34;&gt;EXCHANGE04&lt;/span&gt;                              &lt;span class=&#34;n&#34;&gt;Offline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cluster&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group &lt;/span&gt;                          &lt;span class=&#34;n&#34;&gt;Exchange03&lt;/span&gt;                              &lt;span class=&#34;n&#34;&gt;Offline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;H:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;                                    &lt;span class=&#34;n&#34;&gt;OwnerNode&lt;/span&gt;                               &lt;span class=&#34;n&#34;&gt;State&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;                                    &lt;span class=&#34;p&#34;&gt;---------&lt;/span&gt;                               &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Available&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Storage&lt;/span&gt;                       &lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;                              &lt;span class=&#34;n&#34;&gt;Offline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cluster&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group &lt;/span&gt;                          &lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;                              &lt;span class=&#34;n&#34;&gt;Online&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To prevent any complications with our backups, I would like:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The Owner Node to be monitored&lt;/li&gt;
&lt;li&gt;The Owner Node to be corrected to the proper values, if it&amp;rsquo;s not on Exchange05.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We run PRTG for server monitoring&amp;hellip;. Fortunately, PRTG can do this for us! The (old) article &lt;a class=&#34;link&#34; href=&#34;https://kb.paessler.com/en/topic/70294-how-can-i-monitor-with-prtg-which-node-is-active-in-a-microsoft-cluster&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Monitoring Active Cluster Nodes With PRTG&lt;/a&gt; outlines the process. I only used this as a guide, as I ended up sourcing Jannos-443&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://github.com/Jannos-443/PRTG-MSCluster-PrefNodes&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PRTG-MSCluster-PrefNodes.ps1&lt;/a&gt; script.&lt;/p&gt;
&lt;p&gt;I started by checking the Preferred Node setting for these two cluster objects:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ClusterOwnerNode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ClusterObject&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;OwnerNodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Available&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Storage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cluster&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group &lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Just peachy. Neither object has a preferred owner. Let&amp;rsquo;s fix that:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set-ClusterOwnerNode&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;corp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;agricorp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ClusterOwnerNode&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ClusterObject&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;OwnerNodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Available&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Storage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cluster&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group &lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exchange05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s better. With that out of the way, I created a new PRTG sensor to monitor that the Cluster was Owned by the Preferred Node:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Save the Cluster-checking script to &lt;code&gt;${env:ProgramFiles(x86)}\PRTG Network Monitor\Custom Sensors\EXEXML&lt;/code&gt; on the PRTG probe server.&lt;/li&gt;
&lt;li&gt;Open PRTG and browsed to the Exchange05 server object. This is the server that should be the Owner&lt;/li&gt;
&lt;li&gt;Create a new sensor. Select a sensor type &amp;ldquo;EXE/Script Advanced Sensor&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;PRTG-MSCluster-PrefNodes.ps1&lt;/code&gt; from the dropdown list. Provide the Exchange Cluster name as a parameter. In my case, I entered &lt;code&gt;Exchange2016&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Set the Security Context of the sensor to &lt;code&gt;Use Windows credentials of parent device&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Save changes. Query the sensor a couple of times to make sure that it&amp;rsquo;s working properly. When one or more nodes isn&amp;rsquo;t on the Preferred Node, then the sensor will change to &amp;lsquo;Warning&amp;rsquo;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Next, I want PRTG&amp;rsquo;s Notification action to correct the Owner of the cluster object. We&amp;rsquo;ll create a custom notification that will run a short Powershell script I wrote:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    .&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;SYNOPSIS&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    Force Cluster Owner to a specific server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    .&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;DESCRIPTION&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    https://kb.paessler.com/en/topic/40713-can-i-automatically-restart-a-windows-service-with-prtg
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    Copy this script to the main PRTG server&amp;#39;s Notifications\EXE scripts folder (${env:ProgramFiles(x86)}\PRTG Network Monitor\Notifications\EXE)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    and create a new Notification Template &amp;gt; Execute Program. Choose this script from the dropdown and provide the SERVERNAME as a parameter.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    The Credentials need to be generated under the instance that PRTG is running as (NT Authority\System). These domain creds allow PRTG
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    to remotely run code on the remote system and manipulate the Cluster Groups.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    .PARAMETER Server
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    Server FQDN or NetBIOS Name
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    .&lt;/span&gt;&lt;span class=&#34;sd&#34;&gt;EXAMPLE&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    Sample call from PRTG EXE/Script Advanced
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    PRTG-MSCluster-MoveClusterGroup.ps1 EXCHANGE01
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    Author:  Greg Beifuss
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;    7:48 AM 9/8/2021
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Server&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Import-Clixml&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\Program Files (x86)\PRTG Network Monitor\Notifications\EXE\powershell.xml&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Scriptblock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-ClusterGroup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Move-ClusterGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Node&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$env:COMPUTERNAME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-Command&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Server&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Scriptblock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Credential&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;0&#34;&gt;
&lt;li&gt;Use &lt;code&gt;Export-CLIXML&lt;/code&gt; to store credentials that can log into the destination server (in my case, Exchange05)&lt;/li&gt;
&lt;li&gt;Save this script to &lt;code&gt;${env:ProgramFiles(x86)}\PRTG Network Monitor\Notifications\EXE&lt;/code&gt;)` on the main PRTG server. This is the server that Notifications run from - the other PRTG servers simply won&amp;rsquo;t have the Notifications directory.&lt;/li&gt;
&lt;li&gt;Create a new Notification Template in PRTG. Choose &amp;lsquo;Execute Program&amp;rsquo;, and select the PRTG-MSCluster-MoveClusterGroup.ps1 script. Provide a cluster member server name as the parameter. This will be passed into the script. Save.&lt;/li&gt;
&lt;li&gt;Browse to the PRTG sensor that was previously created. Select &amp;lsquo;Notification Triggers&amp;rsquo;. Enable a State Trigger that will perform the Notification Template you just created. I used:
&lt;ul&gt;
&lt;li&gt;When sensor state is Warning for at least 60 seconds, perform PRTG-MSCluster-MoveClusterGroup&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Save &amp;amp; test.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You can see below that at 7:49ish, both the cluster object owners changed from the preferred nodes. I know this since PRTG detected this as &amp;ldquo;2&amp;rdquo;, not &amp;ldquo;1&amp;rdquo;. In any case, after the sensor had been in this state for 60 seconds, the notification task started and moved the cluser objects back to their proper &amp;lsquo;home&amp;rsquo;. The sensor value reset to &amp;ldquo;0&amp;rdquo; clusters on a non-preferred node.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/prtg-cluster.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Truncate Exchange Transaction Logs</title>
        <link>http://localhost:1313/posts/exchange-purge-vss/</link>
        <pubDate>Fri, 03 Sep 2021 21:40:09 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/exchange-purge-vss/</guid>
        <description>&lt;p&gt;I received an alert today that the disk drive with our Exchange transaction logs was low on disk space. How low? 160KB free of 190GB! In fact, it was so low that Exchange dismounted the database on that server and moved it over to another host in the DAG.&lt;/p&gt;
&lt;p&gt;Something like this is usually the result of backup problems. Exchange won&amp;rsquo;t purge transaction logs until it &lt;em&gt;knows&lt;/em&gt; that they&amp;rsquo;ve been successfully backed up, since a successful restore of backup data requires a full backup &lt;em&gt;plus&lt;/em&gt; all incremental transaction logs since then.&lt;/p&gt;
&lt;p&gt;Of course, there&amp;rsquo;s a nice little trick to tell Exchange that a full backup was just performed&amp;hellip; without actually performing a full backup. That lets Exchange start purging the transaction logs, which frees up disk space, which means Exchange can remount your database(s). It&amp;rsquo;s all thanks to the magic of VSS and DiskShadow.exe.&lt;/p&gt;
&lt;p&gt;This needs to be done in an elevated command prompt &lt;em&gt;on the server where the databases are mounted&lt;/em&gt;. If your databases and transaction logs are on different volumes, you&amp;rsquo;ll need to add both of them. In my case, Transaction Logs are on D:\ and Databases are on E:\ .&lt;/p&gt;
&lt;p&gt;At a high level:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Load diskshadow&lt;/li&gt;
&lt;li&gt;add volumes&lt;/li&gt;
&lt;li&gt;begin backup&lt;/li&gt;
&lt;li&gt;create&lt;/li&gt;
&lt;li&gt;end backup&lt;/li&gt;
&lt;li&gt;exit&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Windows\system32&amp;gt;diskshadow
Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  EXCHANGE04,  9/3/2021 2:00:14 PM

DISKSHADOW&amp;gt; add volume d:
DISKSHADOW&amp;gt; add volume e:
DISKSHADOW&amp;gt; begin backup
DISKSHADOW&amp;gt; create

Alias VSS_SHADOW_1 for shadow ID {b7d4f4f0-8293-4dbd-8bae-3901023e3e6b} set as environment variable.
Alias VSS_SHADOW_2 for shadow ID {c994095e-dbdb-4950-b285-cf73b3e5ca1a} set as environment variable.
Alias VSS_SHADOW_SET for shadow set ID {a0f96cbf-f4f2-40d9-9453-e84e6986c932} set as environment variable.

Querying all shadow copies with the shadow copy set ID {a0f96cbf-f4f2-40d9-9453-e84e6986c932}

        * Shadow copy ID = {b7d4f4f0-8293-4dbd-8bae-3901023e3e6b}               %VSS_SHADOW_1%
                - Shadow copy set: {a0f96cbf-f4f2-40d9-9453-e84e6986c932}       %VSS_SHADOW_SET%
                - Original count of shadow copies = 2
                - Original volume name: \\?\Volume{c19abc70-413e-4ea7-b4d4-1ed69c382d6f}\ [D:\]
                - Creation time: 9/3/2021 3:27:13 PM
                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy63
                - Originating machine: EXCHANGE04.company.com
                - Service machine: EXCHANGE04.company.com
                - Not exposed
                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}
                - Attributes:  Auto_Release Differential

        * Shadow copy ID = {c994095e-dbdb-4950-b285-cf73b3e5ca1a}               %VSS_SHADOW_2%
                - Shadow copy set: {a0f96cbf-f4f2-40d9-9453-e84e6986c932}       %VSS_SHADOW_SET%
                - Original count of shadow copies = 2
                - Original volume name: \\?\Volume{64abb4bb-d15b-42f9-893f-224c5a2f25a5}\ [E:\]
                - Creation time: 9/3/2021 3:27:13 PM
                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy64
                - Originating machine: EXCHANGE04.company.com
                - Service machine: EXCHANGE04.company.com
                - Not exposed
                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}
                - Attributes:  Auto_Release Differential

Number of shadow copies listed: 2

DISKSHADOW&amp;gt; end backup
DISKSHADOW&amp;gt; exit

C:\Windows\system32&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The EMC/Powershell can display the last backup that Exchange is aware of:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-MailboxDatabase&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-status&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LastFullBackup&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ft
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;       &lt;span class=&#34;n&#34;&gt;LastFullBackup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;--------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Journaling&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;06&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-C&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;07&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-D&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;06&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-A&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;43&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-M&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;43&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-X&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;43&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-L&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;35&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;06&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Tier3-B&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;34&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;An alternate trick is to delete any unmounted database copies on the server that&amp;rsquo;s out of Transaction Log space through proper Exchange methods (EAC or Powershell). Once that&amp;rsquo;s done, delete the Transaction Logs belonging to that database. It should free up a small amount of space - perhaps enough breathing room to get a database online, users up and running again, and time for you to take proper measures.&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;re running Exchange as a VM or the disks are on a SAN, you could also provision more disk space, then extend the volume.&lt;/p&gt;
&lt;p&gt;The DiskShadow/VSS method should result in the following entries in the Application Event Log. These are from Windows Server 2016:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;Event ID&lt;/th&gt;
          &lt;th&gt;Source&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer metadata preparation&lt;/td&gt;
          &lt;td&gt;2021&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer database preparation&lt;/td&gt;
          &lt;td&gt;2110&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer prepared for backup&lt;/td&gt;
          &lt;td&gt;2023&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;A Full Shadow copy was started&lt;/td&gt;
          &lt;td&gt;2005&lt;/td&gt;
          &lt;td&gt;ESE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Backup starting&lt;/td&gt;
          &lt;td&gt;960&lt;/td&gt;
          &lt;td&gt;ESE BACKUP&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Shadow copy freeze started&lt;/td&gt;
          &lt;td&gt;2001&lt;/td&gt;
          &lt;td&gt;ESE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer freezes databases&lt;/td&gt;
          &lt;td&gt;2027&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Shadow copy freeze ended&lt;/td&gt;
          &lt;td&gt;2003&lt;/td&gt;
          &lt;td&gt;ESE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchage VSS Writer freeze ended&lt;/td&gt;
          &lt;td&gt;2029&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;VSS Writer backup success&lt;/td&gt;
          &lt;td&gt;2046&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Shadow copy success&lt;/td&gt;
          &lt;td&gt;2006&lt;/td&gt;
          &lt;td&gt;ESE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer backup completion&lt;/td&gt;
          &lt;td&gt;2033&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer backup ended&lt;/td&gt;
          &lt;td&gt;2037&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Exchange VSS Writer post-backup processing&lt;/td&gt;
          &lt;td&gt;2035&lt;/td&gt;
          &lt;td&gt;MSExchangeRepl&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Tombstone table cleanup&lt;/td&gt;
          &lt;td&gt;40013&lt;/td&gt;
          &lt;td&gt;MSExchangeIS&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Tombstone table cleanup complete&lt;/td&gt;
          &lt;td&gt;40017&lt;/td&gt;
          &lt;td&gt;MSExchange IS&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;You may also see events for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Exchange VSS Writer preparation (Event ID 9811, MSExchangeIS)&lt;/li&gt;
&lt;li&gt;Logs are now purged (Event ID 224, ESE)&lt;/li&gt;
&lt;li&gt;Backup is now complete (Event ID 9780, MSExchangeIS)&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 10:03:28 AM
Event ID:      2021
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange VSS Writer has successfully collected the metadata document in preparation for backup.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 10:04:40 AM
Event ID:      2110
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange VSS Writer instance 02f75633-f3a1-4ac2-8e6e-5fb60f168e42 has successfully prepared for a full or a copy backup of database &amp;#39;Tier3-L&amp;#39;.  The following database will be backed up: Tier3-L.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 9:26:33 AM
Event ID:      2023
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange Replication service VSS Writer (Instance 39cca171-a3ed-43e5-85d4-4c66dfae6e21) successfully prepared for backup.



Log Name:      Application
Source:        ESE
Date:          9/6/2021 9:26:35 AM
Event ID:      2005
Task Category: ShadowCopy
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
Information Store - Journaling (23412,G,0,15.01.2308.014) Shadow copy instance 1 starting. This will be a Full shadow copy.

For more information, click http://www.microsoft.com/contentredirect.asp.



Log Name:      Application
Source:        ESE BACKUP
Date:          9/6/2021 9:26:40 AM
Event ID:      960
Task Category: General
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
msexchangerepl (5596) This computer is performing a surrogate backup.  The master server is Exchange04.



Log Name:      Application
Source:        ESE
Date:          9/6/2021 9:26:40 AM
Event ID:      2001
Task Category: ShadowCopy
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
Information Store - Tier3-D (37104,D,0,15.01.2308.014) Tier3-D: Shadow copy instance 1 freeze started.

For more information, click http://www.microsoft.com/contentredirect.asp.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 9:26:40 AM
Event ID:      2027
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange VSS Writer instance 39cca171-a3ed-43e5-85d4-4c66dfae6e21 has successfully frozen the databases.



Log Name:      Application
Source:        ESE
Date:          9/6/2021 9:26:42 AM
Event ID:      2003
Task Category: ShadowCopy
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
Information Store - Tier3-C (8036,G,0,15.01.2308.014) Shadow copy instance 1 freeze ended.

For more information, click http://www.microsoft.com/contentredirect.asp.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 9:26:42 AM
Event ID:      2029
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange VSS Writer instance 39cca171-a3ed-43e5-85d4-4c66dfae6e21 has successfully thawed the databases.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 10:09:08 AM
Event ID:      2046
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange Replication service VSS Writer instance 02f75633-f3a1-4ac2-8e6e-5fb60f168e42 has successfully completed the backup of database &amp;#39;Tier3-A&amp;#39;.

Database log truncation has been requested for this database. Log truncation will occur on the active copy after the next log generation is created. Log truncation will occur automatically on the passive copies after that log file is copied.



Log Name:      Application
Source:        ESE
Date:          9/6/2021 10:09:08 AM
Event ID:      2006
Task Category: ShadowCopy
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
Information Store - Tier3-A (35276,G,0,15.01.2308.014) Shadow copy instance 1 completed successfully.

For more information, click http://www.microsoft.com/contentredirect.asp.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 10:09:08 AM
Event ID:      2033
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange Replication service VSS Writer (Instance 02f75633-f3a1-4ac2-8e6e-5fb60f168e42) has successfully processed the backup completion event.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 10:09:08 AM
Event ID:      2037
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange Replication service VSS Writer (Instance 02f75633-f3a1-4ac2-8e6e-5fb60f168e42) backup has been successfully shut down.



Log Name:      Application
Source:        MSExchangeRepl
Date:          9/6/2021 9:26:42 AM
Event ID:      2035
Task Category: Exchange VSS Writer
Level:         Information
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The Microsoft Exchange Replication service VSS Writer (Instance 39cca171-a3ed-43e5-85d4-4c66dfae6e21) has successfully processed the post-snapshot event.



Log Name:      Application
Source:        MSExchangeIS
Date:          9/6/2021 9:36:15 AM
Event ID:      40013
Task Category: Logical Data Model
Level:         Warning
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The tombstone table has reached an excessive number of entries and/or total size. A maintenance task has been dispatched to perform urgent cleanup.

Database: Journaling (6b141c8e-f158-4dea-aede-87ea1eb83e41)
Number of entries (estimated): 1453
Total size of entries (estimated): 5369912232 bytes



Log Name:      Application
Source:        MSExchangeIS
Date:          9/6/2021 9:36:26 AM
Event ID:      40017
Task Category: Logical Data Model
Level:         Warning
Keywords:      Classic
User:          N/A
Computer:      Exchange04.company.com
Description:
The urgent tombstone table cleanup task has finished executing.

Database: Journaling (6b141c8e-f158-4dea-aede-87ea1eb83e41)
Message tombstones deleted: 134
Subobject tombstones deleted: 1315
Total size of deleted entries: 5358535877 bytes
Remaining number of entries (estimated): 4
Total size of remaining entries (estimated): 11376355 bytes
Elapsed time: 11.1328017 seconds
Pass completed: True
Subobjects in-use: 4
Mailboxes quarantined: 0
Mailboxes locked: 0
Mailboxes should stop maintenance: 0
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>Page References in Hugo</title>
        <link>http://localhost:1313/posts/hugo-references/</link>
        <pubDate>Thu, 02 Sep 2021 07:37:44 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-references/</guid>
        <description>&lt;p&gt;There are special shortcodes that tell Hugo to generate the proper link(s) to other pages in your site, or other sections on the current page.&lt;/p&gt;
&lt;p&gt;I originally learned this when I wanted to include a link to another post I&amp;rsquo;d written. I used a &lt;em&gt;reference&lt;/em&gt; shortcode (&lt;code&gt;ref&lt;/code&gt;) for this:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[Querying PowerPlatform API via. Powershell]( {{&amp;lt; ref &amp;quot;powershell-powerplatform-api.md&amp;quot; &amp;gt;}})&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Links to other artifacts in your site can be done with &lt;code&gt;ref&lt;/code&gt; (reference) or &lt;code&gt;relref&lt;/code&gt; (relative reference). The only difference between them is whether the resulting URL is absolute (&lt;a class=&#34;link&#34; href=&#34;http://site.com/about/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://site.com/about/&lt;/a&gt;) or relative (/about/). The &lt;em&gt;ref&lt;/em&gt; and &lt;em&gt;relref&lt;/em&gt; shortcodes require a single parameter: the path to a content document, with or without a file extension, with or without an anchor. Hugo will try to match the parameter to content in your site. The &lt;em&gt;relref&lt;/em&gt; shortcode is handy when you have two pages with the same name, but in different locations, so that Hugo knows which one you want to refer to.&lt;/p&gt;
&lt;p&gt;Links to a heading on the current page, or a completely difference page, can be specified with an &lt;em&gt;anchor&lt;/em&gt;, which are specified with a pound/hashtag symbol (#).&lt;br&gt;
Link to a heading on the current page: &lt;code&gt;{{&amp;lt; ref &amp;quot;#reference&amp;quot; &amp;gt;}}&lt;/code&gt;&lt;br&gt;
Link to a heading on a different page: &lt;code&gt;{{&amp;lt; ref &amp;quot;document.md#reference&amp;quot; &amp;gt;}}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This can all be found in the official Hugo documentation &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/content-management/cross-references/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Shortcodes for creating links to documents&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Another shortcode trick I learned when writing this post is that escaping curly braces &lt;code&gt;{{&lt;/code&gt; in Hugo can be tricky when using the escape character. Using the backslash will result in some variation of this:&lt;br&gt;
&lt;code&gt;\{{&amp;lt; myshortcode &amp;gt;\}}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;A simple way to escape this is by adding &lt;code&gt;/*&lt;/code&gt; after the opening &lt;code&gt;&amp;lt;&lt;/code&gt; and adding &lt;code&gt;*/&lt;/code&gt; after the closing &lt;code&gt;&amp;gt;&lt;/code&gt;.&lt;br&gt;
&lt;code&gt;{{&amp;lt;/*/* myshortcode */&amp;gt;}}&lt;/code&gt; will produce &lt;code&gt;{{&amp;lt; shortcode &amp;gt;}}&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Amending a Git Commit Statement</title>
        <link>http://localhost:1313/posts/git-amend/</link>
        <pubDate>Thu, 02 Sep 2021 07:37:36 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/git-amend/</guid>
        <description>&lt;p&gt;Sometimes I make a hideous typo in my &lt;code&gt;git commit -m &amp;quot;description here&amp;quot;&lt;/code&gt; message, or decide that I need to make a clearer commit message, before I&amp;rsquo;ve done a push.&lt;/p&gt;
&lt;p&gt;It looks something like this when I&amp;rsquo;m working with hugo:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git add .
git commit -m &amp;#34;Website update 2021-090-2&amp;#34;
PANIC SETS IN
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Fortunately, it&amp;rsquo;s relatively simple to change the commit message &lt;em&gt;before&lt;/em&gt; the push has happened:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git commit --amend -m &amp;#34;Website update 2021-09-02&amp;#34;
git push origin main
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>Powershell &amp; PowerPlatform API ... now using the Graph API</title>
        <link>http://localhost:1313/posts/powershell-powerplatform-graph-api/</link>
        <pubDate>Mon, 30 Aug 2021 22:37:13 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-powerplatform-graph-api/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve already written about &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/powershell-powerplatform-api/&#34; &gt;Querying PowerPlatform API via. Powershell&lt;/a&gt;, but I received notice on Friday that Microsoft has now set a date when they will &lt;a class=&#34;link&#34; href=&#34;https://techcommunity.microsoft.com/t5/azure-active-directory-identity/migrate-your-apps-to-access-the-license-managements-apis-from/ba-p/2464366&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;cease supporting the Azure AD Graph endpoint&lt;/a&gt;, which also means they&amp;rsquo;ll stop supporting license assignment operation from MSOnline and Azure AD Powershell modules. As of June 30, 2022, you&amp;rsquo;ll need to use the MS Graph API endpoint and/or the Microsoft Graph Powershell module.&lt;/p&gt;
&lt;p&gt;What does this announcement from Microsoft mean? It means that I need to move away from calls to &lt;code&gt;Connect-MsolService&lt;/code&gt; and &lt;code&gt;Get-MsolUser&lt;/code&gt; in my script. You can see my script in my prior post.&lt;/p&gt;
&lt;p&gt;Now, technically, they should still work because I&amp;rsquo;m not assigning licenses, only reading them. But I don&amp;rsquo;t want my scripts to be even more fragmented, or have different EOL dates.&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt; &lt;/dt&gt;
&lt;dd&gt;Sidenote: Working with MS cloud services is a mess - some things are done with this module, others with that, some with this API, others with another API&amp;hellip; oh wait, that module has been deprecated&amp;hellip; get your act together Microsoft! Some modules work with Powershell 5.1, but others only work with 7. If Microsoft really wants people to embrace this (instead of having to use it out of necessessity), please, give us something well documented, mature and well-thought-out!&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Ranting aside, I figured that it&amp;rsquo;d be a good opportunity to practise API calls from Powershell.&lt;/p&gt;
&lt;p&gt;The two licenses that I&amp;rsquo;m interested are are related to Dynamics 365. Per Microsoft&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/licensing-service-plan-reference&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Product names and service plan identifiers for licensing&lt;/a&gt;, I need to query for:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;GUID&lt;/th&gt;
          &lt;th&gt;License Name&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;8e7a3d30-d97d-43ab-837c-d7701cef83dc&lt;/td&gt;
          &lt;td&gt;DYN365_ENTERPRISE_TEAM_MEMBERS&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;1e1a282c-9c54-43a2-9310-98ef728faace&lt;/td&gt;
          &lt;td&gt;DYN365_ENTERPRISE_SALES&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Easy! Let&amp;rsquo;s query with a filter to get users with either license SKU:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://graph.microsoft.com/v1.0/users?$filter=(assignedLicenses/any(x:x/skuId eq 8e7a3d30-d97d-43ab-837c-d7701cef83dc)) or (assignedLicenses/any(x:x/skuId eq 1e1a282c-9c54-43a2-9310-98ef728faace))&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;The&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;remote&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;returned&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;an&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;400&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bad&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;At&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;line&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CategoryInfo&lt;/span&gt;          &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvalidOperation&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HttpWebRequest&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HttpWebRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebException&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FullyQualifiedErrorId&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebCmdletWebResponseException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;InvokeRestMethodCommand&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Oof! That&amp;rsquo;s not so hot. All the Microsoft documentation and examples I could find only dealt with &lt;code&gt;AND&lt;/code&gt; filters, or &lt;code&gt;OR&lt;/code&gt; filters that did not query for the same value. I ended up choosing to make two calls, then merge the results:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DYN365_ENTERPRISE_SALES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://graph.microsoft.com/v1.0/users?$filter=assignedLicenses/any(x:x/skuId eq 1e1a282c-9c54-43a2-9310-98ef728faace)&amp;amp;$select=userPrincipalName,assignedLicenses&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DYN365_ENTERPRISE_TEAM_MEMBER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://graph.microsoft.com/v1.0/users?$filter=assignedLicenses/any(x:x/skuId eq 8e7a3d30-d97d-43ab-837c-d7701cef83dc)&amp;amp;$select=userPrincipalName,assignedLicenses&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Users&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Compare-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ReferenceObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DYN365_ENTERPRISE_SALES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;UserPrincipalName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DifferenceObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DYN365_ENTERPRISE_TEAM_MEMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;UserPrincipalName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IncludeEqual&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputObject&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Sort-Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That gave me the results I needed.&lt;/p&gt;
&lt;p&gt;I ended up asking on Reddit/r/PowerShell, and the end answer I got was that a few additional options are needed for &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/graph/aad-advanced-queries&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Advanced query capabilities on Azure AD directory objects&lt;/a&gt;:
-&lt;code&gt;ConsistencyLevel = eventual&lt;/code&gt; needs to be set in the header
-&lt;code&gt;&amp;amp;$count=true&lt;/code&gt; needs to be included in the filter&lt;/p&gt;
&lt;p&gt;Then something like this becomes possible:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;assignedLicenses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x:x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skuId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eq&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;06ebc4ee&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1bb5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;47dd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8120&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;11324bc54e06&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;or&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;assignedLicenses&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x:x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skuId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eq&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;66b55226&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;6b4f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;492c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;910c-a3b7a3c9d993&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;One of the other great changes I ended up making was to add some table formatting in my output. I set the table style to a fixed-width font (&lt;a class=&#34;link&#34; href=&#34;https://sourcefoundry.org/hack&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Hack&lt;/a&gt; is a personal favourite) because Powershell output doesn&amp;rsquo;t align well with anything else. There&amp;rsquo;s nothing worse then great output in Powershell turned to gobblygook in an email client!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$msg&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Report&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Sort-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LastAccess&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertTo-Html&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Head&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;style&amp;gt;table{font-family:lucida console, courier new, monospace;font-size:12}&amp;lt;/style&amp;gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-String&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Using Powershell to interact with Task Scheduler</title>
        <link>http://localhost:1313/posts/powershell-taskscheduler/</link>
        <pubDate>Wed, 25 Aug 2021 14:19:31 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-taskscheduler/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve already written about &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/posts/powershell-scheduling-tasks/&#34; &gt;Running Powershell scripts with Task Scheduler&lt;/a&gt;, but I solved a Task Scheduler problem the other day with Powershell and want to write about it.&lt;/p&gt;
&lt;p&gt;I love to use Powershell to solve problems and questions that I have. These are questions that are, for all intents and purposes, impossible to do manually because of the time that it would take.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve undertaken a project to implement rotating the local Administrator passwords on our work servers. One of the things that I realized, as I was doing the preliminary investigation, is that there are quite a few scheduled jobs that run as .\Administrator in the Task Scheduler. I wondered:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;exactly how many jobs are scheduled in Task Scheduler?&lt;/li&gt;
&lt;li&gt;what do the jobs do?&lt;/li&gt;
&lt;li&gt;which servers are they on?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I used Powershell and &lt;code&gt;get-adcomputer&lt;/code&gt; to identify 543 computers in our domain that should be scanned for Task Scheduler-scheduled jobs. These computers run OSes ranging from Server 2000 to Server 2019. There were some key pieces of information I wanted to pull from them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Computer Name&lt;/li&gt;
&lt;li&gt;Task Name&lt;/li&gt;
&lt;li&gt;Credentials it runs under&lt;/li&gt;
&lt;li&gt;Is it enabled?&lt;/li&gt;
&lt;li&gt;When did it last run?&lt;/li&gt;
&lt;li&gt;When will it next run?&lt;/li&gt;
&lt;li&gt;What command is executed?&lt;/li&gt;
&lt;li&gt;What actions, if any, are executed?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I started with &lt;a class=&#34;link&#34; href=&#34;https://github.com/exevolution/Get-AllScheduledTasks/blob/master/Get-AllScheduledTasks.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Get-AllScheduledTasks&lt;/a&gt; and modified it for the things I need:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I removed &lt;code&gt;ActiveDirectory&lt;/code&gt; module lines as they&amp;rsquo;re not necessary under Powershell 7&lt;/li&gt;
&lt;li&gt;I removed the variable &lt;code&gt;$OUDistinguishedName&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;I added field to the HashTable storing information about each Task&lt;/li&gt;
&lt;li&gt;I added filtering when querying the Task - I only want information about Tasks in the root (&amp;quot;&amp;quot;)&lt;/li&gt;
&lt;li&gt;I added a &lt;code&gt;switch&lt;/code&gt; condition to resolve well-known SIDs to their names (i.e. LOCAL SYSTEM) and improved the regex query&lt;/li&gt;
&lt;li&gt;I sent all the output directly to a CSV instead sending it to an array, then sending that to a CSV&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are some problems with the script - namely there&amp;rsquo;s no handling of Tasks with multiple triggers or actions. They show up as &amp;ldquo;System.Object[]` in the log - but for the purpose of my high-level discussions on how to handle Tasks running as .\Administrator, the script works. There were also one or two servers where the script just hung, and this script obviously doesn&amp;rsquo;t work on older OSes like Windows Server 2003.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1604 jobs were found&amp;hellip; wow! Those are a lot of jobs that bypass our enterprise scheduling process.&lt;/li&gt;
&lt;li&gt;543 domain-joined systems were scanned by this script. NOTE: some systems couldn’t be queried. I’d estimate this at 10-15% (50-75 systems).&lt;/li&gt;
&lt;li&gt;899 jobs (56%) run on DB systems (Oracle, SQL servers)&lt;/li&gt;
&lt;li&gt;159 jobs run under the local Administrator credentials&lt;/li&gt;
&lt;li&gt;158 jobs are to reboot the server&lt;/li&gt;
&lt;li&gt;598 jobs have not run since 2019&lt;/li&gt;
&lt;li&gt;614 jobs are currently disabled and not set to run. Some of them are obsolete, but some of them are purposely created &amp;amp; disabled so that an admin can easily run a predefined task by manually triggering it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With these stats, I can create a plan to deal with all these Tasks that won&amp;rsquo;t run once I rotate the local Administrator password.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve included my full script at the end of this post.&lt;/p&gt;
&lt;p&gt;As I was writing this script, I found that a number of systems still had Symantec jobs running regularly, even though Symantec was uninstalled from our servers about a year ago. The tasks ran, but didn&amp;rsquo;t actually do anything since the executable they were calling had been deleted. That seemed pretty harmless but pointless, so of course I had to fix it!&lt;/p&gt;
&lt;p&gt;Now I had a new quest - disable all the Symantec tasks across our organization!&lt;br&gt;
What tool can I use? Powershell!&lt;/p&gt;
&lt;p&gt;I wrote a quick script that uses 2 methods to query all 543 servers, find any Tasks in the \Symantec Endpoint Protection\ folder and disable them&amp;hellip; then I ran it. Mission accomplished!&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Disable-ScheduledSEPTasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;There are a lot of servers with enabled SEP-related tasks in Task Scheduler.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;The tasks don&amp;#39;t run because the executable doesn&amp;#39;t exist.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Disable these tasks to clean up log noise and prevent someone from placing a malicious file in the path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Greg Beifuss
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;2021-08-25 12:20
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Grab specific computers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Computers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ADComputer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Filter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;AC*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;WIFI*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DON*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;True&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DNSHostName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Sort-Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Do this the Powershell 7 way&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Computers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Parallel&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Test-Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Count&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Quiet&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Get-ScheduledTask&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-CimSession&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TaskPath&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\Symantec Endpoint Protection\&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Do this the legacy way.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#If pingable, try to connect and disable tasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ForEach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Computers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c&#34;&gt;# Test connection with computer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Test-Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Count&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Quiet&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c&#34;&gt;# Disable SEP tasks on machines&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$scriptblock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-ScheduledTask&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TaskPath&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\Symantec Endpoint Protection\&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Disable-ScheduledTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Invoke-Command&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ScriptBlock&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$scriptblock&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And here is the script that generated the statistics about Task Scheduler:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Get-ScheduledRootTasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Get all scheduled tasks at the root level &amp;#34;\&amp;#34; (this is where staff typically create them and avoids OS/Application-created tasks)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Export the results to a CSV
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Modified from https://github.com/exevolution/Get-AllScheduledTasks/blob/master/Get-AllScheduledTasks.ps1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Greg Beifuss
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;2021-08-25 12:25
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;Function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Connect-TaskScheduler&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;CmdletBinding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Mandatory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;ValueFromPipeline&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ComputerName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Begin&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$objScheduledTask&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Schedule.Service&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Try&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nb&#34;&gt;Write-Verbose&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Connecting to &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ComputerName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nv&#34;&gt;$objScheduledTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Connect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ComputerName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nb&#34;&gt;Write-Verbose&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Connected: &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$objScheduledTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connected&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Write-Error&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Failed to connect to &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ComputerName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;End&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$objScheduledTask&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;Function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-AllScheduledTasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;CmdletBinding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Mandatory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateScript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;BaseType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;MarshalByRefObject&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Connected&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Throw&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Not a valid Task Scheduler connection object&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;})]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ValueFromPipelineByPropertyName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateNotNullOrEmpty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;String[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Switch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Recurse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Begin&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Tasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-TaskSchedulerPaths&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Session&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Recurse:&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Recurse&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Tasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-TaskSchedulerTasks&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Session&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;End&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Tasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;Function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-TaskSchedulerPaths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;CmdletBinding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ValueFromPipeline&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateNotNullOrEmpty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;String[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Mandatory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateScript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;BaseType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;MarshalByRefObject&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Connected&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Throw&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Not a valid Task Scheduler connection object&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;})]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Switch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Recurse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Begin&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$BasePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetFolder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BasePath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BasePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetFolders&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Recurse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;ForEach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$P&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$P&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BasePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Continue&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;Else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-TaskSchedulerPaths&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Session&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Recurse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;End&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Paths&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;Function&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-TaskSchedulerTasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;CmdletBinding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Param&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ValueFromPipeline&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateNotNullOrEmpty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;String[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Mandatory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ValidateScript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;BaseType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;MarshalByRefObject&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Connected&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$True&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Throw&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Not a valid Task Scheduler connection object&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;})]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Begin&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$AllTasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Folder&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetFolder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Path&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$FolderTasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Folder&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetTasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;ForEach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$FolderTasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ToCharArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Measure-Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Property&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-NotMatch&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;^(SensorFramework|Optimize Start Menu|ShadowCopyVolumeUser_Feed|User_Feed|OneDrive|MicrosoftEdgeUpdateTask|GoogleUpdateTask|Adobe Acrobat Update Task)&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;RunAs&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Expression&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Principals&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Principal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;UserId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RunAs&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-match&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;S-\d-(?:\d+-){1,14}\d+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;k&#34;&gt;Switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;S-1-5-18&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;LOCAL SYSTEM&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;S-1-5-19&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;LOCAL SERVICE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;s2&#34;&gt;&amp;#34;S-1-5-20&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;NETWORK SERVICE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;Default&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;k&#34;&gt;Try&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ADUser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SamAccountName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;k&#34;&gt;Catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;k&#34;&gt;Try&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ADGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SamAccountName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;k&#34;&gt;Catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;Else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAsID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;$HashTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Ordered&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;ComputerName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Session&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;TargetServer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;RunAs&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$RunAs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;Action&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Actions&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Expression&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Actions&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;Arguments&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Arguments&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Expression&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;xml&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$xml&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Actions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Exec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Arguments&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Arguments&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ErrorAction&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;LastRunTime&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;LastRunTime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;NextRunTime&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;NextRunTime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;TaskEnabled&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Enabled&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;$AllTasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PSObject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Property&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$HashTable&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;End&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;Return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$AllTasks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Tasks&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ForEach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ADComputer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Filter&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;AC*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;WIFI*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-notlike&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DON*&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Enabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;True&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DNSHostName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Sort-Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#ForEach ($Computer in $Computers[355..543]) {&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$Connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Connect-TaskScheduler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Get-AllScheduledTasks&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Session&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Recurse&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Export-CSV&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gbadmin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tasks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;csv&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoTypeInformation&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Append&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Use .Summary in Hugo with the Stack theme</title>
        <link>http://localhost:1313/posts/hugo-summary/</link>
        <pubDate>Wed, 25 Aug 2021 08:15:17 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-summary/</guid>
        <description>&lt;p&gt;I decided to update my site to make it more &amp;lsquo;search engine-friendly&amp;rsquo; by making better use of the &lt;code&gt;meta description&lt;/code&gt; field. My particular theme, &lt;a class=&#34;link&#34; href=&#34;https://docs.stack.jimmycai.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Stack&lt;/a&gt;, does pull the .Description
field from Front Matter, BUT it also uses the .Description field to populate a brief summary of the article on the home page. I don&amp;rsquo;t want SEO-friendly content displaying as a summary on my home page, so I decided to use another Front Matter field and update the theme to use that for the &lt;code&gt;meta description&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;First, I edited the default markdown archetype (&lt;code&gt;/archetypes/default.md&lt;/code&gt;) in Hugo to include the .summary field:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-markdown&#34; data-lang=&#34;markdown&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;title: {{ replace .Name &amp;#34;-&amp;#34; &amp;#34; &amp;#34; | title }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;date: {{ .Date }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;description:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;summary:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;draft: true
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tags:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With that done, I needed to tell Hugo that when it generates the web content, it should populate the &lt;code&gt;meta description&lt;/code&gt; field with .summary. This way the .description Front Matter can still be used by the theme to populate the subtitles on my home page, while using the .summary field to generate text for SEO:&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s the original &lt;code&gt;layouts\partials\head\head.html&lt;/code&gt; contents:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;viewport&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;width=device-width, initial-scale=1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- $description := partialCached &amp;#34;data/description&amp;#34; . .RelPermalink -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;description&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;{{ .description }}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- $title := partialCached &amp;#34;data/title&amp;#34; . .RelPermalink -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;{{ $title }}&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;canonical&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;{{ .Permalink }}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/style.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/script.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/opengraph/include.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- range .AlternativeOutputFormats -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .Rel }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .MediaType.Type }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .Permalink | safeURL }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- end -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{ with .Site.Params.favicon }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;shortcut icon&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ . }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{ end }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- template &amp;#34;_internal/google_analytics.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/custom.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I replaced the line &lt;code&gt;&amp;lt;meta name=&#39;description&#39; content=&#39;{{ .description }}&#39;&amp;gt;&lt;/code&gt; with &lt;code&gt;&amp;lt;meta name=&#39;description&#39; content=&#39;{{ .summary | truncate 130 }}&#39;&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This tells Hugo to refer to the .Summary Front Matter field, and not the .Description, when generating the meta description. I also capped the meta description at 130 characters, just in case I write more than that. Search Engines typically consider somewhere between 25-160 characters, but check with your specific search engine for the exact values.&lt;/p&gt;
&lt;p&gt;This is my final &lt;code&gt;layouts\partials\head\head.html&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;viewport&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;width=device-width, initial-scale=1&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- $description := partialCached &amp;#34;data/description&amp;#34; . .RelPermalink -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;meta&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;description&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;{{ .summary | truncate 130 }}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- $title := partialCached &amp;#34;data/title&amp;#34; . .RelPermalink -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;{{ $title }}&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;canonical&amp;#39;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;{{ .Permalink }}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/style.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/script.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/opengraph/include.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- range .AlternativeOutputFormats -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .Rel }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .MediaType.Type }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ .Permalink | safeURL }}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- end -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{ with .Site.Params.favicon }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;link&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;rel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;shortcut icon&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{{ . }}&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{ end }}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- template &amp;#34;_internal/google_analytics.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;{{- partial &amp;#34;head/custom.html&amp;#34; . -}}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Troubleshooting Hugo&#39;s &#39;Port 1313 already in use&#39; error</title>
        <link>http://localhost:1313/posts/hugo-winnat/</link>
        <pubDate>Fri, 20 Aug 2021 14:12:12 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-winnat/</guid>
        <description>&lt;p&gt;Today I:&lt;br&gt;
&amp;hellip; started my computer, as usual&lt;br&gt;
&amp;hellip; checked for patches, as usual&lt;br&gt;
&amp;hellip; checked for updated software (via chocolatey!), as usual&lt;br&gt;
&amp;hellip; started Hugo&amp;rsquo;s local server&amp;hellip; as not usual!&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\gbeifuss\blog&amp;gt;hugo server -D -v -p 1313
port 1313 already in use, attempting to use an available port
Start building sites …
hugo v0.87.0-B0C541E4+extended windows/amd64 BuildDate=2021-08-03T10:57:28Z VendorInfo=gohugoio
INFO 2021/08/20 11:20:57 syncing static files to C:\Users\gbeifuss\blog\
WARN 2021/08/20 11:20:57 Search page not found. Create a page with layout: search.
WARN 2021/08/20 11:20:57 Archives page not found. Create a page with layout: archives.

                   | EN
-------------------+-----
  Pages            | 45
  Paginator pages  |  5
  Non-page files   |  0
  Static files     |  5
  Processed images |  5
  Aliases          | 12
  Sitemaps         |  1
  Cleaned          |  0

Built in 135 ms
Watching for changes in C:\Users\gbeifuss\blog\{archetypes,content,data,layouts,static,themes}
Watching for config changes in C:\Users\gbeifuss\blog\config.yaml
Environment: &amp;#34;development&amp;#34;
Serving pages from memory
Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
Web Server is available at http://localhost:15823/ (bind address 127.0.0.1)
Press Ctrl+C to stop
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This has never been a problem before. How can port 1313 already be in use? There&amp;rsquo;s nothing else on my system configured to use that port!&lt;/p&gt;
&lt;p&gt;I pulled up &lt;code&gt;netstat&lt;/code&gt; to confirm:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\gbeifuss&amp;gt;netstat -ano | find &amp;#34;1313&amp;#34;
C:\Users\gbeifuss&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Well, if nothing is using the port, then why can&amp;rsquo;t Hugo use it? If there&amp;rsquo;s nothing actively blocking Hugo, then Hugo must be prevented from using that port by another mechanism.&lt;/p&gt;
&lt;p&gt;I checked the reservations that Windows knows about with &lt;code&gt;netsh&lt;/code&gt;:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\gbeifuss\blog&amp;gt;netsh int ipv4 show excludedportrange protocol=tcp

Protocol tcp Port Exclusion Ranges

Start Port    End Port
----------    --------
      1214        1313
      8004        8004
     11801       11900
     29480       29579
     30221       30320
     32822       32921
     49680       49779
     50000       50059     *
     50160       50259
     50261       50360
     50378       50477

* - Administered port exclusions.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Well, there we go! What&amp;rsquo;s reserved that port?&lt;br&gt;
I stopped &lt;code&gt;Docker Desktop Service&lt;/code&gt; and made sure all the Hyper-V services weren&amp;rsquo;t running either, but that reservation was still there.&lt;/p&gt;
&lt;p&gt;It turns out that the range 1214-1313 was reserved by the &lt;code&gt;Windows NAT Driver&lt;/code&gt; (WinNat) service.&lt;/p&gt;
&lt;p&gt;I stopped the winnat service via. the command line (as Administrator):&lt;br&gt;
&lt;code&gt;net stop winnat&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Then I started Hugo, which happily grabbed port 1313:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\gbeifuss\blog&amp;gt;hugo server -D
Start building sites …
hugo v0.87.0-B0C541E4+extended windows/amd64 BuildDate=2021-08-03T10:57:28Z VendorInfo=gohugoio
WARN 2021/08/20 14:12:16 Search page not found. Create a page with layout: search.
WARN 2021/08/20 14:12:16 Archives page not found. Create a page with layout: archives.

                   | EN
-------------------+-----
  Pages            | 46
  Paginator pages  |  5
  Non-page files   |  0
  Static files     |  5
  Processed images |  8
  Aliases          | 12
  Sitemaps         |  1
  Cleaned          |  0

Built in 481 ms
Watching for changes in C:\Users\gbeifuss\blog\{archetypes,content,data,layouts,static,themes}
Watching for config changes in C:\Users\gbeifuss\blog\config.yaml
Environment: &amp;#34;development&amp;#34;
Serving pages from memory
Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
Web Server is available at http://localhost:1313/ (bind address 127.0.0.1)
Press Ctrl+C to stop
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Then I started the winnat service again:&lt;br&gt;
&lt;code&gt;net start winnat&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Adding TLS 1.2 support for Powershell</title>
        <link>http://localhost:1313/posts/powershell-tls12/</link>
        <pubDate>Fri, 20 Aug 2021 11:02:12 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-tls12/</guid>
        <description>&lt;p&gt;Sometimes I try to setup PSWindowsUpdate (an amazing module from the Powershell Gallery) and receive an error like this one:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;WARNING&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Source&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Location&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;‘&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;www&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;powershellgallery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;api&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;package&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PSWindowsUpdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2.2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; is not valid.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;PackageManagement\Install-Package : Package ‘PSWindowsUpdate&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;failed&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;download&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;At&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Program&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Files&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WindowsPowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Modules&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PowerShellGet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PSModule&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;psm1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1772&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;21&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;…&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$null&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PackageManagement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Install-Package&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;@PSBoundParameters&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CategoryInfo&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResourceUnavailable&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\...&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Install-Package&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FullyQualifiedErrorId&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PackageFailedInstallOrDownload&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PackageManagement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Cmdlets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;InstallPackage&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A similar issue arises with using the Invoke-WebRequest cmdlet. The root cause is that Powershell is trying to connect to a site and there&amp;rsquo;s no agreement on the encryption protocol to use. By default, Powershell uses TLS 1.0 and that&amp;rsquo;s been widely deprecated.&lt;/p&gt;
&lt;h2 id=&#34;the-background&#34;&gt;The Background
&lt;/h2&gt;&lt;p&gt;Transport Layer Security (TLS) is the successor to SSL. Starting in 2018, there was a groundswell of (good) advice that TLS 1.0 and 1.1 should be deprecated on websites and in browsers. This was largely adopted across the internet by 2020. That leaves TLS 1.2 as the &lt;em&gt;de facto standard&lt;/em&gt;, with TLS 1.3 adoption rising but not as widespread yet.&lt;/p&gt;
&lt;h2 id=&#34;the-problem&#34;&gt;The Problem
&lt;/h2&gt;&lt;p&gt;In April 2020, Microsoft disabled support for TLS 1.0 on the Powershell Gallery and now requires TLS 1.2. The issue is that Powershell 5.1 doesn&amp;rsquo;t support this configuration out of the box and the PowershellGet module (1.0.0.1) didn&amp;rsquo;t support TLS 1.2 &lt;em&gt;at all&lt;/em&gt;. Smooth move, Microsoft.&lt;/p&gt;
&lt;h2 id=&#34;the-solution&#34;&gt;The Solution
&lt;/h2&gt;&lt;p&gt;Microsoft released a new version of PowershellGet (2.2.4) in April 2020 that supports TLS 1.2. You can install it like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PowerShellGet&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-RequiredVersion&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2.2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SkipPublisherCheck&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;By default, Powershell uses whatever the system default settings for crypto:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Net.ServicePointManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SecurityProtocol&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SystemDefault&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;hellip; but the problem is that the default for each system could be different. You can &lt;em&gt;force&lt;/em&gt; your system to enable TLS 1.2 support in your Powershell session:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Net.ServicePointManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SecurityProtocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Net.SecurityProtocolType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Tls12&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;hellip; but the problem with this command is that you need to run it everytime you open a new Powershell session.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s update the current user&amp;rsquo;s Powershell profile (creating it if it doesn&amp;rsquo;t exist) so that TLS 1.2 support is enabled every time a session is launched:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$ProfileFile&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;${PsHome}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;\Profile.ps1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(!&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Test-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$ProfileFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$ProfileFile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-FilePath&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$ProfileFile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Encoding&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ascii&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Append&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Actually, while we&amp;rsquo;re at it, let&amp;rsquo;s configure Windows and .NET too:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#TLS1.2-Windows.ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Enable only TLS 1.2 on Windows.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Disable TLS 1.0, 1.2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Enable .NET to use TLS 1.2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Greg Beifuss
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;2020-07-02 16:11
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Write-Host&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;TLS 1.0 has been Disabled.&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Write-Host&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;TLS 1.1 has been Disabled.&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Item&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DisabledByDefault&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PropertyType&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;DWord&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Null&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Write-Host&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;TLS 1.2 has been Enabled.&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SOFTWARE\Wow6432Node\Microsoft\.NetFramework\v4.0.30319&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;SchUseStrongCrypto&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DWord&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ItemProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;HKLM:\SOFTWARE\Microsoft\.NetFramework\v4.0.30319&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;SchUseStrongCrypto&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DWord&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Enter-PSSession, WinRM &amp; NLA</title>
        <link>http://localhost:1313/posts/powershell-nla/</link>
        <pubDate>Wed, 18 Aug 2021 07:50:51 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-nla/</guid>
        <description>&lt;p&gt;I was trying to use PS-Remoting to remotely run some powershell commands on a few servers, but one of them returned an error instead of connecting. I found this odd because:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The other 2 servers didn&amp;rsquo;t have this error, and they all used the same GPOs to enforce configuration, and&lt;/li&gt;
&lt;li&gt;Enter-PSSession worked on this server a few days ago.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enter-pssession&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DomainController01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Enter-PSSession&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connecting&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;remote&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DomainController01&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;failed&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;following&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;WinRM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cannot&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;complete&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;operation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Verify&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specified&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;computer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;accessible&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;over&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;network&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;firewall&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exception&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WinRM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;enabled&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allows&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;access&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;computer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;By&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WinRM&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;firewall&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exception&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;profiles&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;limits&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;access&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;remote&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;computers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;within&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;same&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subnet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;For&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;more&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;information&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;see&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;about_Remote_Troubleshooting&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Help&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;topic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I opened an RDP session to the server to see exactly what was going on:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WinRM was correctly configured&lt;/li&gt;
&lt;li&gt;Windows Firewall was correctly configured. The Domain profile permitted Windows Remote Management.&lt;/li&gt;
&lt;li&gt;PS-Remoting was correctly configured in Powershell&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&amp;hellip; Then I saw it. The network connection icon in the systray said &amp;ldquo;unidentified network&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/unidentifiednetwork.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Unidentified Network image&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Of course! Since Windows isn&amp;rsquo;t detecting the network connection as part of the Domain Network, Windows Firewall can&amp;rsquo;t permit my WinRM traffic under the Domain profile rule. The job of reviewing the network configuration (IP Address) and assigning a location to the network is the job of the &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/windows/win32/winsock/the-role-of-nla-2&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Network Location Awareness (NLA)&lt;/a&gt; service. NLA first attempts to identify a logical network by its domain name (DNS). If a logical network does not have a domain name, NLA identifies the network from custom static information stored in the registry, and finally from its subnet address.&lt;/p&gt;
&lt;p&gt;Fixing this misdetection is quite easy. Off the top of my head, there are at least 3 ways to do this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;From the command prompt: &lt;code&gt;net stop nlasvc &amp;amp;&amp;amp; net start nlasvc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;From the services.msc GUI interface: Restart the Network Location Awareness service&lt;/li&gt;
&lt;li&gt;From powershell: &lt;code&gt;get-service nlasvc | restart-service&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;After restarting the service, the OS assigned the proper location (&amp;ldquo;domain network&amp;rdquo;) to the connection.
A quick test with powershell confirmed that enter-pssession now worked like it should have 10 minutes ago.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Exchange &amp; -DeleteContent</title>
        <link>http://localhost:1313/posts/exchange-delete-content/</link>
        <pubDate>Wed, 11 Aug 2021 15:01:20 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/exchange-delete-content/</guid>
        <description>&lt;p&gt;Our FOI/Privacy Officer was informed of a an unauthorized disclosure of PII via email by one of our staff members. I was looped in to&lt;br&gt;
a) quantify how many other people in our organization had that particular email in their mailbox, and&lt;br&gt;
b) administratively remove it.&lt;/p&gt;
&lt;p&gt;This is fairly straightforward with Powershell. The hardest part is finding the right message(s) among hundreds of mailboxes containing thousands of messages each.&lt;/p&gt;
&lt;p&gt;To start, I got the message details. When I&amp;rsquo;m not familiar with the information I&amp;rsquo;ll get back, I like to store the output in a variable before manipulating it. It saves time because I don&amp;rsquo;t need to requery the information (all Exchange mailboxes in this case). I then used the &lt;code&gt;Search-Mailbox&lt;/code&gt; cmdlet to track it down:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$results&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-mailbox&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Search-Mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SearchQuery&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;subject:Attention: John Doe AND from:customer@gmail.com AND received:07/28/2021&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$results&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Well that&amp;rsquo;s not good. There were no results. This time, I&amp;rsquo;ll look for the specific attachment that contained the PII, then display any results that have a resultcount &amp;gt; 0 (that is, a message with the attachment was found):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$results&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-mailbox&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Search-Mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SearchQuery&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;attachment:tax_07-10-2021-080049.pdf&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-EstimateResultOnly&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$results&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;where &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;resultitemscount&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resultitemscount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ft &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Identity&lt;/span&gt;                                   &lt;span class=&#34;n&#34;&gt;ResultItemsCount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;                                   &lt;span class=&#34;p&#34;&gt;----------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Corporate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JDoe&lt;/span&gt;                &lt;span class=&#34;mf&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Corporate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GWashington&lt;/span&gt;         &lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Much better! 5 messages found across Exchange. Now, let&amp;rsquo;s purge them from JDoe&amp;rsquo;s mailbox, but leave them in GWashington&amp;rsquo;s mailbox. We need the -DeleteContent switch for that:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;JDoe&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Search-Mailbox&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SearchQuery&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;attachment:tax_07-10-2021-080049.pdf&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DeleteContent&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>Network Troubleshooting and MTU</title>
        <link>http://localhost:1313/posts/mtu/</link>
        <pubDate>Wed, 11 Aug 2021 14:57:19 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/mtu/</guid>
        <description>&lt;p&gt;These days I do minimal networking, but my college diploma is in an IP Engineering discipline, and prior to that, I had the opportunity to complete the Cisco Networking Academy curriculum in high school. All of that to say that while I&amp;rsquo;ve not pursued that field, I have a decent foundation and understanding on how those things operate. At work, I have my hand in firewalls, switches, DNS, DHCP, routing, subnetting and other wonderful things, but it&amp;rsquo;s not super advanced work.&lt;/p&gt;
&lt;p&gt;For about 8 months now, we&amp;rsquo;ve had a dedicated link setup between our main office and a remote site. This will replace an internet-based VPN tunnel that currently carries traffic. However, it&amp;rsquo;s still not in use because of &lt;em&gt;problems&lt;/em&gt;. More specifically, whenever I switch traffic to route over the dedicated link, service becomes extremely problematic. &lt;code&gt;Ping&lt;/code&gt; to any system works, but protocols like RDP, SMB and replication (AD &amp;amp; Exchange) work intermittantly at best (RDP), or not at all (SMB, replication). I could RDP to ServerA, but not to ServerB, although they&amp;rsquo;re both VMs hosted on the same Hyper-V server at the remote site. And while RDP worked to the DC at the remote site &lt;strong&gt;and&lt;/strong&gt; I could ping all the other DCs, &lt;code&gt;repadmin /replsummary&lt;/code&gt; showed that replication was no longer working.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s a simple topology diagram in ASCII art:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Head Office core switch - Head Office firewall - VPN Tunnel over internet - SiteA firewall - SiteA core switch
vs.
Head Office core switch - dedicated L2 link - SiteA core switch
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I knew this was going to be a pain to troubleshoot, especially since I couldn&amp;rsquo;t take the whole DR site offline whenever I wanted during the day to conduct tests. I quintuple checked the configuration and didn&amp;rsquo;t find any errors. I compared it line-by-line to another site we have this same setup (dedicated link between core switches) and everything was configured correctly.&lt;/p&gt;
&lt;p&gt;I finally decided to bite the bullet and spent a couple of late nights trying to gather information so that I could quantify the precise problem. Because the physical layer was out of my control, the data link layer seemed fine (also out of my control&amp;hellip;mostly) and &lt;code&gt;ping&lt;/code&gt; worked (layer 3), I was pretty confident the issue originated at the Network layer, or higher.&lt;/p&gt;
&lt;p&gt;I started by looking at the packet sizes. I knew that ping was a tiny packet, while things like replication and SMB would probably exceed the MTU. I ran some tests with the &lt;code&gt;ping -f -l&lt;/code&gt; to determine the maximum packet size that could successfully transit the link.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;No.     Time           Source                Destination           Protocol Length ICMP Length Info
      1 0.000000       10.1.0.51             192.168.4.3           ICMP     1507   1465        Echo (ping) request  id=0x006b, seq=37568/49298, ttl=128 (reply in 2)
      2 0.005320       192.168.4.3           10.1.0.51             ICMP     1507   1465        Echo (ping) reply    id=0x006b, seq=37568/49298, ttl=126 (request in 1)
      3 1.005759       10.1.0.51             192.168.4.3           ICMP     1507   1465        Echo (ping) request  id=0x006b, seq=37569/49554, ttl=128 (reply in 4)
      4 1.011053       192.168.4.3           10.1.0.51             ICMP     1507   1465        Echo (ping) reply    id=0x006b, seq=37569/49554, ttl=126 (request in 3)
      5 2.011301       10.1.0.51             192.168.4.3           ICMP     1507   1465        Echo (ping) request  id=0x006b, seq=37570/49810, ttl=128 (reply in 6)
      6 2.016662       192.168.4.3           10.1.0.51             ICMP     1507   1465        Echo (ping) reply    id=0x006b, seq=37570/49810, ttl=126 (request in 5)
      7 3.017966       10.1.0.51             192.168.4.3           ICMP     1507   1465        Echo (ping) request  id=0x006b, seq=37571/50066, ttl=128 (reply in 8)
      8 3.023353       192.168.4.3           10.1.0.51             ICMP     1507   1465        Echo (ping) reply    id=0x006b, seq=37571/50066, ttl=126 (request in 7)
      9 16.070931      10.1.0.51             192.168.4.3           ICMP     1510   1468        Echo (ping) request  id=0x006b, seq=37576/51346, ttl=128 (reply in 10)
     10 16.076166      192.168.4.3           10.1.0.51             ICMP     1510   1468        Echo (ping) reply    id=0x006b, seq=37576/51346, ttl=126 (request in 9)
     11 17.075444      10.1.0.51             192.168.4.3           ICMP     1510   1468        Echo (ping) request  id=0x006b, seq=37577/51602, ttl=128 (reply in 12)
     12 17.080656      192.168.4.3           10.1.0.51             ICMP     1510   1468        Echo (ping) reply    id=0x006b, seq=37577/51602, ttl=126 (request in 11)
     13 18.082161      10.1.0.51             192.168.4.3           ICMP     1510   1468        Echo (ping) request  id=0x006b, seq=37578/51858, ttl=128 (reply in 14)
     14 18.087498      192.168.4.3           10.1.0.51             ICMP     1510   1468        Echo (ping) reply    id=0x006b, seq=37578/51858, ttl=126 (request in 13)
     15 19.087735      10.1.0.51             192.168.4.3           ICMP     1510   1468        Echo (ping) request  id=0x006b, seq=37579/52114, ttl=128 (reply in 16)
     16 19.093044      192.168.4.3           10.1.0.51             ICMP     1510   1468        Echo (ping) reply    id=0x006b, seq=37579/52114, ttl=126 (request in 15)
     17 26.901887      10.1.0.51             192.168.4.3           ICMP     1511   1469        Echo (ping) request  id=0x006b, seq=37580/52370, ttl=128 (no response found!)
     18 31.753228      10.1.0.51             192.168.4.3           ICMP     1511   1469        Echo (ping) request  id=0x006b, seq=37581/52626, ttl=128 (no response found!)
     19 36.753276      10.1.0.51             192.168.4.3           ICMP     1511   1469        Echo (ping) request  id=0x006b, seq=37582/52882, ttl=128 (no response found!)
     20 41.753263      10.1.0.51             192.168.4.3           ICMP     1511   1469        Echo (ping) request  id=0x006b, seq=37583/53138, ttl=128 (no response found!)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I found that where the size was &amp;lt;= 1468, the ping succeeded. At 1469-1472 bytes, there was no response. And at sizes &amp;gt;= 1473, ping helpfully told me that the &lt;code&gt;Packet needs to be fragmented but DF set.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Okay! We&amp;rsquo;re making progress! &amp;hellip;Maybe. Still working on the MTU theory, I took a look at all the network devices that these packets would transit:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ServerA&lt;/li&gt;
&lt;li&gt;Hyper-V host server&lt;/li&gt;
&lt;li&gt;Remote site core switch
&amp;hellip; L2 Dedicated Link beyond my control&amp;hellip;&lt;/li&gt;
&lt;li&gt;Head Office core switch&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Both switches were set with an MTU of 1500 bytes, which is pretty standard. The Hyper-V host server used the Windows default of 1500, as did ServerA. So it looked like MTUs haven&amp;rsquo;t been altered in a meaningful way.&lt;/p&gt;
&lt;p&gt;I ran a series of packet captures to see if anything looked unusual. Nothing jumped out at me, but I did notice that whenever the packet size exceeded 1500-ish bytes, there were lots of retranmissions and/or errors.&lt;/p&gt;
&lt;p&gt;Wait! How is it that a server with an MTU of 1500 is sending packets that are 2600 bytes?&lt;/p&gt;
&lt;p&gt;Wireshark uses winpcap (or libpcap) to grab the data &lt;em&gt;before&lt;/em&gt; it&amp;rsquo;s handed to the NIC:
&lt;img src=&#34;http://localhost:1313/img/wireshark.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Many OS and NIC drivers support &lt;em&gt;TCP Segmentation Offload / Large Segment Offload / Generic Segment Offload&lt;/em&gt; which offloads the task of breaking up TCP data into MSS-appropriate pieces. This is handled by the NIC, and saves resource overhead, improving performance. However&amp;hellip; with offloading enabled, this task is now completed &lt;em&gt;after&lt;/em&gt; Wireshark has grabbed the data, so it&amp;rsquo;s not seen when capturing from the OS. Using a SPAN port (port mirroring) or TAP would not have this limitation.&lt;/p&gt;
&lt;p&gt;Back to my regularly scheduled commentary&amp;hellip;&lt;/p&gt;
&lt;p&gt;Running with the MTU theory, I decided to set the OS MTU = 1496 bytes. That&amp;rsquo;s 1468, which is the largest setting that worked with the Don&amp;rsquo;tFragment flag set, plus the 28 byte IP header. Let&amp;rsquo;s double check what the MTU is set at on my Windows 2019 DC at SiteA:
&lt;code&gt;netsh int ipv4 show sub&lt;/code&gt;
(the full command is &lt;em&gt;netsh interface ipv4 show subinterfaces&lt;/em&gt;, but I generally use the shorthand).&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users&amp;gt;netsh int ipv4 show sub

   MTU  MediaSenseState   Bytes In  Bytes Out  Interface
------  ---------------  ---------  ---------  -------------
4294967295                1          0      52364  Loopback Pseudo-Interface 1
  1500                1  550194231  647147510  Ethernet 2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Let&amp;rsquo;s update this:
&lt;code&gt;netsh in ipv4 set sub &amp;quot;Ethernet 2&amp;quot; mtu=1496 store=persistent&lt;/code&gt;
(&lt;em&gt;netsh interface ipv4 set subinterface &amp;ldquo;Ethernet 2&amp;rdquo; mtu=1496 store=persistent&lt;/em&gt;)&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users&amp;gt;netsh int ipv4 show sub

   MTU  MediaSenseState   Bytes In  Bytes Out  Interface
------  ---------------  ---------  ---------  -------------
4294967295                1          0      52364  Loopback Pseudo-Interface 1
  1496                1  55025789  647165843  Ethernet 2
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;On Windows 2019, this took effect immediately. If it doesn&amp;rsquo;t, a reboot should ensure it applies.
AD replication - which had been failing - picked right back up as soon as I entered this command.&lt;/p&gt;
&lt;p&gt;Now, I&amp;rsquo;ve proved that it&amp;rsquo;s an MTU issue, so I&amp;rsquo;ve turned it over to our L2 direct link provider. Interestingly enough, the 4 bytes (1500-1496=4) is the exact same size that a QinQ implementation adds. The packet arrives as an 802.1Q frame (tagged), and QinQ will add its own Tag &amp;amp; EType field in the frame. This resulting QinQ frame is often referred to as &amp;lsquo;double tagged&amp;rsquo;.
&lt;img src=&#34;http://localhost:1313/img/qinq.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;You can read more about QinQ in the Cisco article &lt;a class=&#34;link&#34; href=&#34;http://www.cisco.com/en/US/tech/tk389/tk689/technologies_tech_note09186a0080094665.shtml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Inter-Switch Link and IEEE 802.1Q Frame Format&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Pushing to GitHub via. Git</title>
        <link>http://localhost:1313/posts/git-github/</link>
        <pubDate>Mon, 09 Aug 2021 14:00:25 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/git-github/</guid>
        <description>&lt;p&gt;When I first committed to actually publishing a blog and settled on using Hugo and Github, I ran into a problem when trying to actually synchronize my local repository with Github: I kept getting a &amp;lsquo;Permission Denied (publickey)&amp;rsquo; error when I pushed the content up to Github. After some Google-fu, I found that the error was because I didn&amp;rsquo;t have any SSH keys setup on my Windows 10 system and it couldn&amp;rsquo;t communicate securely with GitHub.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how I fixed that:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open &lt;code&gt;git bash&lt;/code&gt;. I could have done this in Windows Terminal (by creating a new profile linked to git bash), but since this is a one-time task, I didn&amp;rsquo;t bother.&lt;/li&gt;
&lt;li&gt;Type &lt;code&gt;cd ~/.ssh&lt;/code&gt;. This will take you to the root directory for Git (likely C:\Users\username\.ssh\)&lt;/li&gt;
&lt;li&gt;Within the &lt;code&gt;.ssh&lt;/code&gt; folder, there should be two files: &lt;code&gt;id_rsa&lt;/code&gt; and &lt;code&gt;id_rsa.pub&lt;/code&gt;. Type &lt;code&gt;ls&lt;/code&gt; to see a directory listing. These are the files that tell your computer how to communicate with GitHub. If those two files don&amp;rsquo;t show up, continue to #4.&lt;br&gt;
NOTE: Your SSH keys must be named id_rsa and id_rsa.pub in order for Git and GitHub to recognize them by default.&lt;/li&gt;
&lt;li&gt;Since the SSH keys don&amp;rsquo;t exist yet, create thethem: type &lt;code&gt;ssh-keygen -t rsa -C &amp;quot;you@email.com&amp;quot;&lt;/code&gt;. This will create both the &lt;code&gt;id_rsa&lt;/code&gt; and &lt;code&gt;id_rsa.pub&lt;/code&gt; files.&lt;/li&gt;
&lt;li&gt;Open &lt;code&gt;id_rsa.pub&lt;/code&gt; in &lt;del&gt;your favorite text editor&lt;/del&gt; Notepad.&lt;/li&gt;
&lt;li&gt;Copy the contents (exactly as it appears, with no extra spaces or lines) of &lt;code&gt;id_rsa.pub&lt;/code&gt; and paste it into GitHub under the Account Settings &amp;gt; SSH Keys page.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now that you&amp;rsquo;ve added your public key to Github, try to &lt;code&gt;git push&lt;/code&gt; again and see if it works. It should!&lt;/p&gt;
&lt;p&gt;A step-by-step rundown of this process (and more!) is also on the GitHub site: &lt;a class=&#34;link&#34; href=&#34;https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Connecting to GitHub with SSH&lt;/a&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Powershell &amp; NTMLv1 use</title>
        <link>http://localhost:1313/posts/powershell-ntlmv1/</link>
        <pubDate>Thu, 05 Aug 2021 11:11:56 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-ntlmv1/</guid>
        <description>&lt;p&gt;I&amp;rsquo;m in the midst of trying to phase out non-Kerberos authentication traffic in our domain, because &lt;em&gt;it&amp;rsquo;s time&lt;/em&gt;. MS has offered Kerberos since Windows 2000, and the pre-Kerberos options (LANMan, NTLMv1, NTLMv2) are woefully insecure. In fact, MS stopped recommending NTLM for use in applications in 2010. It&amp;rsquo;s still widely in use for compatibility reasons.&lt;/p&gt;
&lt;h2 id=&#34;the-protocols&#34;&gt;The Protocols
&lt;/h2&gt;&lt;h3 id=&#34;lanman&#34;&gt;LANMan
&lt;/h3&gt;&lt;p&gt;LANMan, or LAN Manager, was offered in 1987 and can be easily broken. Among other issues:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A LANMan password is not case-sensitive. Everything is cast to uppercase before the hash is created. This dramatically reduces the characters that need to be bruteforced, as lowercase isn&amp;rsquo;t a required set (reducing the total characters by 26).&lt;/li&gt;
&lt;li&gt;When first created, the implementation presumed that passwords woud never be longer than 7 characters, so a total of eight bytes are used to store it - the seven password characters plus a parity byte. Of course, this quickly became a problem, so the password length was increased to use 16 bytes. But in order to remain backwards compatible, this is implemented as 2x 8-byte fields (7 password characters + 1 parity byte). Any password shorter than 14 charafters will have unused bytes filled with &lt;em&gt;NULLs&lt;/em&gt;.&lt;br&gt;
If the password is seven characters or less, the entire second 8-byte field will be full of &lt;em&gt;NULLs&lt;/em&gt;, which means the attacker only has to break one 7-character password. Even if the password takes a full 14 characters, the attacker doesn&amp;rsquo;t have to break that, they are actually breaking 2 separate seven-character passwords, which is magnitudes of order faster.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ntlm-v1&#34;&gt;NTLM v1
&lt;/h3&gt;&lt;p&gt;New Technology LAN Manager (NTLM) is the default authentication protocol for NT 4.0. It&amp;rsquo;s a challenge/response-based protocol but has issues as well:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The challenge issued by NTLMv1 is always a 16-byte random number.&lt;/li&gt;
&lt;li&gt;It used a DES algorithm for encryption of the challenge (with the user&amp;rsquo;s hash). DES is built for speed, which makes decryption by an attacker fast as well.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As of 2019, every possible 8-character NTLM password hash can be enumerated by modern hardware in about 2.5 hours. It&amp;rsquo;s even faster if you use rainbow tables, which exist for all 8 and 9-character passwords.&lt;/p&gt;
&lt;h3 id=&#34;ntlm-v2&#34;&gt;NTLM v2
&lt;/h3&gt;&lt;p&gt;A number of the NTLM v1 weaknesses are corrected in v2:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The challenge is a variable-length challenge.&lt;/li&gt;
&lt;li&gt;HMAC-MD5 is used instead of DES. It&amp;rsquo;s slower, so brute force isn&amp;rsquo;t a practical option&amp;hellip; at least until quantum computers become available!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NTLM remains vulnerable to &lt;em&gt;pass the hash&lt;/em&gt; attacks, in addition to not supporting modern encryption algorithms (AES, SHA-256).&lt;/p&gt;
&lt;h2 id=&#34;decommissioning-ntlm-and-lanman&#34;&gt;Decommissioning NTLM and LANMan
&lt;/h2&gt;&lt;p&gt;Now that it&amp;rsquo;s clear why NTLM is a terrible modern choice for authentication, let&amp;rsquo;s sort out how to get rid of it. Many older devices may only support NTLM, so we need to identify any devices currently using it.&lt;/p&gt;
&lt;h3 id=&#34;audit&#34;&gt;Audit
&lt;/h3&gt;&lt;p&gt;First, enable NTLM auditing on your Domain Controllers. This will create &lt;em&gt;Event ID 4624&lt;/em&gt; in the Security Event log. This event will note which authentication method was used: KERBEROS or NTLM. If it&amp;rsquo;s NTLM, a subfield will tell whether it&amp;rsquo;s LM, V1 or V2.&lt;/p&gt;
&lt;p&gt;I created a GPO for my DCs and set these values under &lt;em&gt;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options&lt;/em&gt;:&lt;br&gt;
&lt;strong&gt;Network Security: Restrict NTLM: Audit NTLM authentication in this domain&lt;/strong&gt; to &lt;em&gt;Enable all&lt;/em&gt;&lt;br&gt;
&lt;strong&gt;Network security: Restrict NTLM: Audit Incoming NTLM Traffic&lt;/strong&gt; to &lt;em&gt;Enable auditing for all accounts&lt;/em&gt;&lt;br&gt;
&lt;strong&gt;Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers&lt;/strong&gt; to &lt;em&gt;Audit all&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Now I have Event ID 4624 showing up in my logs. I want to find if there&amp;rsquo;s any NTLM v1 or LM traffic. Let&amp;rsquo;s parse this with with a custom XML filter for all records matching Event ID 4624 that don&amp;rsquo;t contain &amp;lsquo;NTLM v2&amp;rsquo;, &amp;lsquo;Kerberos&amp;rsquo; or &amp;lsquo;-&amp;rsquo; authentication types.&lt;br&gt;
NOTE: This is the relevant part of my code for the filtering. The full script does some other things like emailing me a report, which is why there are other functions and variables referenced:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;foreach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$domaincontroller&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$domaincontrollers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Clear-Variable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eventlog&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$query&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sh&#34;&gt;@&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;	&amp;lt;QueryList&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;           &amp;lt;Query Id=&amp;#34;0&amp;#34;&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;              &amp;lt;Select Path=&amp;#34;Security&amp;#34;&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;                *[System[(EventID=&amp;#39;4624&amp;#39;)]]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;	      &amp;lt;/Select&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;	      &amp;lt;Suppress Path=&amp;#34;Security&amp;#34;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;                *[EventData[Data[@Name=&amp;#39;AuthenticationPackageName&amp;#39;] and (Data=&amp;#39;NTLM v2&amp;#39;)]] or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;                *[EventData[Data[@Name=&amp;#39;AuthenticationPackageName&amp;#39;] and (Data=&amp;#39;Kerberos&amp;#39;)]] or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;                *[EventData[Data[@Name=&amp;#39;AuthenticationPackageName&amp;#39;] and (Data=&amp;#39;-&amp;#39;)]]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;               &amp;lt;/Suppress&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;           &amp;lt;/Query&amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;	&amp;lt;/QueryList&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sh&#34;&gt;&amp;#34;@&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$eventlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-WinEvent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-FilterXml&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$query&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$MyReport&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-CustomHeader&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;NTLMv1 Events on domain controller &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$domaincontroller&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$MyReport&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-HtmlTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$eventlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;4624&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TimeCreated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$MyReport&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-CustomHeaderClose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$MyReport&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-CustomHeader0Close&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$MyReport&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-CustomHTMLClose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Good!&lt;br&gt;
The only relevant entries I found were from a server that I upgraded 3 weeks ago, specifically because it was using NTLM for an obsolete application. After tossing on a supported OS and upgrading to the current application version, NTLMv1 authentication from this server stopped.&lt;/p&gt;
&lt;h3 id=&#34;block&#34;&gt;Block
&lt;/h3&gt;&lt;p&gt;MS exposes a GPO value to control the NTLM authentication methods available on the domain. &lt;strong&gt;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\&lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-lan-manager-authentication-level&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Network security: LAN Manager authentication level&lt;/a&gt;&lt;/strong&gt; will enforce these behaviours:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Setting&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
          &lt;th&gt;Registry security level&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Send LM &amp;amp; NTLM responses&lt;/td&gt;
          &lt;td&gt;Client devices use LM and NTLM authentication, and they never use NTLMv2 session security. Domain controllers accept LM, NTLM, and NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Send LM &amp;amp; NTLM – use NTLMv2 session security if negotiated&lt;/td&gt;
          &lt;td&gt;Client devices use LM and NTLM authentication, and they use NTLMv2 session security if the server supports it. Domain controllers accept LM, NTLM, and NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;1&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Send NTLM response only&lt;/td&gt;
          &lt;td&gt;Client devices use NTLMv1 authentication, and they use NTLMv2 session security if the server supports it. Domain controllers accept LM, NTLM, and NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;2&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Send NTLMv2 response only&lt;/td&gt;
          &lt;td&gt;Client devices use NTLMv2 authentication, and they use NTLMv2 session security if the server supports it. Domain controllers accept LM, NTLM, and NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;3&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Send NTLMv2 response only. Refuse LM&lt;/td&gt;
          &lt;td&gt;Client devices use NTLMv2 authentication, and they use NTLMv2 session security if the server supports it. Domain controllers refuse to accept LM authentication, and they will accept only NTLM and NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;4&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Send NTLMv2 response only. Refuse LM &amp;amp; NTLM&lt;/td&gt;
          &lt;td&gt;Client devices use NTLMv2 authentication, and they use NTLMv2 session security if the server supports it. Domain controllers refuse to accept LM and NTLM authentication, and they will accept only NTLMv2 authentication.&lt;/td&gt;
          &lt;td&gt;5&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Obviously, 0 is the most insecure setting, but the most compatible. If your domain ever had a Domain Level lower than Windows Server 2008, 0 is probably what you&amp;rsquo;ll be using. Since Windows Server 2008, the default has been 3.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;d previously changed our domain from 0 to 2, but now that our last NTLMv1 application is gone, I&amp;rsquo;ve set this to 3. We&amp;rsquo;re headed full speed into &lt;del&gt;the future!&lt;/del&gt; 2008.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Pushing Hugo Content to GitHub</title>
        <link>http://localhost:1313/posts/hugo-github/</link>
        <pubDate>Wed, 04 Aug 2021 07:49:02 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/hugo-github/</guid>
        <description>&lt;p&gt;This blog content is generated by the &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Hugo&lt;/a&gt; static site generator and integrated with GitHub (which you can clearly tell by the URL), but I&amp;rsquo;m always struggling to remember the steps in pushing the newest content publicly.&lt;/p&gt;
&lt;p&gt;But I&amp;rsquo;m getting ahead of myself. Before I get there, hugo and github need to be integrated. I&amp;rsquo;m using Windows 10, so I needed to start by installing git locally.
Once that was complete, I had the &lt;em&gt;git bash shell&lt;/em&gt; that I could use to generate the SSH keys that my computer will use to connect with my github account. On Windows 10, the .ssh directory is located at C:\Users\Administrator.ssh&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Start by generating a new SSH key to use for this connection. I used the ed25519 algorithm, which is faster and more &amp;lsquo;secure&amp;rsquo; than the RSA-2048 key that&amp;rsquo;s commonly used today:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Administrator@AC08871 MINGW64 ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ssh-keygen -t ed25519 -C &lt;span class=&#34;s2&#34;&gt;&amp;#34;email@email.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Then, copy the newly generated public key to the clipboard, because we&amp;rsquo;re going to paste it to github:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Administrator@AC08871 MINGW64 ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ clip &amp;lt; id_ed25519.pub
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Log into github &amp;gt; Settings &amp;gt; SSH &amp;amp; GPG Keys. Create a new SSH key, and paste in the contents of the clipboard (which is the public key I just created)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Test the connection via. &lt;em&gt;git bash shell&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Administrator@AC08871 MINGW64 ~/.ssh
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ssh -T git@github.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hi gbeifuss! You&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;ve successfully authenticated, but GitHub does not provide shell access.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now that the connection between my computer and github is established, let&amp;rsquo;s configure github as a remote repository:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt; git remote add origin https://github.com/gbeifuss/gbeifuss.github.io.git

C:\Users\Greg\OneDrive\myblog.dev.repo\public&amp;gt;git remote -v
origin  https://github.com/gbeifuss/gbeifuss.github.io.git (fetch)
origin  https://github.com/gbeifuss/gbeifuss.github.io.git (push)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Finally, I&amp;rsquo;m ready to push my content up:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Change to your site&amp;rsquo;s local directory, then tell Hugo to build the content:&lt;br&gt;
&lt;code&gt;cd myblog.dev.repo&lt;/code&gt;&lt;br&gt;
&lt;code&gt;hugo&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Change to your site&amp;rsquo;s public directory (where the new content was just generated):&lt;br&gt;
&lt;code&gt;cd public&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Add all of the new files to git. This command analyzes the repository files, adding all modified and/or untracked files in the current directory and subdirectories to staged status. This prepares them for inclusion in the next &lt;code&gt;git commit&lt;/code&gt;. The &lt;code&gt;.gitignore&lt;/code&gt; file can be used to define any files/patterns that should be skipped:&lt;br&gt;
&lt;code&gt;git add .&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Commit the locally staged files with a comment. This command will add &lt;em&gt;all&lt;/em&gt; the changed files, so be aware of that if you&amp;rsquo;re only intending to commit/push select files!:&lt;br&gt;
&lt;code&gt;git commit -m &amp;quot;Website update 2021-08-03&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Push the local content up to GitHub. &lt;em&gt;origin&lt;/em&gt; is the remote repository name (alias) and &lt;em&gt;main&lt;/em&gt; is the branch name. (Since October 2020, main is the default branch that must exist on any repository):&lt;br&gt;
&lt;code&gt;git push origin main&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And here it all is in a glorious code block, so that in the future, I can just copy and paste!&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd myblog.dev.repo
hugo
cd public
git add .
git commit -m &amp;#34;Website update 2021-08-03&amp;#34;
git push origin main
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I&amp;rsquo;ve also been trying to sort out how to update the theme I use (Stack), which is periodically updated. Right now my process is to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;log into github and pull the latest release into my fork&lt;/li&gt;
&lt;li&gt;delete the contents of &lt;code&gt;\themes\hugo-stack-theme&lt;/code&gt; on my computer&lt;/li&gt;
&lt;li&gt;tell git to repopulate the directory:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-git&#34; data-lang=&#34;git&#34;&gt;\myblog.dev.repo\themes&amp;gt; git clone git@github.com:gbeifuss/hugo-theme-stack hugo-theme-stack

Cloning into &amp;#39;hugo-theme-stack&amp;#39;...
remote: Enumerating objects: 3111, done.
remote: Counting objects: 100% (1026/1026), done.
remote: Compressing objects: 100% (416/416), done.
remote: Total 3111 (delta 796), reused 695 (delta 601), pack-reused 2085
Receiving objects: 100% (3111/3111), 841.36 KiB | 2.85 MiB/s, done.
Resolving deltas: 100% (1958/1958), done.

\myblog.dev.repo\themes&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;recopy my avatar image to &lt;code&gt;\themes\hugo-stack-theme\assets\img\&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>Array Speed in Powershell</title>
        <link>http://localhost:1313/posts/powershell-arrayspeed/</link>
        <pubDate>Thu, 22 Jul 2021 22:10:02 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-arrayspeed/</guid>
        <description>&lt;p&gt;A popular and quick way to work with arrays in Powershell is to use a &lt;code&gt;+=&lt;/code&gt; operation:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.10000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Foreach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Adding &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; to the array&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;rsquo;s time this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Diagnostics.Stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StartNew&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.100000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Foreach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Adding &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; to the array&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{0} elements collected in {1:n1} seconds&amp;#39;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Elapsed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;TotalSeconds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Processing these 100,000 records took my system 214.7 seconds. When Powershell code uses the &lt;code&gt;+=&lt;/code&gt; operator, it actually creates a new array that&amp;rsquo;s one record larger than the current array, copies each existing entry into the new array and then adds the newest entry into the free record. It has to do this every time the &lt;code&gt;+=&lt;/code&gt; operator is used, which is 100,000 times in this sample code. The last time it runs, it needs to copy 99,999 existing entries into a new array&amp;hellip;.ouch! It&amp;rsquo;s easy to see &lt;em&gt;why&lt;/em&gt; this is so slow!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/img/array.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;fantastic excel art&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s use a .NET method to do this and see whether it&amp;rsquo;s any faster:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Collections.ArrayList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Diagnostics.Stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StartNew&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.100000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Foreach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$null&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Adding &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; to the array&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{0} elements collected in {1:n1} seconds&amp;#39;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Elapsed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;TotalSeconds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Instead of 214.7 seconds, this takes 0.4 seconds - a &lt;em&gt;53,575% speed increase&lt;/em&gt; with next to no extra work.&lt;br&gt;
&lt;em&gt;Technically, I should have used &lt;code&gt;[System.Collections.Generic.List]&lt;/code&gt; instead, as that&amp;rsquo;s what Microsoft recommends.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;You can do this in pure Powershell too, but it only handles one item per iteration. Because you&amp;rsquo;re returning more than one element, Powershell will automatically create an array. This method also took 0.4 seconds.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Diagnostics.Stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;StartNew&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.100000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Foreach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Adding &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; to the array&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{0} elements collected in {1:n1} seconds&amp;#39;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$report&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$stopwatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Elapsed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;TotalSeconds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Both the .NET method and Powershell&amp;rsquo;s native array-creation can append arrays without having to recreate/repopulate them. That&amp;rsquo;s why they&amp;rsquo;re equally fast, and both &lt;em&gt;far&lt;/em&gt; faster than &lt;code&gt;+=&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now, &lt;code&gt;+=&lt;/code&gt; isn&amp;rsquo;t always evil. It&amp;rsquo;s useful for adding numbers. However, once you start working with array objects, you incur the performance penalty. If you use &lt;code&gt;+=&lt;/code&gt; on a string, you incur the performance penalty since a string is really an &lt;em&gt;array of characters&lt;/em&gt;. If you&amp;rsquo;re working with small arrays and the performance hit is acceptable, then there&amp;rsquo;s no real harm in using it.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Powershell Stopwatch vs Measure-Command</title>
        <link>http://localhost:1313/posts/powershell-stopwatch-measurecommand/</link>
        <pubDate>Thu, 22 Jul 2021 22:09:50 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-stopwatch-measurecommand/</guid>
        <description>&lt;p&gt;Often, I&amp;rsquo;ll see scripts that use &lt;code&gt;Measure-Command&lt;/code&gt; to calculate the length of time that code runs, while other code will use the &lt;code&gt;$stopwatch = [System.Diagnostics.Stopwatch]::StartNew()&lt;/code&gt; method. I&amp;rsquo;d always thought that these were interchangable and practically identical, however, I&amp;rsquo;ve found out that they&amp;rsquo;re not. Depending on the code, there can be substantial time differences between the two.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Measure-Command&lt;/code&gt; will discard the pipeline output, measuring only the time it takes to actually execute the command.&lt;/p&gt;
&lt;p&gt;The stopwatch timer measures everything, including the time it takes to display any output to the console.&lt;/p&gt;
&lt;p&gt;To have &lt;code&gt;Measure-Command&lt;/code&gt; to measure the time needed to write to the console, add an &lt;strong&gt;explicit pipe&lt;/strong&gt; to &lt;code&gt;Out-Host&lt;/code&gt; inside the script block that you&amp;rsquo;re measuring. This will write the output to the console, and cause a corresponding increase in the measured time.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Powershell &amp; Unresponsive Remote Sessions</title>
        <link>http://localhost:1313/posts/powershell-kill-remote-sessions/</link>
        <pubDate>Thu, 22 Jul 2021 22:09:32 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-kill-remote-sessions/</guid>
        <description>&lt;p&gt;The other day I started a remote powershell session with &lt;code&gt;Invoke-Command&lt;/code&gt; and my script ran&amp;hellip;&lt;br&gt;
and ran&amp;hellip;&lt;br&gt;
and ran&amp;hellip;&lt;br&gt;
I finally tired of waiting, so I decided that I&amp;rsquo;d RDP in and get the information via. GUI, but the server was sluggish. This isn&amp;rsquo;t an underspec&amp;rsquo;ed server where routine use might cause a small but noticable performance hit. I took a look at taskman and saw that the wsmprovhost.exe process was consuming 50/64GB RAM.&lt;/p&gt;
&lt;p&gt;It turns out that this is the process responsible for remote Powershell sessions. While I could just kill it, I wanted to see what is going on behind the scenes.&lt;/p&gt;
&lt;p&gt;First, I grabbed the URI for WSMan connections:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$URI&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://{0}:5985/wsman&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$env:computername&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$URI&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SERVER&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5985&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wsman&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, I listed the connections to that URI. I could have filtered on the sessions owned by my user ID to avoid impacting others who might have active sessions, but I&amp;rsquo;m the only IT staff who uses Powershell, so that&amp;rsquo;s unnecessary:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-WSManInstance&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ConnectionURI&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$URI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ResourceURI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$connection&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rsp&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wbem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wsman&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellId&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;4C1DF700&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;45AE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4322&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;8FAC-E4E688F3F52C&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Runspace10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ResourceUri&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Owner&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;USERNAME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ClientIP&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProcessId&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;20956&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdleTimeOut&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT7200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;000S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InputStreams&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;OutputStreams&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MaxIdleTimeOut&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT2147483&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;647S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Locale&lt;/span&gt;          &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;DataLocale&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CompressionMode&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;XpressCompression&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProfileLoaded&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Encoding&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UTF8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;BufferMode&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Block&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;State&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connected&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellRunTime&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P3DT2H43M28S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellInactivity&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P0DT0H1M21S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MemoryUsed&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ChildProcesses&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rsp&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wbem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wsman&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellId&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;3A169BBF-C590&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;4D36-A055&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;88ED9B9F741C&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Runspace24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ResourceUri&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Owner&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;USERNAME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ClientIP&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProcessId&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;18776&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdleTimeOut&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT7200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;000S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InputStreams&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;OutputStreams&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MaxIdleTimeOut&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT2147483&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;647S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Locale&lt;/span&gt;          &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;DataLocale&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CompressionMode&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;XpressCompression&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProfileLoaded&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Encoding&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UTF8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;BufferMode&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Block&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;State&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connected&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellRunTime&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P0DT15H38M57S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellInactivity&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P0DT0H0M27S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MemoryUsed&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;48818&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ChildProcesses&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rsp&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wbem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wsman&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;lang&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellId&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;337E488F&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;5385&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;485B-A74B-DDF5FB76AEF5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Runspace17&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ResourceUri&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schemas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Owner&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;USERNAME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ClientIP&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProcessId&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;11288&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IdleTimeOut&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT7200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;000S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InputStreams&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;OutputStreams&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MaxIdleTimeOut&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PT2147483&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;647S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Locale&lt;/span&gt;          &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;DataLocale&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;en-US&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CompressionMode&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;XpressCompression&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProfileLoaded&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Encoding&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UTF8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;BufferMode&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Block&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;State&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connected&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellRunTime&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P3DT0H19M58S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ShellInactivity&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;P0DT0H1M49S&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MemoryUsed&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;MB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ChildProcesses&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Bingo! There&amp;rsquo;s the session consuming 48818MB of RAM. I don&amp;rsquo;t recall what my other sessions are for, so I&amp;rsquo;ll just kill them all.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Remove-WSManInstance&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ConnectionURI&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$URI&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ShellID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ShellID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After a few seconds, taskman showed that the wsmprovhost.exe process was rapidly releasing RAM:&lt;br&gt;
50GB&amp;hellip;&lt;br&gt;
37GB&amp;hellip;&lt;br&gt;
24GB&amp;hellip;&lt;br&gt;
12GB&amp;hellip;&lt;br&gt;
process ended.&lt;/p&gt;
&lt;p&gt;And with that, the server was back to being its usual snappy self.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Powershell, Exchange &amp; TLS</title>
        <link>http://localhost:1313/posts/powershell-exchange-tls/</link>
        <pubDate>Mon, 19 Jul 2021 16:53:03 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-exchange-tls/</guid>
        <description>&lt;p&gt;I was recently curious about what sort of SSL/TLS connections were being used to access our Exchange cluster via. IIS. We have systems spanning twenty years: from Windows XP all the way to Windows Server 2019. Who knows what &amp;ldquo;solutions&amp;rdquo; developers or power users have come up with over the years to integrate with our mail system?&lt;/p&gt;
&lt;p&gt;Previously, I&amp;rsquo;d followed MS guidance in &lt;a class=&#34;link&#34; href=&#34;https://techcommunity.microsoft.com/t5/exchange-team-blog/exchange-server-tls-guidance-part-2-enabling-tls-1-2-and/ba-p/607761&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Enabling TLS 1.2&lt;/a&gt; and &lt;a class=&#34;link&#34; href=&#34;https://www.microsoft.com/security/blog/2017/09/07/new-iis-functionality-to-help-identify-weak-tls-usage/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;New IIS Functionality to Help Identify Weak TLS Usage&lt;/a&gt;. The IIS blog explains how to set 4 server variables in IIS to track security protocols and cipher suites:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CRYPT_PROTOCOL&lt;/li&gt;
&lt;li&gt;CRYPT_CIPHER_ALG_ID&lt;/li&gt;
&lt;li&gt;CRYPT_HASH_ALG_ID&lt;/li&gt;
&lt;li&gt;CRYPT_KEYEXCHANGE_ALG_ID&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;First, I needed to figure out what was actually being recorded by the logs.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#Date: 2021-03-04 00:00:03
#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) cs(Referer) sc-status sc-substatus sc-win32-status time-taken crypt-protocol crypt-cipher crypt-hash crypt-keyexchange OriginalClientIP
2021-03-03 23:59:55 10.10.1.103 POST /EWS/Exchange.asmx &amp;amp;CorrelationID=&amp;lt;empty&amp;gt;;&amp;amp;cafeReqId=7a4501f0-3d61-425d-8d1f-0c3d5c9e6d13; 443 DOMAIN\webmail 10.10.1.58 ExchangeServicesClient/15.00.0913.015 - 200 0 0 38 400 660e 800c ae06 -
2021-03-03 23:59:55 10.10.1.103 POST /EWS/Exchange.asmx &amp;amp;CorrelationID=&amp;lt;empty&amp;gt;;&amp;amp;cafeReqId=42acb956-ea0a-4a32-a097-0bc73ae92860; 443 - 10.10.12.120 ExchangeServicesClient/15.00.0913.015 - 401 1 2148074254 1 400 660e 800c ae06 -
2021-03-03 23:59:55 10.10.1.103 POST /EWS/Exchange.asmx &amp;amp;CorrelationID=&amp;lt;empty&amp;gt;;&amp;amp;cafeReqId=0e312297-90fc-4b4d-8a28-24c3c60bcb7e; 443 - 10.10.12.120 ExchangeServicesClient/15.00.0913.015 - 401 1 2148074254 2 400 660e 800c ae06 -
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The information I needed was in the 15th field (crypt-protocol). A value of &amp;lsquo;400&amp;rsquo; correlates to TLS 1.2, &amp;lsquo;40&amp;rsquo; represents TLS 1.0, &amp;lsquo;10&amp;rsquo; represents SSLv3 and so forth. There&amp;rsquo;s Microsoft documentation that explains the various values.&lt;/p&gt;
&lt;p&gt;So, let&amp;rsquo;s write some sloppy proof-of-concept code to parse the IIS log files on 1 server. We can then wrap it in a &lt;code&gt;foreach&lt;/code&gt; statement, or something like that, to query all the servers once it&amp;rsquo;s working. Let&amp;rsquo;s do some rough calculations on how long this will take by wrapping it in a &lt;code&gt;measure-command&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Measure-Command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Import-Csv&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inetpub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LogFiles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u_ex210713_x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;log&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Delimiter&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Header&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;date&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;time&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;s-ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cs-method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cs-uri&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-stem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cs-uri&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;s-port&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cs-username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;c-ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;cs(user-Agent)&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;cs(Referer)&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;sc-status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;sc-substatus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;sc-win32&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;time-taken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;crypt-protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;crypt-cipher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;crypt-hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;crypt-keyexchange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;OriginalClientIP&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;crypt-protocol&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inetpub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LogFiles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u_ex210713_x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; lines processed.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Days&lt;/span&gt;              &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hours&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Minutes&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;17&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Seconds&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Milliseconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;253&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Ticks&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10212530494&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalDays&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.0118200584421296&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalHours&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.283681402611111&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMinutes&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;17.0208841566667&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalSeconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1021.2530494&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMilliseconds&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1021253.0494&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This command took 17 minutes to run against one file on one server! I have 10 log files on each server (I wrote a separate script to automatically purge files older than that in order to save disk space). Aside from this script seeming ridiculously slow, it&amp;rsquo;ll be a whole day before my curiosity is satisfied - this simply won&amp;rsquo;t do!&lt;/p&gt;
&lt;p&gt;Instead of the slow process of reading the whole file into memory, enumerating the columns and adding data to an array that we&amp;rsquo;re constantly resizing, let&amp;rsquo;s use a faster method. I&amp;rsquo;ll read in 1000 rows at a time, split each row to find the 15th column, exclude irrelevant information, and add those results to an array.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Measure-Command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$nlines&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inetpub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LogFiles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u_ex210713_x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;log&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ReadCount&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;ForEach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;400&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;time-taken&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$line&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$nlines&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Length&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group-Object&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{1} lines&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$nlines&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Days&lt;/span&gt;              &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hours&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Minutes&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;12&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Seconds&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;14&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Milliseconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;149&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Ticks&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;7341497722&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalDays&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00849710384490741&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalHours&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.203930492277778&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMinutes&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;12.2358295366667&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalSeconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;734.1497722&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMilliseconds&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;734149.7722&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Well, 12 minutes is somewhat better - a 30% improvement - but still not good enough. Let&amp;rsquo;s get rid of the two tremendously slow array additions, which even activate in conjunction, slowing things down further. Arrays are fixed sizes. When you use the &lt;code&gt;+=&lt;/code&gt; operator, PowerShell actually creates a &lt;em&gt;new&lt;/em&gt; array with the values of the original array &lt;em&gt;plus&lt;/em&gt; the added value. Each time I add a value, the entire existing array is replicated into a new array with one more value. It&amp;rsquo;s terribly inefficient when you have large amounts of data like the 129,102 entries in this file.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s use a .NET method to fix this speed issue. An ArrayList with a .Add() method is far more efficient for what I&amp;rsquo;m doing.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Measure-Command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Collections.ArrayList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inetpub&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LogFiles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u_ex210713_x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;log&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ReadCount&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;400&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;time-taken&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;vm&#34;&gt;$null&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Days&lt;/span&gt;              &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hours&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Minutes&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Seconds&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Milliseconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;314&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Ticks&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;83145768&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalDays&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;62335277777778E&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;05&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalHours&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.00230960466666667&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMinutes&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.13857628&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalSeconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;8.3145768&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMilliseconds&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;8314.5768&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A 12180% speed increase from my first code is much better. Now let&amp;rsquo;s run this against all 10 files in the directory, then dump the statistics I&amp;rsquo;m interested in:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Measure-Command&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Collections.ArrayList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\*.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ReadCount&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1000&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ForEach-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;400&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;time-taken&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-and&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;vm&#34;&gt;$null&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; matching entries in &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\*.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; processed lines.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Days&lt;/span&gt;              &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hours&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Minutes&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Seconds&lt;/span&gt;           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Milliseconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Ticks&lt;/span&gt;             &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;680073775&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalDays&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.000787122424768519&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalHours&lt;/span&gt;        &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.0188909381944444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMinutes&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.13345629166667&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalSeconds&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;68.0073775&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;TotalMilliseconds&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;68007.3775&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Group-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Count&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;mf&#34;&gt;1340&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;250&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;169.254&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;178&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;mf&#34;&gt;85&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;12&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Protocol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; matching entries in &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W3SVC1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\*.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; processed lines.&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;1445&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;matching&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;entries&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1589761&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;processed&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lines&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This code for &lt;em&gt;all 10 files&lt;/em&gt; is 1400% faster than the code I started with to read a &lt;em&gt;single file&lt;/em&gt;. There are 4 IPs connecting to Exchange using something other than TLS 1.2, but they&amp;rsquo;re all private IPs for the Exchange cluster itself, or the replication network.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Docker &amp; Printnightmare</title>
        <link>http://localhost:1313/posts/docker-printnightmare/</link>
        <pubDate>Wed, 14 Jul 2021 08:21:50 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/docker-printnightmare/</guid>
        <description>&lt;p&gt;Since CVE-2021 is the news item of the week, I decided that I should scan our infrastructure using byt3bl33d3r&amp;rsquo;s &lt;a class=&#34;link&#34; href=&#34;https://github.com/byt3bl33d3r/ItWasAllADream&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CVE-2021-34527 Python Scanner&lt;/a&gt;. I learned Docker basics on the fly with this.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Download Docker Desktop for Windows. Reboot if necessary.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install WSL2, as prompted. Reboot if necessary.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a new directory from the CLI and clone the repo:
&lt;code&gt;git clone https://github.com/byt3bl33d3r/ItWasAllADream&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This gave me a small problem:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\Docker&amp;gt;git clone https://github.com/byt3bl33d3r/ItWasAllADream
Cloning into &amp;#39;ItWasAllADream&amp;#39;...
fatal: unable to access &amp;#39;https://github.com/byt3bl33d3r/ItWasAllADream/&amp;#39;: SSL certificate problem: unable to get local issuer certificate
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Since I&amp;rsquo;m pulling from github.com, which has a valid certificate, and not some private repo with a self-signed certificate, I realised pretty quickly that this was likely due to our corporate web-filtering software. I told git to bypass certificate checking, and everything processed properly:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\Docker&amp;gt;git config --global http.sslVerify false
D:\docker&amp;gt;git clone https://github.com/byt3bl33d3r/ItWasAllADream
Cloning into &amp;#39;ItWasAllADream&amp;#39;...
remote: Enumerating objects: 57, done.
remote: Counting objects: 100% (57/57), done.
remote: Compressing objects: 100% (38/38), done.
remote: Total 57 (delta 29), reused 45 (delta 17), pack-reused 0 eceiving objects:  56% (32/57)
Receiving objects: 100% (57/57), 51.22 KiB | 8.54 MiB/s, done.
Resolving deltas: 100% (29/29), done.

D:\docker&amp;gt;git config --global http.sslVerify true
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Build the docker container:
&lt;code&gt;cd ItWasAllADream &amp;amp;&amp;amp; docker build -t itwasalladream .&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This gave me bigger problems:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\docker&amp;gt;cd ItWasAllADream &amp;amp;&amp;amp; docker build -t itwasalladream .
[+] Building 117.3s (8/8) FINISHED
=&amp;gt; [internal] load build definition from Dockerfile                                                                         0.1s
=&amp;gt; =&amp;gt; transferring dockerfile: 329B                                                                                         0.0s
=&amp;gt; [internal] load .dockerignore                                                                                            0.0s
=&amp;gt; =&amp;gt; transferring context: 53B                                                                                             0.0s
=&amp;gt; [internal] load metadata for docker.io/library/python:3.8-slim                                                          28.8s
=&amp;gt; [1/4] FROM docker.io/library/python:3.8-slim@sha256:9b0d7419e2811710aacee87c40a2c94693e2b6810c3e7e466b8c7fc5bde4cd66    30.5s
=&amp;gt; =&amp;gt; resolve docker.io/library/python:3.8-slim@sha256:9b0d7419e2811710aacee87c40a2c94693e2b6810c3e7e466b8c7fc5bde4cd66     0.0s
=&amp;gt; =&amp;gt; sha256:3bc519ca3214d463ac521f838275e1070ab4b8dbb12e568b4739794db837dadb 1.37kB / 1.37kB                               0.0s
=&amp;gt; =&amp;gt; sha256:0e0d73ddd34d599cf70c5855f18135e51a9cba957b4cd41a7c677d0d3cb4edc2 7.67kB / 7.67kB                               0.0s
=&amp;gt; =&amp;gt; sha256:b4d181a07f8025e00e0cb28f1cc14613da2ce26450b80c54aea537fa93cf3bda 27.15MB / 27.15MB                            26.0s
=&amp;gt; =&amp;gt; sha256:de8ecf497b753094723ccf9cea8a46076e7cb845f333df99a6f4f397c93c6ea9 2.77MB / 2.77MB                               4.9s
=&amp;gt; =&amp;gt; sha256:6ea9cb12457214a5eda82bc4aad8fc1b20c0cee03042d4b6b6da946a94af3274 10.73MB / 10.73MB                            29.1s
=&amp;gt; =&amp;gt; sha256:9b0d7419e2811710aacee87c40a2c94693e2b6810c3e7e466b8c7fc5bde4cd66 1.86kB / 1.86kB                               0.0s
=&amp;gt; =&amp;gt; sha256:9a8aa9d08ec5d2bb15de97e33b599bb4472ccd7d58fe4f15f0dfd7d4fd08fa6d 234B / 234B                                   6.2s
=&amp;gt; =&amp;gt; sha256:360b2e4ced966675f720b48dee317e200ed394abc8b95609a31bfb5225b4f746 2.64MB / 2.64MB                              12.9s
=&amp;gt; =&amp;gt; extracting sha256:b4d181a07f8025e00e0cb28f1cc14613da2ce26450b80c54aea537fa93cf3bda                                    1.9s
=&amp;gt; =&amp;gt; extracting sha256:de8ecf497b753094723ccf9cea8a46076e7cb845f333df99a6f4f397c93c6ea9                                    0.2s
=&amp;gt; =&amp;gt; extracting sha256:6ea9cb12457214a5eda82bc4aad8fc1b20c0cee03042d4b6b6da946a94af3274                                    0.6s
=&amp;gt; =&amp;gt; extracting sha256:9a8aa9d08ec5d2bb15de97e33b599bb4472ccd7d58fe4f15f0dfd7d4fd08fa6d                                    0.0s
=&amp;gt; =&amp;gt; extracting sha256:360b2e4ced966675f720b48dee317e200ed394abc8b95609a31bfb5225b4f746                                    0.3s
=&amp;gt; [internal] load build context                                                                                            1.1s
=&amp;gt; =&amp;gt; transferring context: 194.50kB                                                                                        1.0s
=&amp;gt; [2/4] RUN apt-get update &amp;amp;&amp;amp;     apt-get install --no-install-recommends -y git curl &amp;amp;&amp;amp;     rm -rf /var/lib/apt/lists/*  47.0s
=&amp;gt; [3/4] COPY . .                                                                                                           0.0s
=&amp;gt; ERROR [4/4] RUN pip3 install poetry &amp;amp;&amp;amp;     poetry config virtualenvs.create false &amp;amp;&amp;amp;     poetry install                 10.9s
------
&amp;gt; [4/4] RUN pip3 install poetry &amp;amp;&amp;amp;     poetry config virtualenvs.create false &amp;amp;&amp;amp;     poetry install:
#8 2.071 WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &amp;#39;SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))&amp;#39;: /simple/poetry/
#8 2.648 WARNING: Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by &amp;#39;SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))&amp;#39;: /simple/poetry/
#8 3.725 WARNING: Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by &amp;#39;SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))&amp;#39;: /simple/poetry/
#8 5.796 WARNING: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by &amp;#39;SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))&amp;#39;: /simple/poetry/
#8 10.30 WARNING: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by &amp;#39;SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))&amp;#39;: /simple/poetry/
#8 10.63 Could not fetch URL https://pypi.org/simple/poetry/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&amp;#39;pypi.org&amp;#39;, port=443): Max retries exceeded with url: /simple/poetry/ (Caused by SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))) - skipping
#8 10.64 ERROR: Could not find a version that satisfies the requirement poetry (from versions: none)
#8 10.64 ERROR: No matching distribution found for poetry
#8 10.79 Could not fetch URL https://pypi.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&amp;#39;pypi.org&amp;#39;, port=443): Max retries exceeded with url: /simple/pip/ (Caused by SSLError(SSLCertVerificationError(1, &amp;#39;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1131)&amp;#39;))) - skipping
------
executor failed running [/bin/sh -c pip3 install poetry &amp;amp;&amp;amp;     poetry config virtualenvs.create false &amp;amp;&amp;amp;     poetry install]: exit code: 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I realised that since this was being done outside of git, my earlier config changes would have no effect. I bypassed the web filtering software entirely (a benefit of being a sysadmin), and Docker went on its merry way:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\docker&amp;gt;cd ItWasAllADream &amp;amp;&amp;amp; docker build -t itwasalladream .
[+] Building 42.3s (9/9) FINISHED
=&amp;gt; [internal] load build definition from Dockerfile                                                                         0.0s
=&amp;gt; =&amp;gt; transferring dockerfile: 329B                                                                                         0.0s
=&amp;gt; [internal] load .dockerignore                                                                                            0.0s
=&amp;gt; =&amp;gt; transferring context: 53B                                                                                             0.0s
=&amp;gt; [internal] load metadata for docker.io/library/python:3.8-slim                                                           9.4s
=&amp;gt; [1/4] FROM docker.io/library/python:3.8-slim@sha256:9b0d7419e2811710aacee87c40a2c94693e2b6810c3e7e466b8c7fc5bde4cd66     0.0s
=&amp;gt; [internal] load build context                                                                                            0.1s
=&amp;gt; =&amp;gt; transferring context: 194.50kB                                                                                        0.1s
=&amp;gt; CACHED [2/4] RUN apt-get update &amp;amp;&amp;amp;     apt-get install --no-install-recommends -y git curl &amp;amp;&amp;amp;     rm -rf /var/lib/apt/l  0.0s
=&amp;gt; [3/4] COPY . .                                                                                                           0.0s
=&amp;gt; [4/4] RUN pip3 install poetry &amp;amp;&amp;amp;     poetry config virtualenvs.create false &amp;amp;&amp;amp;     poetry install                       31.5s
=&amp;gt; exporting to image                                                                                                       1.2s
=&amp;gt; =&amp;gt; exporting layers                                                                                                      1.1s
=&amp;gt; =&amp;gt; writing image sha256:717ceee523a84d3c659caecce847883ca2bf123b1e3af428388c7047fee712a8                                 0.0s
=&amp;gt; =&amp;gt; naming to docker.io/library/itwasalladream                                                                            0.0s

Use &amp;#39;docker scan&amp;#39; to run Snyk tests against images to find vulnerabilities and learn how to fix them
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Run a scan and wait for it to finish:
&lt;code&gt;docker run -it itwasalladream -u user -p password -d domain 192.168.1.0/24&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[itwasalladream] INFO - report_2021_07_08_155428.csv generated successfully
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;List the containers so that we can get the container name.
&lt;code&gt;docker ps -a&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\docker\ItWasAllADream&amp;gt;docker ps -a
CONTAINER ID   IMAGE            COMMAND                  CREATED          STATUS                      PORTS     NAMES
4793adbf54d7   itwasalladream   &amp;#34;itwasalladream -u g…&amp;#34;   25 minutes ago   Exited (0) 18 minutes ago             sad_taussig
f36834af30d0   itwasalladream   &amp;#34;itwasalladream -u g…&amp;#34;   36 minutes ago   Exited (0) 33 minutes ago             stupefied_banach
7fbeb77ce498   itwasalladream   &amp;#34;itwasalladream -u g…&amp;#34;   59 minutes ago   Exited (0) 58 minutes ago             intelligent_allen
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Copy the resulting CSV out of the container and to the current local directory&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;D:\docker\ItWasAllADream&amp;gt;docker cp sad_taussig:report_2021_07_08_155428.csv .
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Review the CSV:
&lt;code&gt;notepad report_2021_07_08_155428.csv&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Greg&lt;/p&gt;
</description>
        </item>
        <item>
        <title>VS Code &amp; Remote Repositories</title>
        <link>http://localhost:1313/posts/vscode-remoterepositories/</link>
        <pubDate>Wed, 14 Jul 2021 08:21:37 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/vscode-remoterepositories/</guid>
        <description>&lt;p&gt;I spend a lot of my day in VS Code, but not too much in GitHub because I don&amp;rsquo;t work on any joint projects. I do use a local Git repository for my code. It&amp;rsquo;s  easy to see when others have made changes so that I can &lt;del&gt;hunt them down&lt;/del&gt; speak politely to them about stopping.&lt;/p&gt;
&lt;p&gt;In any case, I was watching &lt;a class=&#34;link&#34; href=&#34;https://mybuild.microsoft.com/sessions/0c6868e4-6a2c-4749-b3f5-b18ff76609c9?source=sessions&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;An Introduction to Visual Studio Code and GitHub&lt;/a&gt; when I learned about the Remote Repositories (GitHub) extension for VS Code. You can directly edit a repository on GitHub without having to clone it locally.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Disclaimer&lt;/em&gt;
I must confess that in the process of using Remote Repository access this week, I managed to lose/erase 6 files that I hadn&amp;rsquo;t committed, but maybe you&amp;rsquo;re more of a git savant than I am, and you&amp;rsquo;ll have no problems.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s look at how to get this installed and integrated with VS Code:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Load VS Code&lt;/li&gt;
&lt;li&gt;Open Extensions (CTRL+SHIFT+X)&lt;/li&gt;
&lt;li&gt;Search for &lt;a class=&#34;link&#34; href=&#34;https://github.com/microsoft/vscode-remote-repositories-github&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Remote Repositories (GitHub)&lt;/a&gt;. Install it.&lt;/li&gt;
&lt;li&gt;Open the Command Palette (&lt;code&gt;CTRL+SHIFT+P&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Type in &lt;code&gt;Remote Repositories: Open Repository&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Open Repository from GitHub&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;You&amp;rsquo;ll be prompted to allow access to GitHub. Allow it.&lt;/li&gt;
&lt;li&gt;A browser window will open. Click &lt;code&gt;Continue&lt;/code&gt; to authorize access to GitHub.&lt;/li&gt;
&lt;li&gt;Sign in to GitHub. If you don&amp;rsquo;t already have an account, there won&amp;rsquo;t be any repositories for you to open in VS Code, will there?&lt;/li&gt;
&lt;li&gt;You should receive a &amp;lsquo;Success!&amp;rsquo; webpage, with an authorization token on it.
&lt;ul&gt;
&lt;li&gt;If your browser prompts you to Open Visual Studio Code, do so. It&amp;rsquo;ll save you the trouble of manually entering the authorization code. Once VS Code opens again, you&amp;rsquo;ll be prompted to &lt;code&gt;Allow an extension to open this URI&lt;/code&gt;. Permit it, and VS Code will complete the link.&lt;/li&gt;
&lt;li&gt;If the browser didn&amp;rsquo;t prompt, copy the authorization token. You&amp;rsquo;ll have to paste it into VS Code manually. The Command Palette field should be asking for the token, so paste it in.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;VS Code should now be able to open your repositories directly on GitHub.&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>VS Code Snippets</title>
        <link>http://localhost:1313/posts/vscode-snippets/</link>
        <pubDate>Wed, 14 Jul 2021 08:20:02 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/vscode-snippets/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve worked with computers for a couple of decades now, and I love Notepad&amp;hellip; #sorrynotsorry, &lt;code&gt;vim&lt;/code&gt; fans. It&amp;rsquo;s fantastic for writing - there&amp;rsquo;s no fancy GUI needing customization to fit your workflow, and offers just enough structure that it&amp;rsquo;s usable for a variety of tasks. It&amp;rsquo;s like the pre-markdown version of markdown.
My favourite feature of Notepad is the ability to insert the date &amp;amp; time via. F5. This is a brilliant and elegant (and often overlooked) feature. Word&amp;rsquo;s &lt;em&gt;insert date/time&lt;/em&gt; function pales in comparison to the elegant simplicty of F5. Even trying to use keyboard shortcuts isn&amp;rsquo;t fast, when it should be.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Notepad&lt;/th&gt;
          &lt;th&gt;Word GUI&lt;/th&gt;
          &lt;th&gt;Work shortcuts&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;F5&lt;/td&gt;
          &lt;td&gt;click &lt;em&gt;Insert&lt;/em&gt;&lt;/td&gt;
          &lt;td&gt;ALT+I&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;click &lt;em&gt;Date/Time&lt;/em&gt;&lt;/td&gt;
          &lt;td&gt;D&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;read the menu&lt;/td&gt;
          &lt;td&gt;read the menu&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;double-click choice&lt;/td&gt;
          &lt;td&gt;UP/DOWN ARROW to choice&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;&lt;/td&gt;
          &lt;td&gt;ENTER&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;When I write Powershell scripts in VS Code, I had been manually typing in the date until I decided to write a custom snippet that would insert a header with all the things I normally add: script name, date/time, comments, my name. It&amp;rsquo;s automatically populated whenever I type in &lt;code&gt;header &amp;lt;ENTER&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open the Command Palette (View, Command Palette&amp;hellip;. or CTRL+SHIFT+P)&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Preferences: Configure User Snippets&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Powershell&lt;/code&gt; from the list&lt;/li&gt;
&lt;li&gt;Add the snippet:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; &amp;#34;File Header&amp;#34;: {
    &amp;#34;prefix&amp;#34;: &amp;#34;header&amp;#34;,
    &amp;#34;description&amp;#34;: &amp;#34;Output a file header with the file name, comment field, author and date&amp;#34;,
    &amp;#34;body&amp;#34;: [
        &amp;#34;#$TM_FILENAME&amp;#34;,
        &amp;#34;&amp;#34;,
        &amp;#34;&amp;lt;#&amp;#34;,
        &amp;#34;&amp;#34;,
        &amp;#34;&amp;#34;,
        &amp;#34;Greg Beifuss&amp;#34;,
        &amp;#34;$CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE&amp;#34;,
        &amp;#34;#&amp;gt;&amp;#34;,
        &amp;#34;&amp;#34;,
        &amp;#34;&amp;#34;,
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since I&amp;rsquo;m using VS Code to write markdown now, I decided to do a similar thing to reproduce Notepad&amp;rsquo;s F5 feature:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open the Command Palette (View, Command Palette&amp;hellip;. or CTRL+SHIFT+P)&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Preferences: Configure User Snippets&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;code&gt;Markdown&lt;/code&gt; from the list&lt;/li&gt;
&lt;li&gt;Add the snippet:
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;#34;Current Date and Time&amp;#34;: {
    &amp;#34;prefix&amp;#34;: &amp;#34;datetime&amp;#34;,
    &amp;#34;description&amp;#34;: &amp;#34;Add Current date &amp;amp; time&amp;#34;,
    &amp;#34;body&amp;#34;: [
        &amp;#34;$CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE&amp;#34;
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This snippet seems to be more tempermental - when I type in &lt;code&gt;datetime &amp;lt;ENTER&amp;gt;&lt;/code&gt;, usually it&amp;rsquo;s not replaced with the date/timestamp. I resort to:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;1. CTRL+I
2. datetime &amp;lt;ENTER&amp;gt;
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>Powershell, DSInternals &amp; HIBP</title>
        <link>http://localhost:1313/posts/powershell-dsinternals-hibp/</link>
        <pubDate>Mon, 12 Jul 2021 15:38:54 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-dsinternals-hibp/</guid>
        <description>&lt;p&gt;I&amp;rsquo;m a big fan of Michael Grafnetter&amp;rsquo;s excellent &lt;a class=&#34;link&#34; href=&#34;https://github.com/MichaelGrafnetter/DSInternals&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;DSInternals&lt;/a&gt; module for Powershell. I periodically use it to audit our AD instance, and pass the results along to our Security Admin for any followup that needs to happen. I usually use Have I Been Pwned&amp;rsquo;s password dump, but you can provide any file containing passwords. The scariest part is that it takes &amp;lt;5 minutes to compare your AD records against 613 million passwords&amp;hellip; and most of that time is enumerating the AD accounts.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how to run it against your AD instance:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Download the latest NTML (ordered by Hash) dump from &lt;a class=&#34;link&#34; href=&#34;https://haveibeenpwned.com/Passwords&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Have I Been Pwned?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Load Powershell.&lt;/li&gt;
&lt;li&gt;Install the module: &lt;code&gt;Install-Module DSInternals -Force&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Run the cmdlets:
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DictFile&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;d:\pwned-passwords-ntlm-ordered-by-hash-v5.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DC&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dc01&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Domain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=company,DC=com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-ADReplAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-All&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Server&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DC&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NamingContext&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Domain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Test-PasswordQuality&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WeakPasswordHashesSortedFile&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DictFile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IncludeDisabledAccounts&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Older versions of the tool used to output the passwords that were found in the dictionary you provided (ie. the HIBP dump), but no longer.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Running Powershell scripts with Task Scheduler</title>
        <link>http://localhost:1313/posts/powershell-scheduling-tasks/</link>
        <pubDate>Fri, 09 Jul 2021 16:08:41 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-scheduling-tasks/</guid>
        <description>&lt;p&gt;I do a fair amount of script writing to make my life easier. If it&amp;rsquo;s a repeated job, I try and automate it so that my time is freed up for more important (interesting) things. This is especially true if the task is tedious (with many manual steps) or involves lots of waiting around (like an Exchange CU). I have a fair number of Powershell scripts which run from Task Scheduler under Windows Server 2016. There are a lot of options to configure, so this can be complex. I&amp;rsquo;ll share the cheatcode way of doing this at the end.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Load Task Scheduler.&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;Create Task&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Under the &lt;strong&gt;General&lt;/strong&gt; tab, fill in a &lt;em&gt;Name&lt;/em&gt; and &lt;em&gt;Description&lt;/em&gt;. We&amp;rsquo;ll circle back to the other options at the end.&lt;/li&gt;
&lt;li&gt;Click &lt;strong&gt;Triggers&lt;/strong&gt;. Most of my jobs run on a time-based schedule, not events (like computer startup). Setup the schedule that you need.&lt;/li&gt;
&lt;li&gt;Under the &lt;strong&gt;Actions&lt;/strong&gt; tab, click &lt;em&gt;New&lt;/em&gt;. Another window will appear. Leave the &lt;em&gt;Action&lt;/em&gt; as &lt;code&gt;Start a program&lt;/code&gt;.&lt;br&gt;
If the script runs under Powershell 5.1, add &lt;code&gt;Powershell&lt;/code&gt; to the &lt;em&gt;Program/Script&lt;/em&gt; field.&lt;br&gt;
If the script runs under Powershell 7, add &lt;code&gt;&amp;quot;C:\Program Files\PowerShell\7\pwsh.exe&amp;quot;&lt;/code&gt; to the  &lt;em&gt;Program/Script&lt;/em&gt; field. It&amp;rsquo;s important to have the quotes so that the parser doesn&amp;rsquo;t freak out over the space in &amp;lsquo;Program Files&amp;rsquo;.&lt;br&gt;
Add the following &lt;em&gt;Arguments&lt;/em&gt;: &lt;code&gt;-executionpolicy bypass -command &amp;quot;&amp;amp; &#39;\\SERVER\SCRIPT REPOSITORY \script.ps1&#39;&amp;quot;&lt;/code&gt;. Again, I need double quotes around my UNC because of the space.&lt;/li&gt;
&lt;li&gt;I usually clear the &lt;em&gt;Power&lt;/em&gt; options under the &lt;strong&gt;Conditions&lt;/strong&gt; tab. If the OS thinks that our server is now running on battery power, we have bigger issues.&lt;/li&gt;
&lt;li&gt;Under &lt;strong&gt;Settings&lt;/strong&gt;, I usually adjust &lt;em&gt;Stop the task if it runs longer than&amp;hellip;&lt;/em&gt; field to something appropriate for the job schedule.&lt;/li&gt;
&lt;li&gt;Back to the &lt;strong&gt;General&lt;/strong&gt; tab. Under the &lt;em&gt;Security Options&lt;/em&gt;, I add the service account that my scripts run under. I set the task to &lt;em&gt;Run whether the user is logged in or not&lt;/em&gt;, with &lt;em&gt;highest priviledges&lt;/em&gt; to bypass any UAC problems and &lt;em&gt;Configure for Windows Server 2016&lt;/em&gt;. (I have no idea what the real-world implications of setting the OS field are, since my scripts seem to work with this is also set to &amp;lsquo;Windows Server 2008&amp;rsquo;).&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;OK&lt;/code&gt;. You&amp;rsquo;ll be prompted for the password of the credentials you used in #8.
At the end of all this, I like to manually run the task by right-clicking it. This is a final sanity check that everything works. It&amp;rsquo;s easier for me to check at the time of setup (instead of the first time it runs) because my brain is already in that space.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since I promised the cheatcode way of doing this, here&amp;rsquo;s how I like to add new tasks that are similar to existing ones. Since most of mine are scripts, the Task Scheduler settings are pretty much identical. This method helps avoid problems when editing the &lt;em&gt;Arguments&lt;/em&gt; field - the string is so long and the field window is so small that I always have to scroll and I hate trying to figure out if I&amp;rsquo;ve keyed things in properly.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;In Task Scheduler, Find a task that closely matches the new one you&amp;rsquo;re implementing.&lt;/li&gt;
&lt;li&gt;Select it, right-click and choose &lt;code&gt;Export&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Save the XML file someone easily accessed, like the Desktop.&lt;/li&gt;
&lt;li&gt;Right-click the resulting file and open it in Notepad (or the editor of your choice).&lt;/li&gt;
&lt;li&gt;Update the &lt;code&gt;&amp;lt;Description&amp;gt;&lt;/code&gt;, &lt;code&gt;&amp;lt;URI&amp;gt;&lt;/code&gt; and &lt;code&gt;&amp;lt;Arguments&amp;gt;&lt;/code&gt; fields with the correct values.&lt;/li&gt;
&lt;li&gt;Save the file.&lt;/li&gt;
&lt;li&gt;Back in Task Scheduler, select &lt;code&gt;Import Task&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Browse to the XML file you just edited, and Open it.&lt;/li&gt;
&lt;li&gt;Task scheduler will add a new task. You&amp;rsquo;ll have to re-enter the password and possibly adjust the schedule, but everything else should be correct.&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>Powershell &amp; PowerPlatform API</title>
        <link>http://localhost:1313/posts/powershell-powerplatform-api/</link>
        <pubDate>Fri, 09 Jul 2021 16:04:57 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/powershell-powerplatform-api/</guid>
        <description>&lt;p&gt;I found out that our netadmins are regularly checking the amount of free space we have in our Power Platform (Dynamics) subscription with the following process:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Launch a browser&lt;/li&gt;
&lt;li&gt;Authenticate to portal.office.com&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;Admin&lt;/code&gt;. A new window opens.&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;All Admin Centers&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Click &lt;code&gt;Power Apps&lt;/code&gt;. A new window opens.&lt;/li&gt;
&lt;li&gt;Expand &lt;code&gt;Resources -&amp;gt; Capacity&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Look at the &lt;code&gt;Storage Capacity Usage&lt;/code&gt; field and make sure we&amp;rsquo;re below our capacity.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Whew! I&amp;rsquo;m tired typing that up once! I don&amp;rsquo;t think I could stand doing it daily (or weekly, or whenever they remember), so let&amp;rsquo;s automate it!&lt;/p&gt;
&lt;p&gt;We need to know the total capacity and what we&amp;rsquo;re using. If we cross some threshold, trigger an action. That&amp;rsquo;s pretty straightforward.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Used Storage&lt;/strong&gt;&lt;br&gt;
We can grab this from the Business App Platform API, but there are some hoops to jump through. We need to setup an account that&amp;rsquo;ll have permissions for this, Register an Admin Management Application in PowerPlatform, then query the API.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Setup the Account&lt;/em&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;How to: Use the portal to create an Azure AD application and service principal that can access resources&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Register an Admin Management Application&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Region RegisterAdminManagementApplication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#https://docs.microsoft.com/en-us/power-platform/admin/powershell-create-service-principal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Requires&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;Powershell&lt;/span&gt;&lt;span class=&#34;na&#34;&gt; 5.1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerApps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Administration&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerApps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;APPID_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;TENANTID_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Login interactively with a tenant administrator for Power Platform&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-PowerAppsAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Endpoint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantID&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Register a new application, this gives the SPN / client application same permissions as a tenant admin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-PowerAppManagementApp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ApplicationId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#EndRegion RegisterAdminManagementApplication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Query the API&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Region AuthenticateAsServicePrincipalDynamic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLIENTID_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PASSWORD_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;company.onmicrosoft.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://login.microsoftonline.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://api.bap.microsoft.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grant_type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;client_credentials&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_secret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oauth2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;api-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#EndRegion  AuthenticateAsServicePrincipalDynamics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://api.bap.microsoft.com/providers/Microsoft.BusinessAppPlatform/scopes/admin/environments?api-version=2020-10-01&amp;amp;$expand=properties.capacity&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{0:n2}&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Measure-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Property&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RatedConsumption&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;sum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Storage Capacity&lt;/strong&gt;&lt;br&gt;
The available Storage Capacity is more complicated to determine, since it&amp;rsquo;s not stored anywhere that I could find. It seems to be dynamically generated, which means this script will have to do the legwork. Each tenant gets a base 10GB of Storage Capacity, and additional storage is added per licensed user, or by purchasing more Storage Capacity. We can pull the licesing information from the MS Graph API:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Region AuthenticateAsServicePrincipalGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grant_type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;client_credentials&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_secret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oauth2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#EndRegion  AuthenticateAsServicePrincipalGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://graph.microsoft.com/v1.0/subscribedskus&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#calculate total space in GB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$BaseStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;#fixed value per tenant&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DYN_365_SALES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;.25&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;skupartnumber&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dyn365_enterprise_sales&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepaidunits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;enabled&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$CRMStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;skupartnumber&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CRMSTORAGE&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepaidunits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;enabled&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{0:n2}&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BaseStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DYN_365_SALES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CRMStorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let&amp;rsquo;s see the whole thing together, including the actions we&amp;rsquo;ll take after crossing certain  space thresholds, as well as a function to let us know when the Application Password is near expiry:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#O365-Dynamics-Capacity.ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Script to query the used vs total storage space we have in Power Platform (Dynamics)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;https://docs.microsoft.com/en-us/power-platform/admin/list-environments
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;https://jussiroine.com/2019/12/building-a-monitoring-solution-for-power-platform-events-using-powershell-c-azure-log-analytics-and-azure-sentinel/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Greg Beifuss
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;2021-06-14 21:27
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;&amp;lt;#
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#Region RegisterAdminManagementApplication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#https://docs.microsoft.com/en-us/power-platform/admin/powershell-create-service-principal
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#Requires Powershell 5.1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Import-Module Microsoft.PowerApps.Administration.PowerShell
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Import-Module Microsoft.PowerApps.PowerShell
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;$appId = &amp;#34;APPID_FROM_AZURE&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;$tenantId = &amp;#34;TENANTID_FROM_AZURE&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;# Login interactively with a tenant administrator for Power Platform
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;Add-PowerAppsAccount -Endpoint prod -TenantID $tenantId
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;# Register a new application, this gives the SPN / client application same permissions as a tenant admin
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;New-PowerAppManagementApp -ApplicationId $appId
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#EndRegion RegisterAdminManagementApplication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;#&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Region AuthenticateAsServicePrincipalDynamics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CLIENTID_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PASSWORD_FROM_AZURE&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;company.onmicrosoft.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://login.microsoftonline.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://api.bap.microsoft.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grant_type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;client_credentials&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_secret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oauth2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;api-version&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#EndRegion  AuthenticateAsServicePrincipalDynamics&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://api.bap.microsoft.com/providers/Microsoft.BusinessAppPlatform/scopes/admin/environments?api-version=2020-10-01&amp;amp;$expand=properties.capacity&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{0:n2}&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;properties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Measure-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Property&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RatedConsumption&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;sum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Region AuthenticateAsServicePrincipalGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grant_type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;client_credentials&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;resource&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;client_secret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$loginURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$tenantdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oauth2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$body&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authorization&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$oauth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;access_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#EndRegion  AuthenticateAsServicePrincipalGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headerParams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://graph.microsoft.com/v1.0/subscribedskus&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#calculate total space in GB&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$BaseStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;#fixed value per tenant&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DYN_365_SALES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;.25&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;skupartnumber&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dyn365_enterprise_sales&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepaidunits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;enabled&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$CRMStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$request&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;skupartnumber&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;CRMSTORAGE&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepaidunits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;enabled&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;{0:n2}&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$BaseStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$DYN_365_SALES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$CRMStorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Send email based on how much storage is left.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;Switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ge&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.70&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Send-MailMessage&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-From&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Subject&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Dynamics Capacity - &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ToString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;#.##&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;% in use!&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;We&amp;#39;re using &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; / &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; GB. Please immediately escalate to a Netadmin.&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SmtpServer&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-gt&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.65&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Send-MailMessage&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-From&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Subject&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Dynamics Capacity - 65% in use&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;We&amp;#39;re using &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; / &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; GB, or &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$UsedStorage&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$TotalStorage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)*&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ToString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;#.##&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;%. Please escalate to a Netadmin.&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SmtpServer&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#Send email if Application password is near expiry&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;adddays&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ge&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;6/10/2022&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nb&#34;&gt;Send-MailMessage&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-From&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;helpdesk&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Subject&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;O365-Dynamics-Capacity.ps1&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;The AzureAD Application Powershell-PowerPlatform-CapacityReport has a Client Secret near expiry. Please escalate to Greg for renewal.&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SmtpServer&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;18&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Greg&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Powershell &amp; Netscaler API</title>
        <link>http://localhost:1313/posts/netscaler-api/</link>
        <pubDate>Fri, 09 Jul 2021 16:04:02 -0400</pubDate>
        
        <guid>http://localhost:1313/posts/netscaler-api/</guid>
        <description>&lt;p&gt;I&amp;rsquo;ve been learning how to use Powershell to work with APIs, so I decided to write a quick script that will query our two Netscaler devices for the running configuration, and dump it. This is a quick way to backup the configuration regularly, because I often forget to grab a copy for backup purposes (unless I&amp;rsquo;m performing extensive work, or upgrading the firmware).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#These credentials are encrypted by ServiceAccount on Server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$credFilePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;\\SERVER\PATH\creds.xml&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$netscalerId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Import-Clixml&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$credFilePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;UserName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$netscalerPwd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Runtime.InteropServices.Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PtrToStringAuto&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.Runtime.InteropServices.Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SecureStringToBSTR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Import-Clixml&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$credFilePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$formatedDate&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-Date&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Format&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;yyyyMMdd&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$FilePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;\\SERVER\PATH&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$headers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;X-NITRO-USER&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;nsroot&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-NITRO-PASS&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;DFt$LG6%6L3F&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#grab Netscaler01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$uri&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://netscaler01.company.com/nitro/v1/config/nsrunningconfig&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$uri&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;nsrunningconfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;response&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Convertto-Json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$FilePath&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;\Netscaler01_&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;${formatedDate}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;#grab Netscaler03&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$uri&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://netscaler03.company.com/nitro/v1/config/nsrunningconfig&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$uri&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;application&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;nsrunningconfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;response&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertTo-Json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$FilePath&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;\Netscaler03_&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;${formatedDate}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Greg&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
